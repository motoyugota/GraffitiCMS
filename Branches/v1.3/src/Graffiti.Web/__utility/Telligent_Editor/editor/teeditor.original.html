<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!--

 * Copyright (C) 2003-2007 Frederico Caldeira Knabben
 *
 * == BEGIN LICENSE ==
 *
 * Licensed under the terms of any of the following licenses at your
 * choice:
 *
 *  - GNU General Public License Version 2 or later (the "GPL")
 *    http://www.gnu.org/licenses/gpl.html
 *
 *  - GNU Lesser General Public License Version 2.1 or later (the "LGPL")
 *    http://www.gnu.org/licenses/lgpl.html
 *
 *  - Mozilla Public License Version 1.1 or later (the "MPL")
 *    http://www.mozilla.org/MPL/MPL-1.1.html
 *
 * == END LICENSE ==
 *
 * Main page that holds the editor.
-->
<html>
<head>
	<title>Telligent_Editor</title>
	<meta name="robots" content="noindex, nofollow">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<!-- @Packager.RemoveLine
	<meta http-equiv="Cache-Control" content="public" />
	@Packager.RemoveLine -->
	<script type="text/javascript">

// Instead of loading scripts and CSSs using inline tags, all scripts are
// loaded by code. In this way we can guarantee the correct processing order,
// otherwise external scripts and inline scripts could be executed in an
// unwanted order (IE).

function LoadScript( url )
{
	document.write( '<scr' + 'ipt type="text/javascript" src="' + url + '"><\/scr' + 'ipt>' ) ;
}

function LoadCss( url )
{
	document.write( '<link href="' + url + '" type="text/css" rel="stylesheet" />' ) ;
}

// Main editor scripts.
var sSuffix = ( /*@cc_on!@*/false ) ? 'ie' : 'gecko' ;

/* @Packager.RemoveLine
LoadScript( 'js/teeditorcode_' + sSuffix + '.js' ) ;
@Packager.RemoveLine */
// @Packager.Remove.Start

LoadScript( '_source/teconstants.js' ) ;
LoadScript( '_source/tejscoreextensions.js' ) ;

if ( sSuffix == 'ie' )
	LoadScript( '_source/classes/teiecleanup.js' ) ;

LoadScript( '_source/internals/tebrowserinfo.js' ) ;
LoadScript( '_source/internals/teurlparams.js' ) ;
LoadScript( '_source/classes/teevents.js' ) ;
LoadScript( '_source/classes/tedataprocessor.js' ) ;
LoadScript( '_source/internals/te.js' ) ;
LoadScript( '_source/internals/te_' + sSuffix + '.js' ) ;
LoadScript( '_source/internals/teconfig.js' ) ;

LoadScript( '_source/internals/tedebug.js' ) ;
LoadScript( '_source/internals/tedomtools.js' ) ;
LoadScript( '_source/internals/tetools.js' ) ;
LoadScript( '_source/internals/tetools_' + sSuffix + '.js' ) ;
LoadScript( '_source/Telligent_Editorapi.js' ) ;
LoadScript( '_source/classes/teimagepreloader.js' ) ;
LoadScript( '_source/internals/teregexlib.js' ) ;
LoadScript( '_source/internals/telistslib.js' ) ;
LoadScript( '_source/internals/telanguagemanager.js' ) ;
LoadScript( '_source/internals/texhtmlentities.js' ) ;
LoadScript( '_source/internals/texhtml.js' ) ;
LoadScript( '_source/internals/texhtml_' + sSuffix + '.js' ) ;
LoadScript( '_source/internals/tecodeformatter.js' ) ;
LoadScript( '_source/internals/teundo.js' ) ;
LoadScript( '_source/classes/teeditingarea.js' ) ;
LoadScript( '_source/classes/tekeystrokehandler.js' ) ;

LoadScript( 'dtd/te_xhtml10transitional.js' ) ;
LoadScript( '_source/classes/testyle.js' ) ;
LoadScript( '_source/internals/testyles.js' ) ;

LoadScript( '_source/internals/telisthandler.js' ) ;
LoadScript( '_source/classes/teelementpath.js' ) ;
LoadScript( '_source/classes/tedomrange.js' ) ;
LoadScript( '_source/classes/tedocumentfragment_' + sSuffix + '.js' ) ;
LoadScript( '_source/classes/tew3crange.js' ) ;
LoadScript( '_source/classes/tedomrange_' + sSuffix + '.js' ) ;
LoadScript( '_source/classes/tedomrangeiterator.js' ) ;
LoadScript( '_source/classes/teenterkey.js' ) ;

LoadScript( '_source/internals/tedocumentprocessor.js' ) ;
LoadScript( '_source/internals/teselection.js' ) ;
LoadScript( '_source/internals/teselection_' + sSuffix + '.js' ) ;

LoadScript( '_source/internals/tetablehandler.js' ) ;
LoadScript( '_source/internals/tetablehandler_' + sSuffix + '.js' ) ;
LoadScript( '_source/classes/texml.js' ) ;
LoadScript( '_source/classes/texml_' + sSuffix + '.js' ) ;

LoadScript( '_source/commandclasses/tenamedcommand.js' ) ;
LoadScript( '_source/commandclasses/testylecommand.js' ) ;
LoadScript( '_source/commandclasses/te_othercommands.js' ) ;
LoadScript( '_source/commandclasses/teshowblocks.js' ) ;
LoadScript( '_source/commandclasses/tespellcheckcommand_' + sSuffix + '.js' ) ;
LoadScript( '_source/commandclasses/tetextcolorcommand.js' ) ;
LoadScript( '_source/commandclasses/tepasteplaintextcommand.js' ) ;
LoadScript( '_source/commandclasses/tepastewordcommand.js' ) ;
LoadScript( '_source/commandclasses/tetablecommand.js' ) ;
LoadScript( '_source/commandclasses/tefitwindow.js' ) ;
LoadScript( '_source/commandclasses/telistcommands.js' ) ;
LoadScript( '_source/commandclasses/tejustifycommands.js' ) ;
LoadScript( '_source/commandclasses/teindentcommands.js' ) ;
LoadScript( '_source/commandclasses/teblockquotecommand.js' ) ;
LoadScript( '_source/commandclasses/tecorestylecommand.js' ) ;
LoadScript( '_source/commandclasses/teremoveformatcommand.js' ) ;
LoadScript( '_source/internals/tecommands.js' ) ;

LoadScript( '_source/classes/tepanel.js' ) ;
LoadScript( '_source/classes/teicon.js' ) ;
LoadScript( '_source/classes/tetoolbarbuttonui.js' ) ;
LoadScript( '_source/classes/tetoolbarbutton.js' ) ;
LoadScript( '_source/classes/tespecialcombo.js' ) ;
LoadScript( '_source/classes/tetoolbarspecialcombo.js' ) ;
LoadScript( '_source/classes/tetoolbarstylecombo.js' ) ;
LoadScript( '_source/classes/tetoolbarfontformatcombo.js' ) ;
LoadScript( '_source/classes/tetoolbarfontscombo.js' ) ;
LoadScript( '_source/classes/tetoolbarfontsizecombo.js' ) ;
LoadScript( '_source/classes/tetoolbarpanelbutton.js' ) ;
LoadScript( '_source/internals/tetoolbaritems.js' ) ;
LoadScript( '_source/classes/tetoolbar.js' ) ;
LoadScript( '_source/classes/tetoolbarbreak_' + sSuffix + '.js' ) ;
LoadScript( '_source/internals/tetoolbarset.js' ) ;
LoadScript( '_source/internals/tedialog.js' ) ;
LoadScript( '_source/internals/tedialog_' + sSuffix + '.js' ) ;
LoadScript( '_source/classes/temenuitem.js' ) ;
LoadScript( '_source/classes/temenublock.js' ) ;
LoadScript( '_source/classes/temenublockpanel.js' ) ;
LoadScript( '_source/classes/tecontextmenu.js' ) ;
LoadScript( '_source/internals/te_contextmenu.js' ) ;
LoadScript( '_source/classes/teplugin.js' ) ;
LoadScript( '_source/internals/teplugins.js' ) ;

// @Packager.Remove.End

// Base configuration file.
LoadScript( '../teconfig.js' ) ;

	</script>
	<script type="text/javascript">

if ( TEBrowserInfo.IsIE )
{
	// Remove IE mouse flickering.
	try
	{
		document.execCommand( 'BackgroundImageCache', false, true ) ;
	}
	catch (e)
	{
		// We have been reported about loading problems caused by the above
		// line. For safety, let's just ignore errors.
	}

	// Create the default cleanup object used by the editor.
	TE.IECleanup = new TEIECleanup( window ) ;
	TE.IECleanup.AddItem( TETempBin, TETempBin.Reset ) ;
	TE.IECleanup.AddItem( TE, TE_Cleanup ) ;
}

// The first function to be called on selection change must the the styles
// change checker, because the result of its processing may be used by another
// functions listening to the same event.
TE.Events.AttachEvent( 'OnSelectionChange', function() { TEStyles.CheckSelectionChanges() ; } ) ;

// The config hidden field is processed immediately, because
// CustomConfigurationsPath may be set in the page.
TEConfig.ProcessHiddenField() ;

// Load the custom configurations file (if defined).
if ( TEConfig.CustomConfigurationsPath.length > 0 )
	LoadScript( TEConfig.CustomConfigurationsPath ) ;

	</script>
	<script type="text/javascript">

// Load configurations defined at page level.
TEConfig_LoadPageConfig() ;

TEConfig_PreProcess() ;

// Load the active skin CSS.
LoadCss( TEConfig.SkinPath + 'te_editor.css' ) ;

// Load the language file.
TELanguageManager.Initialize() ;
LoadScript( 'lang/' + TELanguageManager.ActiveLanguage.Code + '.js' ) ;

	</script>
	<script type="text/javascript">

// Initialize the editing area context menu.
TE_ContextMenu_Init() ;

TEPlugins.Load() ;

	</script>
	<script type="text/javascript">

// Set the editor interface direction.
window.document.dir = TELang.Dir ;

	</script>
	<script type="text/javascript">

window.onload = function()
{
	InitializeAPI() ;

	if ( TEBrowserInfo.IsIE )
		TE_PreloadImages() ;
	else
		LoadToolbarSetup() ;
}

function LoadToolbarSetup()
{
	Telligent_EditorAPI._FunctionQueue.Add( LoadToolbar ) ;
}

function LoadToolbar()
{
	var oToolbarSet = TE.ToolbarSet = TEToolbarSet_Create() ;

	if ( oToolbarSet.IsLoaded )
		StartEditor() ;
	else
	{
		oToolbarSet.OnLoad = StartEditor ;
		oToolbarSet.Load( TEURLParams['Toolbar'] || 'Default' ) ;
	}
}

function StartEditor()
{
	// Remove the onload listener.
	TE.ToolbarSet.OnLoad = null ;

	Telligent_EditorAPI._FunctionQueue.Remove( LoadToolbar ) ;

	TE.Events.AttachEvent( 'OnStatusChange', WaitForActive ) ;

	// Start the editor.
	TE.StartEditor() ;
}

function WaitForActive( editorInstance, newStatus )
{
	if ( newStatus == TE_STATUS_ACTIVE )
	{
		if ( TEBrowserInfo.IsGecko )
			TETools.RunFunction( window.onresize ) ;

		_AttachFormSubmitToAPI() ;

		TE.SetStatus( TE_STATUS_COMPLETE ) ;

		// Call the special "Telligent_Editor_OnComplete" function that should be present in
		// the HTML page where the editor is located.
		if ( typeof( window.parent.Telligent_Editor_OnComplete ) == 'function' )
			window.parent.Telligent_Editor_OnComplete( TE ) ;
	}
}

// Gecko browsers doens't calculate well that IFRAME size so we must
// recalculate it every time the window size changes.
if ( TEBrowserInfo.IsGecko )
{
	function Window_OnResize()
	{
		if ( TEBrowserInfo.IsOpera )
			return ;

		var oCell = document.getElementById( 'xEditingArea' ) ;

		var eInnerElement = oCell.firstChild ;
		if ( eInnerElement )
		{
			eInnerElement.style.height = 0 ;
			eInnerElement.style.height = oCell.scrollHeight - 2 ;
		}
	}
	window.onresize = Window_OnResize ;
}

	</script>
</head>
<body>
	<table width="100%" cellpadding="0" cellspacing="0" style="height: 100%; table-layout: fixed">
		<tr id="xToolbarRow" style="display: none">
			<td id="xToolbarSpace" style="overflow: hidden">
				<table width="100%" cellpadding="0" cellspacing="0">
					<tr id="xCollapsed" style="display: none">
						<td id="xExpandHandle" class="TB_Expand" colspan="3">
							<img class="TB_ExpandImg" alt="" src="images/spacer.gif" width="8" height="4" /></td>
					</tr>
					<tr id="xExpanded" style="display: none">
						<td id="xTBLeftBorder" class="TB_SideBorder" style="width: 1px; display: none;"></td>
						<td id="xCollapseHandle" style="display: none" class="TB_Collapse" valign="bottom">
							<img class="TB_CollapseImg" alt="" src="images/spacer.gif" width="8" height="4" /></td>
						<td id="xToolbar" class="TB_ToolbarSet"></td>
						<td class="TB_SideBorder" style="width: 1px"></td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td id="xEditingArea" valign="top" style="height: 100%"></td>
		</tr>
	</table>
</body>
</html>
