/*

 * Copyright (C) 2003-2007 Frederico Caldeira Knabben
 * 
 * == BEGIN LICENSE ==
 * 
 * Licensed under the terms of any of the following licenses at your
 * choice:
 * 
 *  - GNU General Public License Version 2 or later (the "GPL")
 *    http://www.gnu.org/licenses/gpl.html
 * 
 *  - GNU Lesser General Public License Version 2.1 or later (the "LGPL")
 *    http://www.gnu.org/licenses/lgpl.html
 * 
 *  - Mozilla Public License Version 1.1 or later (the "MPL")
 *    http://www.mozilla.org/MPL/MPL-1.1.html
 * 
 * == END LICENSE ==
 * 
 * This file has been compressed for better performance. The original source
 * can be found at "editor/_source".
 */

var TE_STATUS_NOTLOADED=window.parent.TE_STATUS_NOTLOADED=0;var TE_STATUS_ACTIVE=window.parent.TE_STATUS_ACTIVE=1;var TE_STATUS_COMPLETE=window.parent.TE_STATUS_COMPLETE=2;var TE_TRISTATE_OFF=window.parent.TE_TRISTATE_OFF=0;var TE_TRISTATE_ON=window.parent.TE_TRISTATE_ON=1;var TE_TRISTATE_DISABLED=window.parent.TE_TRISTATE_DISABLED=-1;var TE_UNKNOWN=window.parent.TE_UNKNOWN=-9;var TE_TOOLBARITEM_ONLYICON=window.parent.TE_TOOLBARITEM_ONLYICON=0;var TE_TOOLBARITEM_ONLYTEXT=window.parent.TE_TOOLBARITEM_ONLYTEXT=1;var TE_TOOLBARITEM_ICONTEXT=window.parent.TE_TOOLBARITEM_ICONTEXT=2;var TE_EDITMODE_WYSIWYG=window.parent.TE_EDITMODE_WYSIWYG=0;var TE_EDITMODE_SOURCE=window.parent.TE_EDITMODE_SOURCE=1;var TE_IMAGES_PATH='images/';var TE_SPACER_PATH='images/spacer.gif';var CTRL=1000;var SHIFT=2000;var ALT=4000;var TE_STYLE_BLOCK=0;var TE_STYLE_INLINE=1;var TE_STYLE_OBJECT=2;
String.prototype.Contains=function(A){return (this.indexOf(A)>-1);};String.prototype.Equals=function(){var A=arguments;if (A.length==1&&A[0].pop) A=A[0];for (var i=0;i<A.length;i++){if (this==A[i]) return true;};return false;};String.prototype.IEquals=function(){var A=this.toUpperCase();var B=arguments;if (B.length==1&&B[0].pop) B=B[0];for (var i=0;i<B.length;i++){if (A==B[i].toUpperCase()) return true;};return false;};String.prototype.ReplaceAll=function(A,B){var C=this;for (var i=0;i<A.length;i++){C=C.replace(A[i],B[i]);};return C;};String.prototype.StartsWith=function(A){return (this.substr(0,A.length)==A);};String.prototype.EndsWith=function(A,B){var C=this.length;var D=A.length;if (D>C) return false;if (B){var E=new RegExp(A+'$','i');return E.test(this);}else return (D==0||this.substr(C-D,D)==A);};String.prototype.Remove=function(A,B){var s='';if (A>0) s=this.substring(0,A);if (A+B<this.length) s+=this.substring(A+B,this.length);return s;};String.prototype.Trim=function(){return this.replace(/(^[ \t\n\r]*)|([ \t\n\r]*$)/g,'');};String.prototype.LTrim=function(){return this.replace(/^[ \t\n\r]*/g,'');};String.prototype.RTrim=function(){return this.replace(/[ \t\n\r]*$/g,'');};String.prototype.ReplaceNewLineChars=function(A){return this.replace(/\n/g,A);};String.prototype.Replace=function(A,B,C){if (typeof B=='function'){return this.replace(A,function(){return B.apply(C||this,arguments);});}else return this.replace(A,B);};Array.prototype.AddItem=function(A){var i=this.length;this[i]=A;return i;};Array.prototype.IndexOf=function(A){for (var i=0;i<this.length;i++){if (this[i]==A) return i;};return-1;};
var	TEIECleanup=function(A){if (A._TECleanupObj) this.Items=A._TECleanupObj.Items;else{this.Items=[];A._TECleanupObj=this;TETools.AddEventListenerEx(A,'unload',TEIECleanup_Cleanup);}};TEIECleanup.prototype.AddItem=function(A,B){this.Items.push([A,B]);};function TEIECleanup_Cleanup(){if (!this._TECleanupObj||!window.TEUnloadFlag) return;var A=this._TECleanupObj.Items;while (A.length>0){var B=A.pop();if (B) B[1].call(B[0]);};this._TECleanupObj=null;if (CollectGarbage) CollectGarbage();};
var s=navigator.userAgent.toLowerCase();var TEBrowserInfo={IsIE:/*@cc_on!@*/false,IsIE7:/*@cc_on!@*/false&&s.Contains('msie 7'),IsGecko:s.Contains('gecko/'),IsSafari:s.Contains(' applewebkit/'),IsOpera:!!window.opera,IsMac:s.Contains('macintosh')};(function(A){A.IsGeckoLike=(A.IsGecko||A.IsSafari||A.IsOpera);if (A.IsGecko){var B=s.match(/gecko\/(\d+)/)[1];A.IsGecko10=((B<20051111)||(/rv:1\.7/.test(s)));A.IsGecko19=/rv:1\.9/.test(s);}else A.IsGecko10=false;})(TEBrowserInfo);
var TEURLParams={};(function(){var A=document.location.search.substr(1).split('&');for (var i=0;i<A.length;i++){var B=A[i].split('=');var C=decodeURIComponent(B[0]);var D=decodeURIComponent(B[1]);TEURLParams[C]=D;}})();
var TEEvents=function(A){this.Owner=A;this._RegisteredEvents={};};TEEvents.prototype.AttachEvent=function(A,B){var C;if (!(C=this._RegisteredEvents[A])) this._RegisteredEvents[A]=[B];else{if (C.IndexOf(B)==-1) C.push(B);}};TEEvents.prototype.FireEvent=function(A,B){var C=true;var D=this._RegisteredEvents[A];if (D){for (var i=0;i<D.length;i++){try{C=(D[i](this.Owner,B)&&C);}catch(e){if (e.number!=-2146823277) throw e;}}};return C;};
var TEDataProcessor=function(){};TEDataProcessor.prototype={ConvertToHtml:function(A){if (TEConfig.FullPage){TE.DocTypeDeclaration=A.match(TERegexLib.DocTypeTag);if (!TERegexLib.HasBodyTag.test(A)) A='<body>'+A+'</body>';if (!TERegexLib.HtmlOpener.test(A)) A='<html dir="'+TEConfig.ContentLangDirection+'">'+A+'</html>';if (!TERegexLib.HeadOpener.test(A)) A=A.replace(TERegexLib.HtmlOpener,'$&<head><title></title></head>');return A;}else{var B=TEConfig.DocType+'<html dir="'+TEConfig.ContentLangDirection+'"';if (TEBrowserInfo.IsIE&&TEConfig.DocType.length>0&&!TERegexLib.Html4DocType.test(TEConfig.DocType)) B+=' style="overflow-y: scroll"';B+='><head><title></title></head><body'+TEConfig.GetBodyAttributes()+'>'+A+'</body></html>';return B;}},ConvertToDataFormat:function(A,B,C,D){var E=TEXHtml.GetXHTML(A,!B,D);if (C&&TERegexLib.EmptyOutParagraph.test(E)) return '';return E;},FixHtml:function(A){return A;}};
var TE={Name:TEURLParams['InstanceName'],Status:0,EditMode:0,Toolbar:null,HasFocus:false,DataProcessor:new TEDataProcessor(),AttachToOnSelectionChange:function(A){this.Events.AttachEvent('OnSelectionChange',A);},GetLinkedFieldValue:function(){return this.LinkedField.value;},GetParentForm:function(){return this.LinkedField.form;},StartupValue:'',IsDirty:function(){if (this.EditMode==1) return (this.StartupValue!=this.EditingArea.Textarea.value);else{if (!this.EditorDocument) return false;return (this.StartupValue!=this.EditorDocument.body.innerHTML);}},ResetIsDirty:function(){if (this.EditMode==1) this.StartupValue=this.EditingArea.Textarea.value;else if (this.EditorDocument.body) this.StartupValue=this.EditorDocument.body.innerHTML;},StartEditor:function(){this.TempBaseTag=TEConfig.BaseHref.length>0?'<base href="'+TEConfig.BaseHref+'" _tetemp="true"></base>':'';var A=TE.KeystrokeHandler=new TEKeystrokeHandler();A.OnKeystroke=_TE_KeystrokeHandler_OnKeystroke;A.SetKeystrokes(TEConfig.Keystrokes);if (TEBrowserInfo.IsIE7){if ((CTRL+86/*V*/) in A.Keystrokes) A.SetKeystrokes([CTRL+86,true]);if ((SHIFT+45/*INS*/) in A.Keystrokes) A.SetKeystrokes([SHIFT+45,true]);};A.SetKeystrokes([CTRL+8,true]);this.EditingArea=new TEEditingArea(document.getElementById('xEditingArea'));this.EditingArea.FFSpellChecker=TEConfig.FirefoxSpellChecker;this.SetData(this.GetLinkedFieldValue(),true);TETools.AddEventListener(document,"keydown",this._TabKeyHandler);this.AttachToOnSelectionChange(_TE_PaddingNodeListener);if (TEBrowserInfo.IsGecko) this.AttachToOnSelectionChange(this._ExecCheckEmptyBlock);},Focus:function(){TE.EditingArea.Focus();},SetStatus:function(A){this.Status=A;if (A==1){TEFocusManager.AddWindow(window,true);if (TEBrowserInfo.IsIE) TEFocusManager.AddWindow(window.frameElement,true);if (TEConfig.StartupFocus) TE.Focus();};this.Events.FireEvent('OnStatusChange',A);},FixBody:function(){var A=TEConfig.EnterMode;if (A!='p'&&A!='div') return;var B=this.EditorDocument;if (!B) return;var C=B.body;if (!C) return;TEDomTools.TrimNode(C);var D=C.firstChild;var E;while (D){var F=false;switch (D.nodeType){case 1:if (!TEListsLib.BlockElements[D.nodeName.toLowerCase()]&&!D.getAttribute('_tefakelement')&&D.getAttribute('_moz_dirty')==null) F=true;break;case 3:if (E||D.nodeValue.Trim().length>0) F=true;};if (F){var G=D.parentNode;if (!E) E=G.insertBefore(B.createElement(A),D);E.appendChild(G.removeChild(D));D=E.nextSibling;}else{if (E){TEDomTools.TrimNode(E);E=null;};D=D.nextSibling;}};if (E) TEDomTools.TrimNode(E);},GetData:function(A){if (TE.EditMode==1) return TE.EditingArea.Textarea.value;this.FixBody();var B=TE.EditorDocument;if (!B) return null;var C=TEConfig.FullPage;var D=TE.DataProcessor.ConvertToDataFormat(C?B.documentElement:B.body,!C,TEConfig.IgnoreEmptyParagraphValue,A);D=TE.ProtectEventsRestore(D);if (TEBrowserInfo.IsIE) D=D.replace(TERegexLib.ToReplace,'$1');if (C){if (TE.DocTypeDeclaration&&TE.DocTypeDeclaration.length>0) D=TE.DocTypeDeclaration+'\n'+D;if (TE.XmlDeclaration&&TE.XmlDeclaration.length>0) D=TE.XmlDeclaration+'\n'+D;};return TEConfig.ProtectedSource.Revert(D);},UpdateLinkedField:function(){var A=TE.GetXHTML(TEConfig.FormatOutput);if (TEConfig.HtmlEncodeOutput) A=TETools.HTMLEncode(A);TE.LinkedField.value=A;TE.Events.FireEvent('OnAfterLinkedFieldUpdate');},RegisteredDoubleClickHandlers:{},OnDoubleClick:function(A){var B=TE.RegisteredDoubleClickHandlers[A.tagName];if (B) B(A);},RegisterDoubleClickHandler:function(A,B){TE.RegisteredDoubleClickHandlers[B.toUpperCase()]=A;},OnAfterSetHTML:function(){TEDocumentProcessor.Process(TE.EditorDocument);TEUndo.SaveUndoStep();TE.Events.FireEvent('OnSelectionChange');TE.Events.FireEvent('OnAfterSetHTML');},ProtectUrls:function(A){A=A.replace(TERegexLib.ProtectUrlsA,'$& _tesavedurl=$1');A=A.replace(TERegexLib.ProtectUrlsImg,'$& _tesavedurl=$1');A=A.replace(TERegexLib.ProtectUrlsArea,'$& _tesavedurl=$1');return A;},ProtectEvents:function(A){return A.replace(TERegexLib.TagsWithEvent,_TE_ProtectEvents_ReplaceTags);},ProtectEventsRestore:function(A){return A.replace(TERegexLib.ProtectedEvents,_TE_ProtectEvents_RestoreEvents);},ProtectTags:function(A){var B=TEConfig.ProtectedTags;if (TEBrowserInfo.IsIE) B+=B.length>0?'|ABBR|XML|EMBED':'ABBR|XML|EMBED';var C;if (B.length>0){C=new RegExp('<('+B+')(?!\w|:)','gi');A=A.replace(C,'<TE:$1');C=new RegExp('<\/('+B+')>','gi');A=A.replace(C,'<\/TE:$1>');};B='META';if (TEBrowserInfo.IsIE) B+='|HR';C=new RegExp('<(('+B+')(?=\\s|>|/)[\\s\\S]*?)/?>','gi');A=A.replace(C,'<TE:$1 />');return A;},SetData:function(A,B){this.EditingArea.Mode=TE.EditMode;if (TEBrowserInfo.IsIE&&TE.EditorDocument){TE.EditorDocument.detachEvent("onselectionchange",Doc_OnSelectionChange);};if (TE.EditMode==0){this._ForceResetIsDirty=(B===true);A=TEConfig.ProtectedSource.Protect(A);A=TE.DataProcessor.ConvertToHtml(A);A=A.replace(TERegexLib.InvalidSelfCloseTags,'$1></$2>');A=TE.ProtectEvents(A);A=TE.ProtectUrls(A);A=TE.ProtectTags(A);if (TE.TempBaseTag.length>0&&!TERegexLib.HasBaseTag.test(A)) A=A.replace(TERegexLib.HeadOpener,'$&'+TE.TempBaseTag);var C='';if (!TEConfig.FullPage) C+=_TE_GetEditorAreaStyleTags();if (TEBrowserInfo.IsIE) C+=TE._GetBehaviorsStyle();else if (TEConfig.ShowBorders) C+='<link href="'+TEConfig.FullBasePath+'css/te_showtableborders_gecko.css" rel="stylesheet" type="text/css" _tetemp="true" />';C+='<link href="'+TEConfig.FullBasePath+'css/te_internal.css" rel="stylesheet" type="text/css" _tetemp="true" />';A=A.replace(TERegexLib.HeadCloser,C+'$&');this.EditingArea.OnLoad=_TE_EditingArea_OnLoad;this.EditingArea.Start(A);}else{TE.EditorWindow=null;TE.EditorDocument=null;TEDomTools.PaddingNode=null;this.EditingArea.OnLoad=null;this.EditingArea.Start(A);this.EditingArea.Textarea._TEShowContextMenu=true;TE.EnterKeyHandler=null;if (B) this.ResetIsDirty();TE.KeystrokeHandler.AttachToElement(this.EditingArea.Textarea);this.EditingArea.Textarea.focus();TE.Events.FireEvent('OnAfterSetHTML');};if (TEBrowserInfo.IsGecko) window.onresize();},HasFocus:false,RedirectNamedCommands:{},ExecuteNamedCommand:function(A,B,C,D){if (!D) TEUndo.SaveUndoStep();if (!C&&TE.RedirectNamedCommands[A]!=null) TE.ExecuteRedirectedNamedCommand(A,B);else{TE.Focus();TE.EditorDocument.execCommand(A,false,B);TE.Events.FireEvent('OnSelectionChange');};if (!D) TEUndo.SaveUndoStep();},GetNamedCommandState:function(A){try{if (TEBrowserInfo.IsSafari&&TE.EditorWindow&&A.IEquals('Paste')) return 0;if (!TE.EditorDocument.queryCommandEnabled(A)) return -1;else{return TE.EditorDocument.queryCommandState(A)?1:0;}}catch (e){return 0;}},GetNamedCommandValue:function(A){var B='';var C=TE.GetNamedCommandState(A);if (C==-1) return null;try{B=this.EditorDocument.queryCommandValue(A);}catch(e) {};return B?B:'';},Paste:function(A){if (TE.Status!=2||!TE.Events.FireEvent('OnPaste')) return false;return A||TE._ExecPaste();},PasteFromWord:function(){TEDialog.OpenDialog('TEDialog_Paste',TELang.PasteFromWord,'dialog/te_paste.html',400,330,'Word');},Preview:function(){var A=TEConfig.ScreenWidth*0.8;var B=TEConfig.ScreenHeight*0.7;var C=(TEConfig.ScreenWidth-A)/2;var D=window.open('',null,'toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width='+A+',height='+B+',left='+C);var E;if (TEConfig.FullPage){if (TE.TempBaseTag.length>0) E=TE.TempBaseTag+TE.GetXHTML();else E=TE.GetXHTML();}else{E=TEConfig.DocType+'<html dir="'+TEConfig.ContentLangDirection+'"><head>'+TE.TempBaseTag+'<title>'+TELang.Preview+'</title>'+_TE_GetEditorAreaStyleTags()+'</head><body'+TEConfig.GetBodyAttributes()+'>'+TE.GetXHTML()+'</body></html>';};D.document.write(E);D.document.close();},SwitchEditMode:function(A){var B=(TE.EditMode==0);var C=TE.IsDirty();var D;if (B){TECommands.GetCommand('ShowBlocks').SaveState();if (!A&&TEBrowserInfo.IsIE) TEUndo.SaveUndoStep();D=TE.GetXHTML(TEConfig.FormatSource);if (D==null) return false;}else D=this.EditingArea.Textarea.value;TE.EditMode=B?1:0;TE.SetData(D,!C);TE.Focus();TETools.RunFunction(TE.ToolbarSet.RefreshModeState,TE.ToolbarSet);return true;},InsertElement:function(A){if (typeof A=='string') A=this.EditorDocument.createElement(A);var B=A.nodeName.toLowerCase();var C=new TEDomRange(this.EditorWindow);if (TEListsLib.BlockElements[B]!=null){C.SplitBlock();C.InsertNode(A);var D=TEDomTools.GetNextSourceElement(A,false,null,['hr','br','param','img','area','input']);if (!D&&TEConfig.EnterMode!='br'){D=this.EditorDocument.body.appendChild(this.EditorDocument.createElement(TEConfig.EnterMode));if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(D);};if (TEListsLib.EmptyElements[B]==null) C.MoveToElementEditStart(A);else if (D) C.MoveToElementEditStart(D);else C.MoveToPosition(A,4);if (TEBrowserInfo.IsGecko){if (D) D.scrollIntoView(false);A.scrollIntoView(false);}}else{C.MoveToSelection();C.DeleteContents();C.InsertNode(A);C.SetStart(A,4);C.SetEnd(A,4);};C.Select();C.Release();this.Focus();return A;},_InsertBlockElement:function(A){},_IsFunctionKey:function(A){if (A>=16&&A<=20) return true;if (A==27||(A>=33&&A<=40)) return true;if (A==45) return true;return false;},_KeyDownListener:function(A){if (!A) A=TE.EditorWindow.event;if (TE.EditorWindow){if (!TE._IsFunctionKey(A.keyCode)&&!(A.ctrlKey||A.metaKey)&&!(A.keyCode==46)) TE._KeyDownUndo();};return true;},_KeyDownUndo:function(){if (!TEUndo.Typing){TEUndo.SaveUndoStep();TEUndo.Typing=true;TE.Events.FireEvent("OnSelectionChange");};TEUndo.TypesCount++;TEUndo.Changed=1;if (TEUndo.TypesCount>TEUndo.MaxTypes){TEUndo.TypesCount=0;TEUndo.SaveUndoStep();}},_TabKeyHandler:function(A){if (!A) A=window.event;var B=A.keyCode;if (B==9&&TE.EditMode!=0){if (TEBrowserInfo.IsIE){var C=document.selection.createRange();if (C.parentElement()!=TE.EditingArea.Textarea) return true;C.text='\t';C.select();}else{var a=[];var D=TE.EditingArea.Textarea;var E=D.selectionStart;var F=D.selectionEnd;a.push(D.value.substr(0,E));a.push('\t');a.push(D.value.substr(F));D.value=a.join('');D.setSelectionRange(E+1,E+1);};if (A.preventDefault) return A.preventDefault();return A.returnValue=false;};return true;}};TE.Events=new TEEvents(TE);TE.GetHTML=TE.GetXHTML=TE.GetData;TE.SetHTML=TE.SetData;TE.InsertElementAndGetIt=TE.CreateElement=TE.InsertElement;function _TE_ProtectEvents_ReplaceTags(A){return A.replace(TERegexLib.EventAttributes,_TE_ProtectEvents_ReplaceEvents);};function _TE_ProtectEvents_ReplaceEvents(A,B){return ' '+B+'_teprotectedatt="'+encodeURIComponent(A)+'"';};function _TE_ProtectEvents_RestoreEvents(A,B){return decodeURIComponent(B);};function _TE_MouseEventsListener(A){if (!A) A=window.event;if (A.type=='mousedown') TE.MouseDownFlag=true;else if (A.type=='mouseup') TE.MouseDownFlag=false;else if (A.type=='mousemove') TE.Events.FireEvent('OnMouseMove',A);};function _TE_PaddingNodeListener(){if (TEConfig.EnterMode.IEquals('br')) return;TEDomTools.EnforcePaddingNode(TE.EditorDocument,TEConfig.EnterMode);if (!TEBrowserInfo.IsIE&&TEDomTools.PaddingNode){var A=TE.EditorWindow.getSelection();if (A&&A.rangeCount==1){var B=A.getRangeAt(0);if (B.collapsed&&B.startContainer==TE.EditorDocument.body&&B.startOffset==0){B.selectNodeContents(TEDomTools.PaddingNode);B.collapse(true);A.removeAllRanges();A.addRange(B);}}}else if (TEDomTools.PaddingNode){var C=TESelection.GetParentElement();var D=TEDomTools.PaddingNode;if (C&&C.nodeName.IEquals('body')){if (TE.EditorDocument.body.childNodes.length==1&&TE.EditorDocument.body.firstChild==D){var B=TE.EditorDocument.body.createTextRange();var F=false;if (!D.childNodes.firstChild){D.appendChild(D.ownerDocument.createTextNode('\ufeff'));F=true;};B.moveToElementText(D);B.select();if (F) B.pasteHTML('');}}}};function _TE_EditingArea_OnLoad(){TE.EditorWindow=TE.EditingArea.Window;TE.EditorDocument=TE.EditingArea.Document;TE.InitializeBehaviors();TE.MouseDownFlag=false;TETools.AddEventListener(TE.EditorDocument,'mousemove',_TE_MouseEventsListener);TETools.AddEventListener(TE.EditorDocument,'mousedown',_TE_MouseEventsListener);TETools.AddEventListener(TE.EditorDocument,'mouseup',_TE_MouseEventsListener);if (TEBrowserInfo.IsSafari){var A=function(evt){if (!(evt.ctrlKey||evt.metaKey)) return;if (TE.EditMode!=0) return;switch (evt.keyCode){case 89:TEUndo.Redo();break;case 90:TEUndo.Undo();break;}};TETools.AddEventListener(TE.EditorDocument,'keyup',A);};TE.EnterKeyHandler=new TEEnterKey(TE.EditorWindow,TEConfig.EnterMode,TEConfig.ShiftEnterMode,TEConfig.TabSpaces);TE.KeystrokeHandler.AttachToElement(TE.EditorDocument);if (TE._ForceResetIsDirty) TE.ResetIsDirty();if (TEBrowserInfo.IsIE&&TE.HasFocus) TE.EditorDocument.body.setActive();TE.OnAfterSetHTML();TECommands.GetCommand('ShowBlocks').RestoreState();if (TE.Status!=0) return;if (TEConfig.Debug) TEDebug._GetWindow();TE.SetStatus(1);};function _TE_GetEditorAreaStyleTags(){var A='';var B=TEConfig.EditorAreaCSS;var C=TEConfig.EditorAreaStyles;for (var i=0;i<B.length;i++) A+='<link href="'+B[i]+'" rel="stylesheet" type="text/css" />';if (C&&C.length>0) A+="<style>"+C+"</style>";return A;};function _TE_KeystrokeHandler_OnKeystroke(A,B){if (TE.Status!=2) return false;if (TE.EditMode==0){switch (B){case 'Paste':return!TE.Paste();case 'Cut':TEUndo.SaveUndoStep();return false;}}else{if (B.Equals('Paste','Undo','Redo','SelectAll','Cut')) return false;};var C=TE.Commands.GetCommand(B);return (C.Execute.apply(C,TETools.ArgumentsToArray(arguments,2))!==false);};(function(){var A=window.parent.document;var B=A.getElementById(TE.Name);var i=0;while (B||i==0){if (B&&B.tagName.toLowerCase().Equals('input','textarea')){TE.LinkedField=B;break;};B=A.getElementsByName(TE.Name)[i++];}})();var TETempBin={Elements:[],AddElement:function(A){var B=this.Elements.length;this.Elements[B]=A;return B;},RemoveElement:function(A){var e=this.Elements[A];this.Elements[A]=null;return e;},Reset:function(){var i=0;while (i<this.Elements.length) this.Elements[i++]=null;this.Elements.length=0;}};var TEFocusManager=TE.FocusManager={IsLocked:false,AddWindow:function(A,B){var C;if (TEBrowserInfo.IsIE) C=A.nodeType==1?A:A.frameElement?A.frameElement:A.document;else if (TEBrowserInfo.IsSafari) C=A;else C=A.document;TETools.AddEventListener(C,'blur',TEFocusManager_Win_OnBlur);TETools.AddEventListener(C,'focus',B?TEFocusManager_Win_OnFocus_Area:TEFocusManager_Win_OnFocus);},RemoveWindow:function(A){if (TEBrowserInfo.IsIE) oTarget=A.nodeType==1?A:A.frameElement?A.frameElement:A.document;else oTarget=A.document;TETools.RemoveEventListener(oTarget,'blur',TEFocusManager_Win_OnBlur);TETools.RemoveEventListener(oTarget,'focus',TEFocusManager_Win_OnFocus_Area);TETools.RemoveEventListener(oTarget,'focus',TEFocusManager_Win_OnFocus);},Lock:function(){this.IsLocked=true;},Unlock:function(){if (this._HasPendingBlur) TEFocusManager._Timer=window.setTimeout(TEFocusManager_FireOnBlur,100);this.IsLocked=false;},_ResetTimer:function(){this._HasPendingBlur=false;if (this._Timer){window.clearTimeout(this._Timer);delete this._Timer;}}};function TEFocusManager_Win_OnBlur(){if (typeof(TE)!='undefined'&&TE.HasFocus){TEFocusManager._ResetTimer();TEFocusManager._Timer=window.setTimeout(TEFocusManager_FireOnBlur,100);}};function TEFocusManager_FireOnBlur(){if (TEFocusManager.IsLocked) TEFocusManager._HasPendingBlur=true;else{TE.HasFocus=false;TE.Events.FireEvent("OnBlur");}};function TEFocusManager_Win_OnFocus_Area(){TE.Focus();TEFocusManager_Win_OnFocus();};function TEFocusManager_Win_OnFocus(){TEFocusManager._ResetTimer();if (!TE.HasFocus&&!TEFocusManager.IsLocked){TE.HasFocus=true;TE.Events.FireEvent("OnFocus");}};
TE.Description="Telligent_Editor for Internet Explorer 5.5+";TE._GetBehaviorsStyle=function(){if (!TE._BehaviorsStyle){var A=TEConfig.FullBasePath;var B='';var C;C='<style type="text/css" _tetemp="true">';if (TEConfig.ShowBorders) B='url('+A+'css/behaviors/showtableborders.htc)';C+='INPUT,TEXTAREA,SELECT,.TE__Anchor,.TE__PageBreak,.TE__InputHidden';if (TEConfig.DisableObjectResizing){C+=',IMG';B+=' url('+A+'css/behaviors/disablehandles.htc)';};C+=' { behavior: url('+A+'css/behaviors/disablehandles.htc) ; }';if (B.length>0) C+='TABLE { behavior: '+B+' ; }';C+='</style>';TE._BehaviorsStyle=C;};return TE._BehaviorsStyle;};function Doc_OnMouseUp(){if (TE.EditorWindow.event.srcElement.tagName=='HTML'){TE.Focus();TE.EditorWindow.event.cancelBubble=true;TE.EditorWindow.event.returnValue=false;}};function Doc_OnPaste(){var A=TE.EditorDocument.body;A.detachEvent('onpaste',Doc_OnPaste);var B=TE.Paste(!TEConfig.ForcePasteAsPlainText&&!TEConfig.AutoDetectPasteFromWord);A.attachEvent('onpaste',Doc_OnPaste);return B;};function Doc_OnDblClick(){TE.OnDoubleClick(TE.EditorWindow.event.srcElement);TE.EditorWindow.event.cancelBubble=true;};function Doc_OnSelectionChange(){if (TE.EditorDocument) TE.Events.FireEvent("OnSelectionChange");};function Doc_OnDrop(){if (TE.MouseDownFlag){TE.MouseDownFlag=false;return;};var A=TE.EditorWindow.event;if (TEConfig.ForcePasteAsPlainText){if (TE._CheckIsPastingEnabled()||TEConfig.ShowDropDialog) TE.PasteAsPlainText(A.dataTransfer.getData('Text'));}else{if (TEConfig.ShowDropDialog) TETools.RunFunction(TEDialog.OpenDialog,TEDialog,['TEDialog_Paste',TELang.Paste,'dialog/te_paste.html',400,330,'Security']);};A.returnValue=false;A.cancelBubble=true;};TE.InitializeBehaviors=function(A){this.EditorDocument.attachEvent('onmouseup',Doc_OnMouseUp);this.EditorDocument.body.attachEvent('onpaste',Doc_OnPaste);this.EditorDocument.body.attachEvent('ondrop',Doc_OnDrop);TE.ContextMenu._InnerContextMenu.AttachToElement(TE.EditorDocument.body);this.EditorDocument.attachEvent("onkeydown",TE._KeyDownListener);this.EditorDocument.attachEvent("ondblclick",Doc_OnDblClick);this.EditorDocument.attachEvent("onselectionchange",Doc_OnSelectionChange);};TE.InsertHtml=function(A){A=TEConfig.ProtectedSource.Protect(A);A=TE.ProtectEvents(A);A=TE.ProtectUrls(A);A=TE.ProtectTags(A);TE.EditorWindow.focus();TEUndo.SaveUndoStep();var B=TE.EditorDocument.selection;if (B.type.toLowerCase()=='control') B.clear();A='<span id="__fakeTERemove__">&nbsp;</span>'+A;B.createRange().pasteHTML(A);TE.EditorDocument.getElementById('__fakeTERemove__').removeNode(true);TEDocumentProcessor.Process(TE.EditorDocument);this.Events.FireEvent("OnSelectionChange");};TE.SetInnerHtml=function(A){var B=TE.EditorDocument;B.body.innerHTML='<div id="__fakeTERemove__">&nbsp;</div>'+A;B.getElementById('__fakeTERemove__').removeNode(true);};function TE_PreloadImages(){var A=new TEImagePreloader();A.AddImages(TEConfig.PreloadImages);A.AddImages(TEConfig.SkinPath+'te_strip.gif');A.OnComplete=LoadToolbarSetup;A.Start();};function Document_OnContextMenu(){return (event.srcElement._TEShowContextMenu==true);};document.oncontextmenu=Document_OnContextMenu;function TE_Cleanup(){this.LinkedField=null;this.EditorWindow=null;this.EditorDocument=null;};TE._ExecPaste=function(){if (TE._PasteIsRunning) return true;if (TEConfig.ForcePasteAsPlainText){TE.PasteAsPlainText();return false;};var A=TE._CheckIsPastingEnabled(true);if (A===false) TETools.RunFunction(TEDialog.OpenDialog,TEDialog,['TEDialog_Paste',TELang.Paste,'dialog/te_paste.html',400,330,'Security']);else{if (TEConfig.AutoDetectPasteFromWord&&A.length>0){var B=/<\w[^>]*(( class="?MsoNormal"?)|(="mso-))/gi;if (B.test(A)){if (confirm(TELang.PasteWordConfirm)){TE.PasteFromWord();return false;}}};TE._PasteIsRunning=true;TE.ExecuteNamedCommand('Paste');delete TE._PasteIsRunning;};return false;};TE.PasteAsPlainText=function(A){if (!TE._CheckIsPastingEnabled()){TEDialog.OpenDialog('TEDialog_Paste',TELang.PasteAsText,'dialog/te_paste.html',400,330,'PlainText');return;};var B=null;if (!A) B=clipboardData.getData("Text");else B=A;if (B&&B.length>0){B=TETools.HTMLEncode(B);B=TETools.ProcessLineBreaks(window,TEConfig,B);var C=B.search('</p>');var D=B.search('<p>');if ((C!=-1&&D!=-1&&C<D)||(C!=-1&&D==-1)){var E=B.substr(0,C);B=B.substr(C+4);this.InsertHtml(E);};TEUndo.SaveLocked=true;this.InsertHtml(B);TEUndo.SaveLocked=false;}};TE._CheckIsPastingEnabled=function(A){TE._PasteIsEnabled=false;document.body.attachEvent('onpaste',TE_CheckPasting_Listener);var B=TE.GetClipboardHTML();document.body.detachEvent('onpaste',TE_CheckPasting_Listener);if (TE._PasteIsEnabled){if (!A) B=true;}else B=false;delete TE._PasteIsEnabled;return B;};function TE_CheckPasting_Listener(){TE._PasteIsEnabled=true;};TE.GetClipboardHTML=function(){var A=document.getElementById('___TEHiddenDiv');if (!A){A=document.createElement('DIV');A.id='___TEHiddenDiv';var B=A.style;B.position='absolute';B.visibility=B.overflow='hidden';B.width=B.height=1;document.body.appendChild(A);};A.innerHTML='';var C=document.body.createTextRange();C.moveToElementText(A);C.execCommand('Paste');var D=A.innerHTML;A.innerHTML='';return D;};TE.CreateLink=function(A,B){var C=[];TE.ExecuteNamedCommand('Unlink',null,false,!!B);if (A.length>0){if (TESelection.GetType()=='Control'){var D=this.EditorDocument.createElement('A');D.href=A;var E=TESelection.GetSelectedElement();E.parentNode.insertBefore(D,E);E.parentNode.removeChild(E);D.appendChild(E);return [D];};var F='javascript:void(0);/*'+(new Date().getTime())+'*/';TE.ExecuteNamedCommand('CreateLink',F,false,!!B);var G=this.EditorDocument.links;for (i=0;i<G.length;i++){var D=G[i];if (D.getAttribute('href',2)==F){var I=D.innerHTML;D.href=A;D.innerHTML=I;var J=D.lastChild;if (J&&J.nodeName=='BR'){TEDomTools.InsertAfterNode(D,D.removeChild(J));};C.push(D);}}};return C;};
var TEConfig=TE.Config={};if (document.location.protocol=='file:'){TEConfig.BasePath=decodeURIComponent(document.location.pathname.substr(1));TEConfig.BasePath=TEConfig.BasePath.replace(/\\/gi, '/');var sFullProtocol=document.location.href.match(/^(file\:\/{2,3})/)[1];if (TEBrowserInfo.IsOpera) sFullProtocol+='localhost/';TEConfig.BasePath=sFullProtocol+TEConfig.BasePath.substring(0,TEConfig.BasePath.lastIndexOf('/')+1);TEConfig.FullBasePath=TEConfig.BasePath;}else{TEConfig.BasePath=document.location.pathname.substring(0,document.location.pathname.lastIndexOf('/')+1);TEConfig.FullBasePath=document.location.protocol+'//'+document.location.host+TEConfig.BasePath;};TEConfig.EditorPath=TEConfig.BasePath.replace(/editor\/$/,'');try{TEConfig.ScreenWidth=screen.width;TEConfig.ScreenHeight=screen.height;}catch (e){TEConfig.ScreenWidth=800;TEConfig.ScreenHeight=600;};TEConfig.ProcessHiddenField=function(){this.PageConfig={};var A=window.parent.document.getElementById(TE.Name+'___Config');if (!A) return;var B=A.value.split('&');for (var i=0;i<B.length;i++){if (B[i].length==0) continue;var C=B[i].split('=');var D=decodeURIComponent(C[0]);var E=decodeURIComponent(C[1]);if (D=='CustomConfigurationsPath') TEConfig[D]=E;else if (E.toLowerCase()=="true") this.PageConfig[D]=true;else if (E.toLowerCase()=="false") this.PageConfig[D]=false;else if (E.length>0&&!isNaN(E)) this.PageConfig[D]=parseInt(E,10);else this.PageConfig[D]=E;}};function TEConfig_LoadPageConfig(){var A=TEConfig.PageConfig;for (var B in A) TEConfig[B]=A[B];};function TEConfig_PreProcess(){var A=TEConfig;if (A.AllowQueryStringDebug){try{if ((/tedebug=true/i).test(window.top.location.search)) A.Debug=true;}catch (e) {/*Ignore it. Much probably we are inside a FRAME where the "top" is in another domain (security error).*/}};if (!A.PluginsPath.EndsWith('/')) A.PluginsPath+='/';if (typeof(A.EditorAreaCSS)=='string') A.EditorAreaCSS=A.EditorAreaCSS.split(',');var B=A.ToolbarComboPreviewCSS;if (!B||B.length==0) A.ToolbarComboPreviewCSS=A.EditorAreaCSS;else if (typeof(B)=='string') A.ToolbarComboPreviewCSS=[B];};TEConfig.ToolbarSets={};TEConfig.Plugins={};TEConfig.Plugins.Items=[];TEConfig.Plugins.Add=function(A,B,C){TEConfig.Plugins.Items.AddItem([A,B,C]);};TEConfig.ProtectedSource={};TEConfig.ProtectedSource._CodeTag=(new Date()).valueOf();TEConfig.ProtectedSource.RegexEntries=[/<!--[\s\S]*?-->/g,/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi,/<object[\s\S]+?<\/object>/gi];TEConfig.ProtectedSource.Add=function(A){this.RegexEntries.AddItem(A);};TEConfig.ProtectedSource.Protect=function(A){var B=this._CodeTag;function _Replace(protectedSource){var C=TETempBin.AddElement(protectedSource);return '<!--{'+B+C+'}-->';};for (var i=0;i<this.RegexEntries.length;i++){A=A.replace(this.RegexEntries[i],_Replace);};return A;};TEConfig.ProtectedSource.Revert=function(A,B){function _Replace(m,opener,index){var C=B?TETempBin.RemoveElement(index):TETempBin.Elements[index];return TEConfig.ProtectedSource.Revert(C,B);};var D=new RegExp("(<|&lt;)!--\\{"+this._CodeTag+"(\\d+)\\}--(>|&gt;)","g");return A.replace(D,_Replace);};TEConfig.GetBodyAttributes=function(){var A='';if (this.BodyId&&this.BodyId.length>0) A+=' id="'+this.BodyId+'"';if (this.BodyClass&&this.BodyClass.length>0) A+=' class="'+this.BodyClass+'"';return A;};TEConfig.ApplyBodyAttributes=function(A){if (this.BodyId&&this.BodyId.length>0) A.id=TEConfig.BodyId;if (this.BodyClass&&this.BodyClass.length>0) A.className+=' '+TEConfig.BodyClass;};
var TEDebug={};TEDebug._GetWindow=function(){if (!this.DebugWindow||this.DebugWindow.closed) this.DebugWindow=window.open(TEConfig.BasePath+'tedebug.html','Telligent_EditorDebug','menubar=no,scrollbars=yes,resizable=yes,location=no,toolbar=no,width=600,height=500',true);return this.DebugWindow;};TEDebug.Output=function(A,B,C){if (!TEConfig.Debug) return;try{this._GetWindow().Output(A,B);}catch (e) {}};TEDebug.OutputObject=function(A,B){if (!TEConfig.Debug) return;try{this._GetWindow().OutputObject(A,B);}catch (e) {}}
var TEDomTools={MoveChildren:function(A,B,C){if (A==B) return;var D;if (C){while ((D=A.lastChild)) B.insertBefore(A.removeChild(D),B.firstChild);}else{while ((D=A.firstChild)) B.appendChild(A.removeChild(D));}},MoveNode:function(A,B,C){if (C) B.insertBefore(TEDomTools.RemoveNode(A),B.firstChild);else B.appendChild(TEDomTools.RemoveNode(A));},TrimNode:function(A){this.LTrimNode(A);this.RTrimNode(A);},LTrimNode:function(A){var B;while ((B=A.firstChild)){if (B.nodeType==3){var C=B.nodeValue.LTrim();var D=B.nodeValue.length;if (C.length==0){A.removeChild(B);continue;}else if (C.length<D){B.splitText(D-C.length);A.removeChild(A.firstChild);}};break;}},RTrimNode:function(A){var B;while ((B=A.lastChild)){if (B.nodeType==3){var C=B.nodeValue.RTrim();var D=B.nodeValue.length;if (C.length==0){B.parentNode.removeChild(B);continue;}else if (C.length<D){B.splitText(C.length);A.lastChild.parentNode.removeChild(A.lastChild);}};break;};if (!TEBrowserInfo.IsIE&&!TEBrowserInfo.IsOpera){B=A.lastChild;if (B&&B.nodeType==1&&B.nodeName.toLowerCase()=='br'){B.parentNode.removeChild(B);}}},RemoveNode:function(A,B){if (B){var C;while ((C=A.firstChild)) A.parentNode.insertBefore(A.removeChild(C),A);};return A.parentNode.removeChild(A);},GetFirstChild:function(A,B){if (typeof (B)=='string') B=[B];var C=A.firstChild;while(C){if (C.nodeType==1&&C.tagName.Equals.apply(C.tagName,B)) return C;C=C.nextSibling;};return null;},GetLastChild:function(A,B){if (typeof (B)=='string') B=[B];var C=A.lastChild;while(C){if (C.nodeType==1&&(!B||C.tagName.Equals(B))) return C;C=C.previousSibling;};return null;},GetPreviousSourceElement:function(A,B,C,D){if (!A) return null;if (C&&A.nodeType==1&&A.nodeName.IEquals(C)) return null;if (A.previousSibling) A=A.previousSibling;else return this.GetPreviousSourceElement(A.parentNode,B,C,D);while (A){if (A.nodeType==1){if (C&&A.nodeName.IEquals(C)) break;if (!D||!A.nodeName.IEquals(D)) return A;}else if (B&&A.nodeType==3&&A.nodeValue.RTrim().length>0) break;if (A.lastChild) A=A.lastChild;else return this.GetPreviousSourceElement(A,B,C,D);};return null;},GetNextSourceElement:function(A,B,C,D,E){while((A=this.GetNextSourceNode(A,E))){if (A.nodeType==1){if (C&&A.nodeName.IEquals(C)) break;if (D&&A.nodeName.IEquals(D)) return this.GetNextSourceElement(A,B,C,D);return A;}else if (B&&A.nodeType==3&&A.nodeValue.RTrim().length>0) break;};return null;},GetNextSourceNode:function(A,B,C,D){if (!A) return null;var E;if (!B&&A.firstChild) E=A.firstChild;else{if (D&&A==D) return null;E=A.nextSibling;if (!E&&(!D||D!=A.parentNode)) return this.GetNextSourceNode(A.parentNode,true,C,D);};if (C&&E&&E.nodeType!=C) return this.GetNextSourceNode(E,false,C,D);return E;},GetPreviousSourceNode:function(A,B,C,D){if (!A) return null;var E;if (!B&&A.lastChild) E=A.lastChild;else{if (D&&A==D) return null;E=A.previousSibling;if (!E&&(!D||D!=A.parentNode)) return this.GetPreviousSourceNode(A.parentNode,true,C,D);};if (C&&E&&E.nodeType!=C) return this.GetPreviousSourceNode(E,false,C,D);return E;},InsertAfterNode:function(A,B){return A.parentNode.insertBefore(B,A.nextSibling);},GetParents:function(A){var B=[];while (A){B.unshift(A);A=A.parentNode;};return B;},GetCommonParents:function(A,B){var C=this.GetParents(A);var D=this.GetParents(B);var E=[];for (var i=0;i<C.length;i++){if (C[i]==D[i]) E.push(C[i]);};return E;},GetCommonParentNode:function(A,B,C){var D={};if (!C.pop) C=[C];while (C.length>0) D[C.pop().toLowerCase()]=1;var E=this.GetCommonParents(A,B);var F=null;while ((F=E.pop())){if (D[F.nodeName.toLowerCase()]) return F;};return null;},GetIndexOf:function(A){var B=A.parentNode?A.parentNode.firstChild:null;var C=-1;while (B){C++;if (B==A) return C;B=B.nextSibling;};return-1;},PaddingNode:null,EnforcePaddingNode:function(A,B){try{if (!A||!A.body) return;}catch (e){return;};this.CheckAndRemovePaddingNode(A,B,true);try{if (A.body.lastChild&&(A.body.lastChild.nodeType!=1||A.body.lastChild.tagName.toLowerCase()==B.toLowerCase())) return;}catch (e){return;};var C=A.createElement(B);if (TEBrowserInfo.IsGecko&&TEListsLib.NonEmptyBlockElements[B]) TETools.AppendBogusBr(C);this.PaddingNode=C;if (A.body.childNodes.length==1&&A.body.firstChild.nodeType==1&&A.body.firstChild.tagName.toLowerCase()=='br'&&(A.body.firstChild.getAttribute('_moz_dirty')!=null||A.body.firstChild.getAttribute('type')=='_moz')) A.body.replaceChild(C,A.body.firstChild);else A.body.appendChild(C);},CheckAndRemovePaddingNode:function(A,B,C){var D=this.PaddingNode;if (!D) return;try{if (D.parentNode!=A.body||D.tagName.toLowerCase()!=B||(D.childNodes.length>1)||(D.firstChild&&D.firstChild.nodeValue!='\xa0'&&String(D.firstChild.tagName).toLowerCase()!='br')){this.PaddingNode=null;return;}}catch (e){this.PaddingNode=null;return;};if (!C){if (D.parentNode.childNodes.length>1) D.parentNode.removeChild(D);this.PaddingNode=null;}},HasAttribute:function(A,B){if (A.hasAttribute) return A.hasAttribute(B);else{var C=A.attributes[B];return (C!=undefined&&C.specified);}},HasAttributes:function(A){var B=A.attributes;for (var i=0;i<B.length;i++){if (TEBrowserInfo.IsIE&&B[i].nodeName=='class'){if (A.className.length>0) return true;}else if (B[i].specified) return true;};return false;},RemoveAttribute:function(A,B){if (TEBrowserInfo.IsIE&&B.toLowerCase()=='class') B='className';return A.removeAttribute(B,0);},GetAttributeValue:function(A,B){var C=B;if (typeof B=='string') B=A.attributes[B];else C=B.nodeName;if (B&&B.specified){if (C=='style') return A.style.cssText;else if (C=='class'||C.indexOf('on')==0) return B.nodeValue;else{return A.getAttribute(C,2);}};return null;},Contains:function(A,B){if (A.contains&&B.nodeType==1) return A.contains(B);while ((B=B.parentNode)){if (B==A) return true;};return false;},BreakParent:function(A,B,C){var D=C||new TEDomRange(TETools.GetElementWindow(A));D.SetStart(A,4);D.SetEnd(B,4);var E=D.ExtractContents();D.InsertNode(A.parentNode.removeChild(A));E.InsertAfterNode(A);D.Release(!!C);},GetNodeAddress:function(A,B){var C=[];while (A&&A!=A.ownerDocument.documentElement){var D=A.parentNode;var E=-1;for(var i=0;i<D.childNodes.length;i++){var F=D.childNodes[i];if (B===true&&F.nodeType==3&&F.previousSibling&&F.previousSibling.nodeType==3) continue;E++;if (D.childNodes[i]==A) break;};C.unshift(E);A=A.parentNode;};return C;},GetNodeFromAddress:function(A,B,C){var D=A.documentElement;for (var i=0;i<B.length;i++){var E=B[i];if (!C){D=D.childNodes[E];continue;};var F=-1;for (var j=0;j<D.childNodes.length;j++){var G=D.childNodes[j];if (C===true&&G.nodeType==3&&G.previousSibling&&G.previousSibling.nodeType==3) continue;F++;if (F==E){D=G;break;}}};return D;},CloneElement:function(A){A=A.cloneNode(false);A.removeAttribute('id',false);return A;},ClearElementJSProperty:function(A,B){if (TEBrowserInfo.IsIE) A.removeAttribute(B);else delete A[B];},SetElementMarker:function (A,B,C,D){var E=String(parseInt(Math.random()*0xfffffff,10));B._TEMarkerId=E;B[C]=D;if (!A[E]) A[E]={ 'element':B,'markers':{} };A[E]['markers'][C]=D;},ClearElementMarkers:function(A,B,C){var D=B._TEMarkerId;if (!D) return;this.ClearElementJSProperty(B,'_TEMarkerId');for (var j in A[D]['markers']) this.ClearElementJSProperty(B,j);if (C) delete A[D];},ClearAllMarkers:function(A){for (var i in A) this.ClearElementMarkers(A,A[i]['element'],true);},ListToArray:function(A,B,C,D,E){if (!A.nodeName.IEquals(['ul','ol'])) return [];if (!D) D=0;if (!C) C=[];for (var i=0;i<A.childNodes.length;i++){var F=A.childNodes[i];if (!F.nodeName.IEquals('li')) continue;var G={ 'parent':A,'indent':D,'contents':[] };if (!E){G.grandparent=A.parentNode;if (G.grandparent&&G.grandparent.nodeName.IEquals('li')) G.grandparent=G.grandparent.parentNode;}else G.grandparent=E;if (B) this.SetElementMarker(B,F,'_TE_ListArray_Index',C.length);C.push(G);for (var j=0;j<F.childNodes.length;j++){var H=F.childNodes[j];if (H.nodeName.IEquals(['ul','ol'])) this.ListToArray(H,B,C,D+1,G.grandparent);else G.contents.push(H);}};return C;},ArrayToList:function(A,B,C){if (C==undefined) C=0;if (!A||A.length<C+1) return null;var D=A[C].parent.ownerDocument;var E=D.createDocumentFragment();var F=null;var G=C;var H=Math.max(A[C].indent,0);var I=null;while (true){var J=A[G];if (J.indent==H){if (!F||A[G].parent.nodeName!=F.nodeName){F=A[G].parent.cloneNode(false);E.appendChild(F);};I=D.createElement('li');F.appendChild(I);for (var i=0;i<J.contents.length;i++) I.appendChild(J.contents[i].cloneNode(true));G++;}else if (J.indent==Math.max(H,0)+1){var K=this.ArrayToList(A,null,G);I.appendChild(K.listNode);G=K.nextIndex;}else if (J.indent==-1&&C==0&&J.grandparent){var I;if (J.grandparent.nodeName.IEquals(['ul','ol'])) I=D.createElement('li');else{if (TEConfig.EnterMode.IEquals(['div','p'])&&!J.grandparent.nodeName.IEquals('td')) I=D.createElement(TEConfig.EnterMode);else I=D.createDocumentFragment();};for (var i=0;i<J.contents.length;i++) I.appendChild(J.contents[i].cloneNode(true));if (I.nodeType==11){if (I.lastChild&&I.lastChild.getAttribute&&I.lastChild.getAttribute('type')=='_moz') I.removeChild(I.lastChild);I.appendChild(D.createElement('br'));};if (I.nodeName.IEquals(TEConfig.EnterMode)&&I.firstChild){this.TrimNode(I);if (TEListsLib.BlockBoundaries[I.firstChild.nodeName.toLowerCase()]){var M=D.createDocumentFragment();while (I.firstChild) M.appendChild(I.removeChild(I.firstChild));I=M;}};if (TEBrowserInfo.IsGeckoLike&&I.nodeName.IEquals(['div','p'])) TETools.AppendBogusBr(I);E.appendChild(I);F=null;G++;}else return null;if (A.length<=G||Math.max(A[G].indent,0)<H){break;}};if (B){var N=E.firstChild;while (N){if (N.nodeType==1) this.ClearElementMarkers(B,N);N=this.GetNextSourceNode(N);}};return { 'listNode':E,'nextIndex':G };},GetNextSibling:function(A,B){A=A.nextSibling;while (A&&!B&&A.nodeType!=1&&(A.nodeType!=3||A.nodeValue.length==0)) A=A.nextSibling;return A;},GetPreviousSibling:function(A,B){A=A.previousSibling;while (A&&!B&&A.nodeType!=1&&(A.nodeType!=3||A.nodeValue.length==0)) A=A.previousSibling;return A;},CheckIsEmptyElement:function(A,B){var C=A.firstChild;var D;while (C){if (C.nodeType==1){if (D||!TEListsLib.InlineNonEmptyElements[C.nodeName.toLowerCase()]) return false;if (!B||B(C)===true) D=C;}else if (C.nodeType==3&&C.nodeValue.length>0) return false;C=C.nextSibling;};return D?this.CheckIsEmptyElement(D,B):true;},SetElementStyles:function(A,B){var C=A.style;for (var D in B) C[D]=B[D];},GetCurrentElementStyle:function(w,A,B){if (TEBrowserInfo.IsIE) return A.currentStyle[B];else return w.getComputedStyle(A,'')[B];},GetPositionedAncestor:function(w,A){var B=A;while (B!=B.ownerDocument.documentElement){if (this.GetCurrentElementStyle(w,B,'position')!='static') return B;B=B.parentNode;};return null;},ScrollIntoView:function(A,B){var C=TETools.GetElementWindow(A);var D=TETools.GetViewPaneSize(C).Height;var E=D*-1;if (B===false){E+=A.offsetHeight;E+=parseInt(this.GetCurrentElementStyle(C,A,'marginBottom')||0,10);};E+=A.offsetTop;while ((A=A.offsetParent)) E+=A.offsetTop||0;var F=TETools.GetScrollPosition(C).Y;if (E>0&&E>F) C.scrollTo(0,E);}};
var TETools={};TETools.CreateBogusBR=function(A){var B=A.createElement('br');B.setAttribute('type','_moz');return B;};TETools.AppendStyleSheet=function(A,B){if (typeof(B)=='string') return this._AppendStyleSheet(A,B);else{var C=[];for (var i=0;i<B.length;i++) C.push(this._AppendStyleSheet(A,B[i]));return C;}};TETools.AppendStyleString=function (A,B){this._AppendStyleString(A,B);};TETools.GetElementDocument=function (A){return A.ownerDocument||A.document;};TETools.GetElementWindow=function(A){return this.GetDocumentWindow(this.GetElementDocument(A));};TETools.GetDocumentWindow=function(A){if (TEBrowserInfo.IsSafari&&!A.parentWindow) this.FixDocumentParentWindow(window.top);return A.parentWindow||A.defaultView;};TETools.FixDocumentParentWindow=function(A){if (A.document) A.document.parentWindow=A;for (var i=0;i<A.frames.length;i++) TETools.FixDocumentParentWindow(A.frames[i]);};TETools.HTMLEncode=function(A){if (!A) return '';A=A.replace(/&/g,'&amp;');A=A.replace(/</g,'&lt;');A=A.replace(/>/g,'&gt;');return A;};TETools.HTMLDecode=function(A){if (!A) return '';A=A.replace(/&gt;/g,'>');A=A.replace(/&lt;/g,'<');A=A.replace(/&amp;/g,'&');return A;};TETools._ProcessLineBreaksForPMode=function(A,B,C,D,E){var F=0;var G="<p>";var H="</p>";var I="<br />";if (C){G="<li>";H="</li>";F=1;};while (D&&D!=A.TE.EditorDocument.body){if (D.tagName.toLowerCase()=='p'){F=1;break;};D=D.parentNode;};for (var i=0;i<B.length;i++){var c=B.charAt(i);if (c=='\r') continue;if (c!='\n'){E.push(c);continue;};var n=B.charAt(i+1);if (n=='\r'){i++;n=B.charAt(i+1);};if (n=='\n'){i++;if (F) E.push(H);E.push(G);F=1;}else E.push(I);}};TETools._ProcessLineBreaksForDivMode=function(A,B,C,D,E){var F=0;var G="<div>";var H="</div>";if (C){G="<li>";H="</li>";F=1;};while (D&&D!=A.TE.EditorDocument.body){if (D.tagName.toLowerCase()=='div'){F=1;break;};D=D.parentNode;};for (var i=0;i<B.length;i++){var c=B.charAt(i);if (c=='\r') continue;if (c!='\n'){E.push(c);continue;};if (F){if (E[E.length-1]==G){E.push("&nbsp;");};E.push(H);};E.push(G);F=1;};if (F) E.push(H);};TETools._ProcessLineBreaksForBrMode=function(A,B,C,D,E){var F=0;var G="<br />";var H="";if (C){G="<li>";H="</li>";F=1;};for (var i=0;i<B.length;i++){var c=B.charAt(i);if (c=='\r') continue;if (c!='\n'){E.push(c);continue;};if (F&&H.length) E.push (H);E.push(G);F=1;}};TETools.ProcessLineBreaks=function(A,B,C){var D=B.EnterMode.toLowerCase();var E=[];var F=0;var G=new A.TEDomRange(A.TE.EditorWindow);G.MoveToSelection();var H=G._Range.startContainer;while (H&&H.nodeType!=1) H=H.parentNode;if (H&&H.tagName.toLowerCase()=='li') F=1;if (D=='p') this._ProcessLineBreaksForPMode(A,C,F,H,E);else if (D=='div') this._ProcessLineBreaksForDivMode(A,C,F,H,E);else if (D=='br') this._ProcessLineBreaksForBrMode(A,C,F,H,E);return E.join("");};TETools.AddSelectOption=function(A,B,C){var D=TETools.GetElementDocument(A).createElement("OPTION");D.text=B;D.value=C;A.options.add(D);return D;};TETools.RunFunction=function(A,B,C,D){if (A) this.SetTimeout(A,0,B,C,D);};TETools.SetTimeout=function(A,B,C,D,E){return (E||window).setTimeout(function(){if (D) A.apply(C,[].concat(D));else A.apply(C);},B);};TETools.SetInterval=function(A,B,C,D,E){return (E||window).setInterval(function(){A.apply(C,D||[]);},B);};TETools.ConvertStyleSizeToHtml=function(A){return A.EndsWith('%')?A:parseInt(A,10);};TETools.ConvertHtmlSizeToStyle=function(A){return A.EndsWith('%')?A:(A+'px');};TETools.GetElementAscensor=function(A,B){var e=A;var C=","+B.toUpperCase()+",";while (e){if (C.indexOf(","+e.nodeName.toUpperCase()+",")!=-1) return e;e=e.parentNode;};return null;};TETools.CreateEventListener=function(A,B){var f=function(){var C=[];for (var i=0;i<arguments.length;i++) C.push(arguments[i]);A.apply(this,C.concat(B));};return f;};TETools.IsStrictMode=function(A){return ('CSS1Compat'==(A.compatMode||'CSS1Compat'));};TETools.ArgumentsToArray=function(A,B,C){B=B||0;C=C||A.length;var D=[];for (var i=B;i<B+C&&i<A.length;i++) D.push(A[i]);return D;};TETools.CloneObject=function(A){var B=function() {};B.prototype=A;return new B;};TETools.AppendBogusBr=function(A){if (!A) return;var B=this.GetLastItem(A.getElementsByTagName('br'));if (!B||(B.getAttribute('type',2)!='_moz'&&B.getAttribute('_moz_dirty')==null)){var C=this.GetElementDocument(A);if (TEBrowserInfo.IsOpera) A.appendChild(C.createTextNode(''));else A.appendChild(this.CreateBogusBR(C));}};TETools.GetLastItem=function(A){if (A.length>0) return A[A.length-1];return null;};TETools.GetDocumentPosition=function(w,A){var x=0;var y=0;var B=A;var C=null;var D=TETools.GetElementWindow(B);while (B&&!(D==w&&(B==w.document.body||B==w.document.documentElement))){x+=B.offsetLeft-B.scrollLeft;y+=B.offsetTop-B.scrollTop;if (!TEBrowserInfo.IsOpera){var E=C;while (E&&E!=B){x-=E.scrollLeft;y-=E.scrollTop;E=E.parentNode;}};C=B;if (B.offsetParent) B=B.offsetParent;else{if (D!=w){B=D.frameElement;C=null;if (B) D=TETools.GetElementWindow(B);}else B=null;}};if (TEDomTools.GetCurrentElementStyle(w,w.document.body,'position')!='static'||(TEBrowserInfo.IsIE&&TEDomTools.GetPositionedAncestor(w,A)==null)){x+=w.document.body.offsetLeft;y+=w.document.body.offsetTop;};return { "x":x,"y":y };};TETools.GetWindowPosition=function(w,A){var B=this.GetDocumentPosition(w,A);var C=TETools.GetScrollPosition(w);B.x-=C.X;B.y-=C.Y;return B;};TETools.ProtectFormStyles=function(A){if (!A||A.nodeType!=1||A.tagName.toLowerCase()!='form') return [];var B=[];var C=['style','className'];for (var i=0;i<C.length;i++){var D=C[i];if (A.elements.namedItem(D)){var E=A.elements.namedItem(D);B.push([E,E.nextSibling]);A.removeChild(E);}};return B;};TETools.RestoreFormStyles=function(A,B){if (!A||A.nodeType!=1||A.tagName.toLowerCase()!='form') return;if (B.length>0){for (var i=B.length-1;i>=0;i--){var C=B[i][0];var D=B[i][1];if (D) A.insertBefore(C,D);else A.appendChild(C);}}};TETools.GetNextNode=function(A,B){if (A.firstChild) return A.firstChild;else if (A.nextSibling) return A.nextSibling;else{var C=A.parentNode;while (C){if (C==B) return null;if (C.nextSibling) return C.nextSibling;else C=C.parentNode;}};return null;};TETools.GetNextTextNode=function(A,B,C){node=this.GetNextNode(A,B);if (C&&node&&C(node)) return null;while (node&&node.nodeType!=3){node=this.GetNextNode(node,B);if (C&&node&&C(node)) return null;};return node;};TETools.Merge=function(){var A=arguments;var o=A[0];for (var i=1;i<A.length;i++){var B=A[i];for (var p in B) o[p]=B[p];};return o;};TETools.IsArray=function(A){return (A instanceof Array);};TETools.AppendLengthProperty=function(A,B){var C=0;for (var n in A) C++;return A[B||'length']=C;};TETools.NormalizeCssText=function(A){var B=document.createElement('span');B.style.cssText=A;return B.style.cssText;};TETools.Hitch=function(A,B){return function() { A[B].apply(A,arguments);};};
TETools.CancelEvent=function(e){return false;};TETools._AppendStyleSheet=function(A,B){return A.createStyleSheet(B).owningElement;};TETools._AppendStyleString=function(A,B){var s=A.createStyleSheet("");s.cssText=B;return s;};TETools.ClearElementAttributes=function(A){A.clearAttributes();};TETools.GetAllChildrenIds=function(A){var B=[];for (var i=0;i<A.all.length;i++){var C=A.all[i].id;if (C&&C.length>0) B[B.length]=C;};return B;};TETools.RemoveOuterTags=function(e){e.insertAdjacentHTML('beforeBegin',e.innerHTML);e.parentNode.removeChild(e);};TETools.CreateXmlObject=function(A){var B;switch (A){case 'XmlHttp':B=['MSXML2.XmlHttp','Microsoft.XmlHttp'];break;case 'DOMDocument':B=['MSXML2.DOMDocument','Microsoft.XmlDom'];break;};for (var i=0;i<2;i++){try { return new ActiveXObject(B[i]);}catch (e){}};if (TELang.NoActiveX){alert(TELang.NoActiveX);TELang.NoActiveX=null;};return null;};TETools.DisableSelection=function(A){A.unselectable='on';var e,i=0;while ((e=A.all[i++])){switch (e.tagName){case 'IFRAME':case 'TEXTAREA':case 'INPUT':case 'SELECT':break;default:e.unselectable='on';}}};TETools.GetScrollPosition=function(A){var B=A.document;var C={ X:B.documentElement.scrollLeft,Y:B.documentElement.scrollTop };if (C.X>0||C.Y>0) return C;return { X:B.body.scrollLeft,Y:B.body.scrollTop };};TETools.AddEventListener=function(A,B,C){A.attachEvent('on'+B,C);};TETools.RemoveEventListener=function(A,B,C){A.detachEvent('on'+B,C);};TETools.AddEventListenerEx=function(A,B,C,D){var o={};o.Source=A;o.Params=D||[];o.Listener=function(ev){return C.apply(o.Source,[ev].concat(o.Params));};if (TE.IECleanup) TE.IECleanup.AddItem(null,function() { o.Source=null;o.Params=null;});A.attachEvent('on'+B,o.Listener);A=null;D=null;};TETools.GetViewPaneSize=function(A){var B;var C=A.document.documentElement;if (C&&C.clientWidth) B=C;else B=A.document.body;if (B) return { Width:B.clientWidth,Height:B.clientHeight };else return { Width:0,Height:0 };};TETools.SaveStyles=function(A){var B=TETools.ProtectFormStyles(A);var C={};if (A.className.length>0){C.Class=A.className;A.className='';};var D=A.style.cssText;if (D.length>0){C.Inline=D;A.style.cssText='';};TETools.RestoreFormStyles(A,B);return C;};TETools.RestoreStyles=function(A,B){var C=TETools.ProtectFormStyles(A);A.className=B.Class||'';A.style.cssText=B.Inline||'';TETools.RestoreFormStyles(A,C);};TETools.RegisterDollarFunction=function(A){A.$=A.document.getElementById;};TETools.AppendElement=function(A,B){return A.appendChild(this.GetElementDocument(A).createElement(B));};TETools.ToLowerCase=function(A){return A.toLowerCase();};
var Telligent_EditorAPI;function InitializeAPI(){var A=window.parent;if (!(Telligent_EditorAPI=A.Telligent_EditorAPI)){var B='var Telligent_EditorAPI = {Version : "2.5",VersionBuild : "17352",__Instances : new Object(),GetInstance : function( name ){return this.__Instances[ name ];},_FormSubmit : function(){for ( var name in Telligent_EditorAPI.__Instances ){var oEditor = Telligent_EditorAPI.__Instances[ name ] ;if ( oEditor.GetParentForm && oEditor.GetParentForm() == this )oEditor.UpdateLinkedField() ;}this._TEOriginalSubmit() ;},_FunctionQueue	: {Functions : new Array(),IsRunning : false,Add : function( f ){this.Functions.push( f );if ( !this.IsRunning )this.StartNext();},StartNext : function(){var aQueue = this.Functions ;if ( aQueue.length > 0 ){this.IsRunning = true;aQueue[0].call();}else this.IsRunning = false;},Remove : function( f ){var aQueue = this.Functions;var i = 0, fFunc;while( (fFunc = aQueue[ i ]) ){if ( fFunc == f )aQueue.splice( i,1 );i++ ;}this.StartNext();}}}';if (A.execScript) A.execScript(B,'JavaScript');else{if (TEBrowserInfo.IsGecko10){eval.call(A,B);}else if (TEBrowserInfo.IsSafari||TEBrowserInfo.IsGecko19){var C=A.document;var D=C.createElement('script');D.appendChild(C.createTextNode(B));C.documentElement.appendChild(D);}else A.eval(B);};Telligent_EditorAPI=A.Telligent_EditorAPI;};Telligent_EditorAPI.__Instances[TE.Name]=TE;};function _AttachFormSubmitToAPI(){var A=TE.GetParentForm();if (A){TETools.AddEventListener(A,'submit',TE.UpdateLinkedField);if (!A._TEOriginalSubmit&&(typeof(A.submit)=='function'||(!A.submit.tagName&&!A.submit.length))){A._TEOriginalSubmit=A.submit;A.submit=Telligent_EditorAPI._FormSubmit;}}};function Telligent_EditorAPI_Cleanup(){if (!window.TEUnloadFlag) return;delete Telligent_EditorAPI.__Instances[TE.Name];};function Telligent_EditorAPI_ConfirmCleanup(){window.TEUnloadFlag=true;};TETools.AddEventListener(window,'unload',Telligent_EditorAPI_Cleanup);TETools.AddEventListener(window,'beforeunload',Telligent_EditorAPI_ConfirmCleanup);
var TEImagePreloader=function(){this._Images=[];};TEImagePreloader.prototype={AddImages:function(A){if (typeof(A)=='string') A=A.split(';');this._Images=this._Images.concat(A);},Start:function(){var A=this._Images;this._PreloadCount=A.length;for (var i=0;i<A.length;i++){var B=document.createElement('img');TETools.AddEventListenerEx(B,'load',_TEImagePreloader_OnImage,this);TETools.AddEventListenerEx(B,'error',_TEImagePreloader_OnImage,this);B.src=A[i];_TEImagePreloader_ImageCache.push(B);}}};var _TEImagePreloader_ImageCache=[];function _TEImagePreloader_OnImage(A,B){if ((--B._PreloadCount)==0&&B.OnComplete) B.OnComplete();}
var TERegexLib={AposEntity:/&apos;/gi,ObjectElements:/^(?:IMG|TABLE|TR|TD|TH|INPUT|SELECT|TEXTAREA|HR|OBJECT|A|UL|OL|LI)$/i,NamedCommands:/^(?:Cut|Copy|Paste|Print|SelectAll|RemoveFormat|Unlink|Undo|Redo|Bold|Italic|Underline|StrikeThrough|Subscript|Superscript|JustifyLeft|JustifyCenter|JustifyRight|JustifyFull|Outdent|Indent|InsertOrderedList|InsertUnorderedList|InsertHorizontalRule)$/i,BeforeBody:/(^[\s\S]*\<body[^\>]*\>)/i,AfterBody:/(\<\/body\>[\s\S]*$)/i,ToReplace:/___tetoreplace:([\w]+)/ig,MetaHttpEquiv:/http-equiv\s*=\s*["']?([^"' ]+)/i,HasBaseTag:/<base /i,HasBodyTag:/<body[\s|>]/i,HtmlOpener:/<html\s?[^>]*>/i,HeadOpener:/<head\s?[^>]*>/i,HeadCloser:/<\/head\s*>/i,TE_Class:/\s*TE__[^ ]*(?=\s+|$)/,ElementName:/(^[a-z_:][\w.\-:]*\w$)|(^[a-z_]$)/,ForceSimpleAmpersand:/___TEAmp___/g,SpaceNoClose:/\/>/g,EmptyParagraph:/^<(p|div|address|h\d|center)(?=[ >])[^>]*>\s*(<\/\1>)?$/,EmptyOutParagraph:/^<(p|div|address|h\d|center)(?=[ >])[^>]*>(?:\s*|&nbsp;)(<\/\1>)?$/,TagBody:/></,GeckoEntitiesMarker:/#\?-\:/g,ProtectUrlsImg:/<img(?=\s).*?\ssrc=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,ProtectUrlsA:/<a(?=\s).*?\shref=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,ProtectUrlsArea:/<area(?=\s).*?\shref=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,Html4DocType:/HTML 4\.0 Transitional/i,DocTypeTag:/<!DOCTYPE[^>]*>/i,TagsWithEvent:/<[^\>]+ on\w+[\s\r\n]*=[\s\r\n]*?('|")[\s\S]+?\>/g,EventAttributes:/\s(on\w+)[\s\r\n]*=[\s\r\n]*?('|")([\s\S]*?)\2/g,ProtectedEvents:/\s\w+_teprotectedatt="([^"]+)"/g,StyleProperties:/\S+\s*:/g,InvalidSelfCloseTags:/(<(?!base|meta|link|hr|br|param|img|area|input)([a-zA-Z0-9:]+)[^>]*)\/>/gi,StyleVariableAttName:/#\(\s*("|')(.+?)\1[^\)]*\s*\)/g,RegExp:/^\/(.*)\/([gim]*)$/};
var TEListsLib={BlockElements:{ address:1,blockquote:1,center:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,marquee:1,noscript:1,ol:1,p:1,pre:1,script:1,table:1,ul:1 },NonEmptyBlockElements:{ p:1,div:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,address:1,pre:1,ol:1,ul:1,li:1,td:1,th:1 },InlineChildReqElements:{ abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,'var':1 },InlineNonEmptyElements:{ a:1,abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,'var':1 },EmptyElements:{ base:1,col:1,meta:1,link:1,hr:1,br:1,param:1,img:1,area:1,input:1 },PathBlockElements:{ address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,de:1 },PathBlockLimitElements:{ body:1,div:1,td:1,th:1,caption:1,form:1 },StyleBlockElements:{ address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1 },StyleObjectElements:{ img:1,hr:1,li:1,table:1,tr:1,td:1,embed:1,object:1,ol:1,ul:1 },BlockBoundaries:{ p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,address:1,pre:1,ol:1,ul:1,li:1,dt:1,de:1,table:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,caption:1,col:1,colgroup:1,blockquote:1,body:1 },ListBoundaries:{ p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,address:1,pre:1,ol:1,ul:1,li:1,dt:1,de:1,table:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,caption:1,col:1,colgroup:1,blockquote:1,body:1,br:1 }};
var TELanguageManager=TE.Language={AvailableLanguages:{af:'Afrikaans',ar:'Arabic',bg:'Bulgarian',bn:'Bengali/Bangla',bs:'Bosnian',ca:'Catalan',cs:'Czech',da:'Danish',de:'German',el:'Greek',en:'English','en-au':'English (Australia)','en-ca':'English (Canadian)','en-uk':'English (United Kingdom)',eo:'Esperanto',es:'Spanish',et:'Estonian',eu:'Basque',fa:'Persian',fi:'Finnish',fo:'Faroese',fr:'French',gl:'Galician',he:'Hebrew',hi:'Hindi',hr:'Croatian',hu:'Hungarian',it:'Italian',ja:'Japanese',km:'Khmer',ko:'Korean',lt:'Lithuanian',lv:'Latvian',mn:'Mongolian',ms:'Malay',nb:'Norwegian Bokmal',nl:'Dutch',no:'Norwegian',pl:'Polish',pt:'Portuguese (Portugal)','pt-br':'Portuguese (Brazil)',ro:'Romanian',ru:'Russian',sk:'Slovak',sl:'Slovenian',sr:'Serbian (Cyrillic)','sr-latn':'Serbian (Latin)',sv:'Swedish',th:'Thai',tr:'Turkish',uk:'Ukrainian',vi:'Vietnamese',zh:'Chinese Traditional','zh-cn':'Chinese Simplified'},GetActiveLanguage:function(){if (TEConfig.AutoDetectLanguage){var A;if (navigator.userLanguage) A=navigator.userLanguage.toLowerCase();else if (navigator.language) A=navigator.language.toLowerCase();else{return TEConfig.DefaultLanguage;};if (A.length>=5){A=A.substr(0,5);if (this.AvailableLanguages[A]) return A;};if (A.length>=2){A=A.substr(0,2);if (this.AvailableLanguages[A]) return A;}};return this.DefaultLanguage;},TranslateElements:function(A,B,C,D){var e=A.getElementsByTagName(B);var E,s;for (var i=0;i<e.length;i++){if ((E=e[i].getAttribute('teLang'))){if ((s=TELang[E])){if (D) s=TETools.HTMLEncode(s);e[i][C]=s;}}}},TranslatePage:function(A){this.TranslateElements(A,'INPUT','value');this.TranslateElements(A,'SPAN','innerHTML');this.TranslateElements(A,'LABEL','innerHTML');this.TranslateElements(A,'OPTION','innerHTML',true);this.TranslateElements(A,'LEGEND','innerHTML');},Initialize:function(){if (this.AvailableLanguages[TEConfig.DefaultLanguage]) this.DefaultLanguage=TEConfig.DefaultLanguage;else this.DefaultLanguage='en';this.ActiveLanguage={};this.ActiveLanguage.Code=this.GetActiveLanguage();this.ActiveLanguage.Name=this.AvailableLanguages[this.ActiveLanguage.Code];}};
var TEXHtmlEntities={};TEXHtmlEntities.Initialize=function(){if (TEXHtmlEntities.Entities) return;var A='';var B,e;if (TEConfig.ProcessHTMLEntities){TEXHtmlEntities.Entities={' ':'nbsp','¡':'iexcl','¢':'cent','£':'pound','¤':'curren','¥':'yen','¦':'brvbar','§':'sect','¨':'uml','©':'copy','ª':'ordf','«':'laquo','¬':'not','­':'shy','®':'reg','¯':'macr','°':'deg','±':'plusmn','²':'sup2','³':'sup3','´':'acute','µ':'micro','¶':'para','·':'middot','¸':'cedil','¹':'sup1','º':'ordm','»':'raquo','¼':'frac14','½':'frac12','¾':'frac34','¿':'iquest','×':'times','÷':'divide','ƒ':'fnof','•':'bull','…':'hellip','′':'prime','″':'Prime','‾':'oline','⁄':'frasl','℘':'weierp','ℑ':'image','ℜ':'real','™':'trade','ℵ':'alefsym','←':'larr','↑':'uarr','→':'rarr','↓':'darr','↔':'harr','↵':'crarr','⇐':'lArr','⇑':'uArr','⇒':'rArr','⇓':'dArr','⇔':'hArr','∀':'forall','∂':'part','∃':'exist','∅':'empty','∇':'nabla','∈':'isin','∉':'notin','∋':'ni','∏':'prod','∑':'sum','−':'minus','∗':'lowast','√':'radic','∝':'prop','∞':'infin','∠':'ang','∧':'and','∨':'or','∩':'cap','∪':'cup','∫':'int','∴':'there4','∼':'sim','≅':'cong','≈':'asymp','≠':'ne','≡':'equiv','≤':'le','≥':'ge','⊂':'sub','⊃':'sup','⊄':'nsub','⊆':'sube','⊇':'supe','⊕':'oplus','⊗':'otimes','⊥':'perp','⋅':'sdot','\u2308':'lceil','\u2309':'rceil','\u230a':'lfloor','\u230b':'rfloor','\u2329':'lang','\u232a':'rang','◊':'loz','♠':'spades','♣':'clubs','♥':'hearts','♦':'diams','"':'quot','ˆ':'circ','˜':'tilde',' ':'ensp',' ':'emsp',' ':'thinsp','‌':'zwnj','‍':'zwj','‎':'lrm','‏':'rlm','–':'ndash','—':'mdash','‘':'lsquo','’':'rsquo','‚':'sbquo','“':'ldquo','”':'rdquo','„':'bdquo','†':'dagger','‡':'Dagger','‰':'permil','‹':'lsaquo','›':'rsaquo','€':'euro'};for (e in TEXHtmlEntities.Entities) A+=e;if (TEConfig.IncludeLatinEntities){B={'À':'Agrave','Á':'Aacute','Â':'Acirc','Ã':'Atilde','Ä':'Auml','Å':'Aring','Æ':'AElig','Ç':'Ccedil','È':'Egrave','É':'Eacute','Ê':'Ecirc','Ë':'Euml','Ì':'Igrave','Í':'Iacute','Î':'Icirc','Ï':'Iuml','Ð':'ETH','Ñ':'Ntilde','Ò':'Ograve','Ó':'Oacute','Ô':'Ocirc','Õ':'Otilde','Ö':'Ouml','Ø':'Oslash','Ù':'Ugrave','Ú':'Uacute','Û':'Ucirc','Ü':'Uuml','Ý':'Yacute','Þ':'THORN','ß':'szlig','à':'agrave','á':'aacute','â':'acirc','ã':'atilde','ä':'auml','å':'aring','æ':'aelig','ç':'ccedil','è':'egrave','é':'eacute','ê':'ecirc','ë':'euml','ì':'igrave','í':'iacute','î':'icirc','ï':'iuml','ð':'eth','ñ':'ntilde','ò':'ograve','ó':'oacute','ô':'ocirc','õ':'otilde','ö':'ouml','ø':'oslash','ù':'ugrave','ú':'uacute','û':'ucirc','ü':'uuml','ý':'yacute','þ':'thorn','ÿ':'yuml','Œ':'OElig','œ':'oelig','Š':'Scaron','š':'scaron','Ÿ':'Yuml'};for (e in B){TEXHtmlEntities.Entities[e]=B[e];A+=e;};B=null;};if (TEConfig.IncludeGreekEntities){B={'Α':'Alpha','Β':'Beta','Γ':'Gamma','Δ':'Delta','Ε':'Epsilon','Ζ':'Zeta','Η':'Eta','Θ':'Theta','Ι':'Iota','Κ':'Kappa','Λ':'Lambda','Μ':'Mu','Ν':'Nu','Ξ':'Xi','Ο':'Omicron','Π':'Pi','Ρ':'Rho','Σ':'Sigma','Τ':'Tau','Υ':'Upsilon','Φ':'Phi','Χ':'Chi','Ψ':'Psi','Ω':'Omega','α':'alpha','β':'beta','γ':'gamma','δ':'delta','ε':'epsilon','ζ':'zeta','η':'eta','θ':'theta','ι':'iota','κ':'kappa','λ':'lambda','μ':'mu','ν':'nu','ξ':'xi','ο':'omicron','π':'pi','ρ':'rho','ς':'sigmaf','σ':'sigma','τ':'tau','υ':'upsilon','φ':'phi','χ':'chi','ψ':'psi','ω':'omega','\u03d1':'thetasym','\u03d2':'upsih','\u03d6':'piv'};for (e in B){TEXHtmlEntities.Entities[e]=B[e];A+=e;};B=null;}}else{TEXHtmlEntities.Entities={};A=' ';};var C='['+A+']';if (TEConfig.ProcessNumericEntities) C='[^ -~]|'+C;var D=TEConfig.AdditionalNumericEntities;if (D&&D.length>0) C+='|'+TEConfig.AdditionalNumericEntities;TEXHtmlEntities.EntitiesRegex=new RegExp(C,'g');};
var TEXHtml={};TEXHtml.CurrentJobNum=0;TEXHtml.GetXHTML=function(A,B,C){TEDomTools.CheckAndRemovePaddingNode(A.ownerDocument,TEConfig.EnterMode);TEXHtmlEntities.Initialize();this._NbspEntity=(TEConfig.ProcessHTMLEntities?'nbsp':'#160');var D=TE.IsDirty();TEXHtml.SpecialBlocks=[];this.XML=TETools.CreateXmlObject('DOMDocument');this.MainNode=this.XML.appendChild(this.XML.createElement('xhtml'));TEXHtml.CurrentJobNum++;if (B) this._AppendNode(this.MainNode,A);else this._AppendChildNodes(this.MainNode,A,false);var E=this._GetMainXmlString();this.XML=null;if (TEBrowserInfo.IsSafari) E=E.replace(/^<xhtml.*?>/,'<xhtml>');E=E.substr(7,E.length-15).Trim();E=E.replace(TERegexLib.SpaceNoClose,' />');if (TEConfig.ForceSimpleAmpersand) E=E.replace(TERegexLib.ForceSimpleAmpersand,'&');if (C) E=TECodeFormatter.Format(E);for (var i=0;i<TEXHtml.SpecialBlocks.length;i++){var F=new RegExp('___TEsi___'+i);E=E.replace(F,TEXHtml.SpecialBlocks[i]);};E=E.replace(TERegexLib.GeckoEntitiesMarker,'&');if (!D) TE.ResetIsDirty();TEDomTools.EnforcePaddingNode(TETools.GetElementDocument(A),TEConfig.EnterMode);return E;};TEXHtml._AppendAttribute=function(A,B,C){try{if (C==undefined||C==null) C='';else if (C.replace){if (TEConfig.ForceSimpleAmpersand) C=C.replace(/&/g,'___TEAmp___');C=C.replace(TEXHtmlEntities.EntitiesRegex,TEXHtml_GetEntity);};var D=this.XML.createAttribute(B);D.value=C;A.attributes.setNamedItem(D);}catch (e){}};TEXHtml._AppendChildNodes=function(A,B,C){var D=B.firstChild;while (D){this._AppendNode(A,D);D=D.nextSibling;};if (C&&B.tagName&&B.tagName.toLowerCase()!='pre'){TEDomTools.TrimNode(A);if (TEConfig.FillEmptyBlocks){var E=A.lastChild;if (E&&E.nodeType==1&&E.nodeName=='br') this._AppendEntity(A,this._NbspEntity);}};if (A.childNodes.length==0){if (C&&TEConfig.FillEmptyBlocks){this._AppendEntity(A,this._NbspEntity);return A;};var F=A.nodeName;if (TEListsLib.InlineChildReqElements[F]) return null;if (!TEListsLib.EmptyElements[F]) A.appendChild(this.XML.createTextNode(''));};return A;};TEXHtml._AppendNode=function(A,B){if (!B) return false;switch (B.nodeType){case 1:if (TEBrowserInfo.IsGecko&&B.tagName.toLowerCase()=='br'&&B.parentNode.tagName.toLowerCase()=='pre'){var C='\r';if (B==B.parentNode.firstChild) C+='\r';return TEXHtml._AppendNode(A,this.XML.createTextNode(C));};if (B.getAttribute('_tefakelement')) return TEXHtml._AppendNode(A,TE.GetRealElement(B));if (TEBrowserInfo.IsGecko&&B.nextSibling&&(B.hasAttribute('_moz_editor_bogus_node')||B.getAttribute('type')=='_moz')) return false;if (B.getAttribute('_tetemp')) return false;var D=B.tagName.toLowerCase();if (TEBrowserInfo.IsIE){if (B.scopeName&&B.scopeName!='HTML'&&B.scopeName!='TE') D=B.scopeName.toLowerCase()+':'+D;}else{if (D.StartsWith('te:')) D=D.Remove(0,4);};if (!TERegexLib.ElementName.test(D)) return false;if (B._texhtmljob&&B._texhtmljob==TEXHtml.CurrentJobNum) return false;var E=this.XML.createElement(D);TEXHtml._AppendAttributes(A,B,E,D);B._texhtmljob=TEXHtml.CurrentJobNum;var F=TEXHtml.TagProcessors[D];if (F) E=F(E,B,A);else E=this._AppendChildNodes(E,B,Boolean(TEListsLib.NonEmptyBlockElements[D]));if (!E) return false;A.appendChild(E);break;case 3:if (B.parentNode&&B.parentNode.nodeName.IEquals('pre')) return this._AppendTextNode(A,B.nodeValue);return this._AppendTextNode(A,B.nodeValue.ReplaceNewLineChars(' '));case 8:if (TEBrowserInfo.IsIE&&!B.innerHTML) break;try { A.appendChild(this.XML.createComment(B.nodeValue));}catch (e) {/*Do nothing... probably this is a wrong format comment.*/};break;default:A.appendChild(this.XML.createComment("Element not supported - Type: "+B.nodeType+" Name: "+B.nodeName));break;};return true;};TEXHtml._AppendSpecialItem=function(A){return '___TEsi___'+TEXHtml.SpecialBlocks.AddItem(A);};TEXHtml._AppendEntity=function(A,B){A.appendChild(this.XML.createTextNode('#?-:'+B+';'));};TEXHtml._AppendTextNode=function(A,B){var C=B.length>0;if (C) A.appendChild(this.XML.createTextNode(B.replace(TEXHtmlEntities.EntitiesRegex,TEXHtml_GetEntity)));return C;};function TEXHtml_GetEntity(A){var B=TEXHtmlEntities.Entities[A]||('#'+A.charCodeAt(0));return '#?-:'+B+';';};TEXHtml.TagProcessors={a:function(A,B){if (B.innerHTML.Trim().length==0&&!B.name) return false;var C=B.getAttribute('_tesavedurl');if (C!=null) TEXHtml._AppendAttribute(A,'href',C);if (TEBrowserInfo.IsIE){if (B.name) TEXHtml._AppendAttribute(A,'name',B.name);};A=TEXHtml._AppendChildNodes(A,B,false);return A;},area:function(A,B){var C=B.getAttribute('_tesavedurl');if (C!=null) TEXHtml._AppendAttribute(A,'href',C);if (TEBrowserInfo.IsIE){if (!A.attributes.getNamedItem('coords')){var D=B.getAttribute('coords',2);if (D&&D!='0,0,0') TEXHtml._AppendAttribute(A,'coords',D);};if (!A.attributes.getNamedItem('shape')){var E=B.getAttribute('shape',2);if (E&&E.length>0) TEXHtml._AppendAttribute(A,'shape',E.toLowerCase());}};return A;},body:function(A,B){A=TEXHtml._AppendChildNodes(A,B,false);A.removeAttribute('spellcheck');return A;},iframe:function(A,B){var C=B.innerHTML;if (TEBrowserInfo.IsGecko) C=TETools.HTMLDecode(C);C=C.replace(/\s_tesavedurl="[^"]*"/g,'');A.appendChild(TEXHtml.XML.createTextNode(TEXHtml._AppendSpecialItem(C)));return A;},img:function(A,B){if (!A.attributes.getNamedItem('alt')) TEXHtml._AppendAttribute(A,'alt','');var C=B.getAttribute('_tesavedurl');if (C!=null) TEXHtml._AppendAttribute(A,'src',C);return A;},ol:function(A,B,C){if (B.innerHTML.Trim().length==0) return false;var D=C.lastChild;if (D&&D.nodeType==3) D=D.previousSibling;if (D&&D.nodeName.toUpperCase()=='LI'){B._texhtmljob=null;TEXHtml._AppendNode(D,B);return false;};A=TEXHtml._AppendChildNodes(A,B);return A;},pre:function (A,B){var C=B.firstChild;if (C&&C.nodeType==3) A.appendChild(TEXHtml.XML.createTextNode(TEXHtml._AppendSpecialItem('\r\n')));TEXHtml._AppendChildNodes(A,B,true);return A;},script:function(A,B){if (!A.attributes.getNamedItem('type')) TEXHtml._AppendAttribute(A,'type','text/javascript');A.appendChild(TEXHtml.XML.createTextNode(TEXHtml._AppendSpecialItem(B.text)));return A;},span:function(A,B){if (B.innerHTML.length==0) return false;A=TEXHtml._AppendChildNodes(A,B,false);return A;},style:function(A,B){if (!A.attributes.getNamedItem('type')) TEXHtml._AppendAttribute(A,'type','text/css');var C=B.innerHTML;if (TEBrowserInfo.IsIE) C=C.replace(/^(\r\n|\n|\r)/,'');A.appendChild(TEXHtml.XML.createTextNode(TEXHtml._AppendSpecialItem(C)));return A;},title:function(A,B){A.appendChild(TEXHtml.XML.createTextNode(TE.EditorDocument.title));return A;}};TEXHtml.TagProcessors.ul=TEXHtml.TagProcessors.ol;
TEXHtml._GetMainXmlString=function(){return this.MainNode.xml;};TEXHtml._AppendAttributes=function(A,B,C,D){var E=B.attributes;for (var n=0;n<E.length;n++){var F=E[n];if (F.specified){var G=F.nodeName.toLowerCase();var H;if (G.StartsWith('_te')) continue;else if (G=='style'){var I=TETools.ProtectFormStyles(B);H=B.style.cssText.replace(TERegexLib.StyleProperties,TETools.ToLowerCase);TETools.RestoreFormStyles(B,I);}else if (G=='class'){H=F.nodeValue.replace(TERegexLib.TE_Class,'');if (H.length==0) continue;}else if (G.indexOf('on')==0) H=F.nodeValue;else if (D=='body'&&G=='contenteditable') continue;else if (F.nodeValue===true) H=G;else{try{H=B.getAttribute(G,2);}catch (e) {}};this._AppendAttribute(C,G,H||F.nodeValue);}}};TEXHtml.TagProcessors['div']=function(A,B){if (B.align.length>0) TEXHtml._AppendAttribute(A,'align',B.align);A=TEXHtml._AppendChildNodes(A,B,true);return A;};TEXHtml.TagProcessors['font']=function(A,B){if (A.attributes.length==0) A=TEXHtml.XML.createDocumentFragment();A=TEXHtml._AppendChildNodes(A,B);return A;};TEXHtml.TagProcessors['form']=function(A,B){if (B.acceptCharset&&B.acceptCharset.length>0&&B.acceptCharset!='UNKNOWN') TEXHtml._AppendAttribute(A,'accept-charset',B.acceptCharset);var C=B.attributes['name'];if (C&&C.value.length>0) TEXHtml._AppendAttribute(A,'name',C.value);A=TEXHtml._AppendChildNodes(A,B,true);return A;};TEXHtml.TagProcessors['input']=function(A,B){if (B.name) TEXHtml._AppendAttribute(A,'name',B.name);if (B.value&&!A.attributes.getNamedItem('value')) TEXHtml._AppendAttribute(A,'value',B.value);if (!A.attributes.getNamedItem('type')) TEXHtml._AppendAttribute(A,'type','text');return A;};TEXHtml.TagProcessors['label']=function(A,B){if (B.htmlFor.length>0) TEXHtml._AppendAttribute(A,'for',B.htmlFor);A=TEXHtml._AppendChildNodes(A,B);return A;};TEXHtml.TagProcessors['map']=function(A,B){if (!A.attributes.getNamedItem('name')){var C=B.name;if (C) TEXHtml._AppendAttribute(A,'name',C);};A=TEXHtml._AppendChildNodes(A,B,true);return A;};TEXHtml.TagProcessors['meta']=function(A,B){var C=A.attributes.getNamedItem('http-equiv');if (C==null||C.value.length==0){var D=B.outerHTML.match(TERegexLib.MetaHttpEquiv);if (D){D=D[1];TEXHtml._AppendAttribute(A,'http-equiv',D);}};return A;};TEXHtml.TagProcessors['option']=function(A,B){if (B.selected&&!A.attributes.getNamedItem('selected')) TEXHtml._AppendAttribute(A,'selected','selected');A=TEXHtml._AppendChildNodes(A,B);return A;};TEXHtml.TagProcessors['textarea']=TEXHtml.TagProcessors['select']=function(A,B){if (B.name) TEXHtml._AppendAttribute(A,'name',B.name);A=TEXHtml._AppendChildNodes(A,B);return A;}
var TECodeFormatter={};TECodeFormatter.Init=function(){var A=this.Regex={};A.BlocksOpener=/\<(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi;A.BlocksCloser=/\<\/(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi;A.NewLineTags=/\<(BR|HR)[^\>]*\>/gi;A.MainTags=/\<\/?(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR)[^\>]*\>/gi;A.LineSplitter=/\s*\n+\s*/g;A.IncreaseIndent=/^\<(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \/\>]/i;A.DecreaseIndent=/^\<\/(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \>]/i;A.FormatIndentatorRemove=new RegExp('^'+TEConfig.FormatIndentator);A.ProtectedTags=/(<PRE[^>]*>)([\s\S]*?)(<\/PRE>)/gi;};TECodeFormatter._ProtectData=function(A,B,C,D){return B+'___TEpd___'+TECodeFormatter.ProtectedData.AddItem(C)+D;};TECodeFormatter.Format=function(A){if (!this.Regex) this.Init();TECodeFormatter.ProtectedData=[];var B=A.replace(this.Regex.ProtectedTags,TECodeFormatter._ProtectData);B=B.replace(this.Regex.BlocksOpener,'\n$&');B=B.replace(this.Regex.BlocksCloser,'$&\n');B=B.replace(this.Regex.NewLineTags,'$&\n');B=B.replace(this.Regex.MainTags,'\n$&\n');var C='';var D=B.split(this.Regex.LineSplitter);B='';for (var i=0;i<D.length;i++){var E=D[i];if (E.length==0) continue;if (this.Regex.DecreaseIndent.test(E)) C=C.replace(this.Regex.FormatIndentatorRemove,'');B+=C+E+'\n';if (this.Regex.IncreaseIndent.test(E)) C+=TEConfig.FormatIndentator;};for (var j=0;j<TECodeFormatter.ProtectedData.length;j++){var F=new RegExp('___TEpd___'+j);B=B.replace(F,TECodeFormatter.ProtectedData[j].replace(/\$/g,'$$$$'));};return B.Trim();}
var TEUndo={};TEUndo.SavedData=[];TEUndo.CurrentIndex=-1;TEUndo.TypesCount=0;TEUndo.Changed=false;TEUndo.MaxTypes=25;TEUndo.Typing=false;TEUndo.SaveLocked=false;TEUndo._GetBookmark=function(){var A=new TEDomRange(TE.EditorWindow);try{A.MoveToSelection();}catch (e){return null;};if (TEBrowserInfo.IsIE){var B=A.CreateBookmark();var C=TE.EditorDocument.body.innerHTML;A.MoveToBookmark(B);return [B,C];};return A.CreateBookmark2();};TEUndo._SelectBookmark=function(A){if (!A) return;var B=new TEDomRange(TE.EditorWindow);if (A instanceof Object){if (TEBrowserInfo.IsIE) B.MoveToBookmark(A[0]);else B.MoveToBookmark2(A);try{B.Select();}catch (e){B.MoveToPosition(TE.EditorDocument.body,4);B.Select();}}};TEUndo._CompareCursors=function(A,B){for (var i=0;i<Math.min(A.length,B.length);i++){if (A[i]<B[i]) return-1;else if (A[i]>B[i]) return 1;};if (A.length<B.length) return-1;else if (A.length>B.length) return 1;return 0;};TEUndo._CheckIsBookmarksEqual=function(A,B){if (!(A&&B)) return false;if (TEBrowserInfo.IsIE){var C=A[1].search(A[0].StartId);var D=B[1].search(B[0].StartId);var E=A[1].search(A[0].EndId);var F=B[1].search(B[0].EndId);return C==D&&E==F;}else{return this._CompareCursors(A.Start,B.Start)==0&&this._CompareCursors(A.End,B.End)==0;}};TEUndo.SaveUndoStep=function(){if (TE.EditMode!=0||this.SaveLocked) return;if (this.SavedData.length) this.Changed=true;var A=TE.EditorDocument.body.innerHTML;var B=this._GetBookmark();this.SavedData=this.SavedData.slice(0,this.CurrentIndex+1);if (this.CurrentIndex>0&&A==this.SavedData[this.CurrentIndex][0]&&this._CheckIsBookmarksEqual(B,this.SavedData[this.CurrentIndex][1])) return;else if (this.CurrentIndex==0&&this.SavedData.length&&A==this.SavedData[0][0]){this.SavedData[0][1]=B;return;};if (this.CurrentIndex+1>=TEConfig.MaxUndoLevels) this.SavedData.shift();else this.CurrentIndex++;this.SavedData[this.CurrentIndex]=[A,B];TE.Events.FireEvent("OnSelectionChange");};TEUndo.CheckUndoState=function(){return (this.Changed||this.CurrentIndex>0);};TEUndo.CheckRedoState=function(){return (this.CurrentIndex<(this.SavedData.length-1));};TEUndo.Undo=function(){if (this.CheckUndoState()){if (this.CurrentIndex==(this.SavedData.length-1)){this.SaveUndoStep();};this._ApplyUndoLevel(--this.CurrentIndex);TE.Events.FireEvent("OnSelectionChange");}};TEUndo.Redo=function(){if (this.CheckRedoState()){this._ApplyUndoLevel(++this.CurrentIndex);TE.Events.FireEvent("OnSelectionChange");}};TEUndo._ApplyUndoLevel=function(A){var B=this.SavedData[A];if (!B) return;if (TEBrowserInfo.IsIE){if (B[1]&&B[1][1]) TE.SetInnerHtml(B[1][1]);else TE.SetInnerHtml(B[0]);}else TE.EditorDocument.body.innerHTML=B[0];this._SelectBookmark(B[1]);this.TypesCount=0;this.Changed=false;this.Typing=false;};
var TEEditingArea=function(A){this.TargetElement=A;this.Mode=0;if (TE.IECleanup) TE.IECleanup.AddItem(this,TEEditingArea_Cleanup);};TEEditingArea.prototype.Start=function(A,B){var C=this.TargetElement;var D=TETools.GetElementDocument(C);var E;while((E=C.firstChild)){if (E.contentWindow) E.contentWindow.document.body.innerHTML='';C.removeChild(E);};if (this.Mode==0){var F=this.IFrame=D.createElement('iframe');if (!TEBrowserInfo.IsGecko) F.src='javascript:void(0)';F.frameBorder=0;F.width=F.height='100%';C.appendChild(F);if (TEBrowserInfo.IsIE) A=A.replace(/(<base[^>]*?)\s*\/?>(?!\s*<\/base>)/gi,'$1></base>');else if (!B){var G=A.match(TERegexLib.BeforeBody);var H=A.match(TERegexLib.AfterBody);if (G&&H){var I=A.substr(G[1].length,A.length-G[1].length-H[1].length);A=G[1]+'&nbsp;'+H[1];if (TEBrowserInfo.IsGecko&&(I.length==0||TERegexLib.EmptyParagraph.test(I))) I='<br type="_moz">';this._BodyHTML=I;}else this._BodyHTML=A;};this.Window=F.contentWindow;var J=this.Document=this.Window.document;J.open();J.write(A);J.close();if (TEBrowserInfo.IsGecko10&&!B){this.Start(A,true);return;};this.Window._TEEditingArea=this;if (TEBrowserInfo.IsGecko10) this.Window.setTimeout(TEEditingArea_CompleteStart,500);else TEEditingArea_CompleteStart.call(this.Window);}else{var K=this.Textarea=D.createElement('textarea');K.className='SourceField';K.dir='ltr';TEDomTools.SetElementStyles(K,{width:'100%',height:'100%',border:'none',resize:'none',outline:'none'});C.appendChild(K);K.value=A;TETools.RunFunction(this.OnLoad);}};function TEEditingArea_CompleteStart(){if (!this.document.body){this.setTimeout(TEEditingArea_CompleteStart,50);return;};var A=this._TEEditingArea;A.MakeEditable();TETools.RunFunction(A.OnLoad);};TEEditingArea.prototype.MakeEditable=function(){var A=this.Document;if (TEBrowserInfo.IsIE){A.body.disabled=true;A.body.contentEditable=true;A.body.removeAttribute("disabled");}else{try{A.body.spellcheck=(this.FFSpellChecker!==false);if (this._BodyHTML){A.body.innerHTML=this._BodyHTML;this._BodyHTML=null;};A.designMode='on';try{A.execCommand('styleWithCSS',false,TEConfig.GeckoUseSPAN);}catch (e){A.execCommand('useCSS',false,!TEConfig.GeckoUseSPAN);};A.execCommand('enableObjectResizing',false,!TEConfig.DisableObjectResizing);A.execCommand('enableInlineTableEditing',false,!TEConfig.DisableFFTableHandles);}catch (e){TETools.AddEventListener(this.Window.frameElement,'DOMAttrModified',TEEditingArea_Document_AttributeNodeModified);}}};function TEEditingArea_Document_AttributeNodeModified(A){var B=A.currentTarget.contentWindow._TEEditingArea;if (B._timer) window.clearTimeout(B._timer);B._timer=TETools.SetTimeout(TEEditingArea_MakeEditableByMutation,1000,B);};function TEEditingArea_MakeEditableByMutation(){delete this._timer;TETools.RemoveEventListener(this.Window.frameElement,'DOMAttrModified',TEEditingArea_Document_AttributeNodeModified);this.MakeEditable();};TEEditingArea.prototype.Focus=function(){try{if (this.Mode==0){if (TEBrowserInfo.IsIE&&this.Document.hasFocus()) this._EnsureFocusIE();this.Window.focus();if (TEBrowserInfo.IsIE) this._EnsureFocusIE();}else{var A=TETools.GetElementDocument(this.Textarea);if ((!A.hasFocus||A.hasFocus())&&A.activeElement==this.Textarea) return;this.Textarea.focus();}}catch(e) {}};TEEditingArea.prototype._EnsureFocusIE=function(){this.Document.body.setActive();var A=this.Document.selection.createRange();var B=A.parentElement();var C=B.nodeName.toLowerCase();if (B.childNodes.length>0||!(TEListsLib.BlockElements[C]||TEListsLib.NonEmptyBlockElements[C])){return;};A.moveEnd("character",1);A.select();if (A.boundingWidth>0){A.moveEnd("character",-1);A.select();}};function TEEditingArea_Cleanup(){if (this.Document) this.Document.body.innerHTML="";this.TargetElement=null;this.IFrame=null;this.Document=null;this.Textarea=null;if (this.Window){this.Window._TEEditingArea=null;this.Window=null;}};
var TEKeystrokeHandler=function(A){this.Keystrokes={};this.CancelCtrlDefaults=(A!==false);};TEKeystrokeHandler.prototype.AttachToElement=function(A){TETools.AddEventListenerEx(A,'keydown',_TEKeystrokeHandler_OnKeyDown,this);if (TEBrowserInfo.IsGecko10||TEBrowserInfo.IsOpera||(TEBrowserInfo.IsGecko&&TEBrowserInfo.IsMac)) TETools.AddEventListenerEx(A,'keypress',_TEKeystrokeHandler_OnKeyPress,this);};TEKeystrokeHandler.prototype.SetKeystrokes=function(){for (var i=0;i<arguments.length;i++){var A=arguments[i];if (!A) continue;if (typeof(A[0])=='object') this.SetKeystrokes.apply(this,A);else{if (A.length==1) delete this.Keystrokes[A[0]];else this.Keystrokes[A[0]]=A[1]===true?true:A;}}};function _TEKeystrokeHandler_OnKeyDown(A,B){var C=A.keyCode||A.which;var D=0;if (A.ctrlKey||A.metaKey) D+=CTRL;if (A.shiftKey) D+=SHIFT;if (A.altKey) D+=ALT;var E=C+D;var F=B._CancelIt=false;var G=B.Keystrokes[E];if (G){if (G===true||!(B.OnKeystroke&&B.OnKeystroke.apply(B,G))) return true;F=true;};if (F||(B.CancelCtrlDefaults&&D==CTRL&&(C<33||C>40))){B._CancelIt=true;if (A.preventDefault) return A.preventDefault();A.returnValue=false;A.cancelBubble=true;return false;};return true;};function _TEKeystrokeHandler_OnKeyPress(A,B){if (B._CancelIt){if (A.preventDefault) return A.preventDefault();return false;};return true;};
TE.DTD=(function(){X=TETools.Merge;var A,L,J,M,N,O,D,H,P,K,Q,F,G,C,B,E,I;A={isindex:1,fieldset:1};B={input:1,button:1,select:1,textarea:1,label:1};C=X({a:1},B);D=X({iframe:1},C);E={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1};F={ins:1,del:1,script:1};G=X({b:1,acronym:1,bdo:1,'var':1,'#':1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},F);H=X({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},G);I=X({p:1},H);J=X({iframe:1},H,B);K={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,'#':1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,'var':1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};L=X({a:1},J);M={tr:1};N={'#':1};O=X({param:1},K);P=X({form:1},A,D,E,I);Q={li:1};return {col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:{optgroup:1,option:1},font:J,ins:P,menu:Q,abbr:L,label:L,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:L,script:N,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:J,textarea:N,noframes:P,big:J,small:J,span:J,hr:{},dt:L,sub:J,optgroup:{option:1},param:{},bdo:L,'var':J,div:P,object:O,sup:J,dd:P,strike:J,area:{},dir:Q,map:X({area:1,form:1,p:1},A,F,E),applet:O,dl:{dt:1,dd:1},del:P,isindex:{},fieldset:X({legend:1},K),thead:M,ul:Q,acronym:L,b:J,a:J,blockquote:P,caption:L,i:J,u:J,tbody:M,s:L,address:X(D,I),tt:J,legend:L,q:L,pre:X(G,C),p:L,em:J,dfn:L};})();
var TEStyle=function(A){this.Element=(A.Element||'span').toLowerCase();this._StyleDesc=A;};TEStyle.prototype={GetType:function(){var A=this.GetType_$;if (A!=undefined) return A;var B=this.Element;if (B=='#'||TEListsLib.StyleBlockElements[B]) A=0;else if (TEListsLib.StyleObjectElements[B]) A=2;else A=1;return (this.GetType_$=A);},ApplyToSelection:function(A){var B=new TEDomRange(A);B.MoveToSelection();this.ApplyToRange(B,true);},ApplyToRange:function(A,B){switch (this.GetType()){case 0:this.ApplyToRange=this._ApplyBlockStyle;break;case 1:this.ApplyToRange=this._ApplyInlineStyle;break;default:return;};this.ApplyToRange(A,B);},ApplyToObject:function(A){if (!A) return;this.BuildElement(null,A);},RemoveFromSelection:function(A){var B=new TEDomRange(A);B.MoveToSelection();this.RemoveFromRange(B,true);},RemoveFromRange:function(A,B){var C;var D=this._GetAttribsForComparison();var E=this._GetOverridesForComparison();if (A.CheckIsCollapsed()){var C=A.CreateBookmark(true);var G=A.GetBookmarkNode(C,true);var H=new TEElementPath(G.parentNode);var I=[];var J=!TEDomTools.GetNextSibling(G);var K=J||!TEDomTools.GetPreviousSibling(G);var L;var M=-1;for (var i=0;i<H.Elements.length;i++){var N=H.Elements[i];if (this.CheckElementRemovable(N)){if (K&&!TEDomTools.CheckIsEmptyElement(N,function(el){return (el!=G);})){L=N;M=I.length-1;}else{var O=N.nodeName.toLowerCase();if (O==this.Element){for (var P in D){if (TEDomTools.HasAttribute(N,P)){switch (P){case 'style':this._RemoveStylesFromElement(N);break;case 'class':if (TEDomTools.GetAttributeValue(N,P)!=this.GetFinalAttributeValue(P)) continue;default:TEDomTools.RemoveAttribute(N,P);}}}};this._RemoveOverrides(N,E[O]);this._RemoveNoAttribElement(N);}}else if (K) I.push(N);K=K&&((J&&!TEDomTools.GetNextSibling(N))||(!J&&!TEDomTools.GetPreviousSibling(N)));if (L&&(!K||(i==H.Elements.length-1))){var Q=TEDomTools.RemoveNode(G);for (var j=0;j<=M;j++){var R=TEDomTools.CloneElement(I[j]);R.appendChild(Q);Q=R;};if (J) TEDomTools.InsertAfterNode(L,Q);else L.parentNode.insertBefore(Q,L);K=false;L=null;}};if (B) A.SelectBookmark(C);return;};A.Expand('inline_elements');var C=A.CreateBookmark(true);var T=A.GetBookmarkNode(C,true);var U=A.GetBookmarkNode(C,false);A.Release(true);var H=new TEElementPath(T);var X=H.Elements;var N;for (var i=1;i<X.length;i++){N=X[i];if (N==H.Block||N==H.BlockLimit) break;if (this.CheckElementRemovable(N)) TEDomTools.BreakParent(T,N,A);};H=new TEElementPath(U);X=H.Elements;for (var i=1;i<X.length;i++){N=X[i];if (N==H.Block||N==H.BlockLimit) break;b=N.nodeName.toLowerCase();if (this.CheckElementRemovable(N)) TEDomTools.BreakParent(U,N,A);};var Z=TEDomTools.GetNextSourceNode(T,true);while (Z){var a=TEDomTools.GetNextSourceNode(Z);if (Z.nodeType==1){var b=Z.nodeName.toLowerCase();var c=(b==this.Element);if (c){for (var P in D){if (TEDomTools.HasAttribute(Z,P)){switch (P){case 'style':this._RemoveStylesFromElement(Z);break;case 'class':if (TEDomTools.GetAttributeValue(Z,P)!=this.GetFinalAttributeValue(P)) continue;default:TEDomTools.RemoveAttribute(Z,P);}}}}else c=!!E[b];if (c){this._RemoveOverrides(Z,E[b]);this._RemoveNoAttribElement(Z);}};if (a==U) break;Z=a;};this._FixBookmarkStart(T);if (B) A.SelectBookmark(C);},CheckElementRemovable:function(A,B){if (!A) return false;var C=A.nodeName.toLowerCase();if (C==this.Element){if (!B&&!TEDomTools.HasAttributes(A)) return true;var D=this._GetAttribsForComparison();var E=(D._length==0);for (var F in D){if (F=='_length') continue;if (this._CompareAttributeValues(F,TEDomTools.GetAttributeValue(A,F),(this.GetFinalAttributeValue(F)||''))){E=true;if (!B) break;}else{E=false;if (B) return false;}};if (E) return true;};var G=this._GetOverridesForComparison()[C];if (G){if (!(D=G.Attributes)) return true;for (var i=0;i<D.length;i++){var H=D[i][0];if (TEDomTools.HasAttribute(A,H)){var I=D[i][1];if (I==null||(typeof I=='string'&&TEDomTools.GetAttributeValue(A,H)==I)||I.test(TEDomTools.GetAttributeValue(A,H))) return true;}}};return false;},CheckActive:function(A){switch (this.GetType()){case 0:return this.CheckElementRemovable(A.Block||A.BlockLimit);case 1:var B=A.Elements;for (var i=0;i<B.length;i++){var C=B[i];if (C==A.Block||C==A.BlockLimit) continue;if (this.CheckElementRemovable(C,true)) return true;}};return false;},RemoveFromElement:function(A){var B=this._GetAttribsForComparison();var C=this._GetOverridesForComparison();var D=A.getElementsByTagName(this.Element);for (var i=D.length-1;i>=0;i--){var E=D[i];for (var F in B){if (TEDomTools.HasAttribute(E,F)){switch (F){case 'style':this._RemoveStylesFromElement(E);break;case 'class':if (TEDomTools.GetAttributeValue(E,F)!=this.GetFinalAttributeValue(F)) continue;default:TEDomTools.RemoveAttribute(E,F);}}};this._RemoveOverrides(E,C[this.Element]);this._RemoveNoAttribElement(E);};for (var G in C){if (G!=this.Element){D=A.getElementsByTagName(G);for (var i=D.length-1;i>=0;i--){var E=D[i];this._RemoveOverrides(E,C[G]);this._RemoveNoAttribElement(E);}}}},_RemoveStylesFromElement:function(A){var B=A.style.cssText;var C=this.GetFinalStyleValue();if (B.length>0&&C.length==0) return;C='(^|;)\\s*('+C.replace(/\s*([^ ]+):.*?(;|$)/g,'$1|').replace(/\|$/,'')+'):[^;]+';var D=new RegExp(C,'gi');B=B.replace(D,'').Trim();if (B.length==0||B==';') TEDomTools.RemoveAttribute(A,'style');else A.style.cssText=B.replace(D,'');},_RemoveOverrides:function(A,B){var C=B&&B.Attributes;if (C){for (var i=0;i<C.length;i++){var D=C[i][0];if (TEDomTools.HasAttribute(A,D)){var E=C[i][1];if (E==null||(E.test&&E.test(TEDomTools.GetAttributeValue(A,D)))||(typeof E=='string'&&TEDomTools.GetAttributeValue(A,D)==E)) TEDomTools.RemoveAttribute(A,D);}}}},_RemoveNoAttribElement:function(A){if (!TEDomTools.HasAttributes(A)){var B=A.firstChild;var C=A.lastChild;TEDomTools.RemoveNode(A,true);this._MergeSiblings(B);if (B!=C) this._MergeSiblings(C);}},BuildElement:function(A,B){var C=B||A.createElement(this.Element);var D=this._StyleDesc.Attributes;var E;if (D){for (var F in D){E=this.GetFinalAttributeValue(F);if (F.toLowerCase()=='class') C.className=E;else C.setAttribute(F,E);}};if (this._GetStyleText().length>0) C.style.cssText=this.GetFinalStyleValue();return C;},_CompareAttributeValues:function(A,B,C){if (A=='style'&&B&&C){B=B.replace(/;$/,'').toLowerCase();C=C.replace(/;$/,'').toLowerCase();};return (B==C)},GetFinalAttributeValue:function(A){var B=this._StyleDesc.Attributes;var B=B?B[A]:null;if (!B&&A=='style') return this.GetFinalStyleValue();if (B&&this._Variables) B=B.Replace(TERegexLib.StyleVariableAttName,this._GetVariableReplace,this);return B;},GetFinalStyleValue:function(){var A=this._GetStyleText();if (A.length>0&&this._Variables){A=A.Replace(TERegexLib.StyleVariableAttName,this._GetVariableReplace,this);A=TETools.NormalizeCssText(A);};return A;},_GetVariableReplace:function(){return this._Variables[arguments[2]]||arguments[0];},SetVariable:function(A,B){var C=this._Variables;if (!C) C=this._Variables={};this._Variables[A]=B;},_ApplyBlockStyle:function(A,B){var C;if (B) C=A.CreateBookmark(true);var D=new TEDomRangeIterator(A);D.EnforceRealBlocks=true;var E;while((E=D.GetNextParagraph())){var F=E.parentNode.insertBefore(this.BuildElement(A.Window.document),E);TEDomTools.MoveChildren(E,F);TEDomTools.RemoveNode(E);};if (B) A.SelectBookmark(C);},_ApplyInlineStyle:function(A,B){var C=A.Window.document;if (A.CheckIsCollapsed()){var D=this.BuildElement(C);A.InsertNode(D);A.MoveToPosition(D,2);A.Select();return;};var E=this.Element;var F=TE.DTD[E]||TE.DTD.span;var G=this._GetAttribsForComparison();var H;A.Expand('inline_elements');var I=A.CreateBookmark(true);var J=A.GetBookmarkNode(I,true);var K=A.GetBookmarkNode(I,false);A.Release(true);var L=TEDomTools.GetNextSourceNode(J,true);while (L){var M=false;var N=L.nodeType;var O=N==1?L.nodeName.toLowerCase():null;if (!O||F[O]){if ((TE.DTD[L.parentNode.nodeName.toLowerCase()]||TE.DTD.span)[E]||!TE.DTD[E]){if (!A.CheckHasRange()) A.SetStart(L,3);if (N!=1||L.childNodes.length==0){var P=L;var Q=P.parentNode;while (P==Q.lastChild&&F[Q.nodeName.toLowerCase()]){P=Q;};A.SetEnd(P,4);if (P==P.parentNode.lastChild&&!F[P.parentNode.nodeName.toLowerCase()]) M=true;}else{A.SetEnd(L,3);}}else M=true;}else M=true;L=TEDomTools.GetNextSourceNode(L);if (L==K){L=null;M=true;};if (M&&A.CheckHasRange()&&!A.CheckIsCollapsed()){H=this.BuildElement(C);A.ExtractContents().AppendTo(H);if (H.innerHTML.RTrim().length>0){A.InsertNode(H);this.RemoveFromElement(H);this._MergeSiblings(H,this._GetAttribsForComparison());if (!TEBrowserInfo.IsIE) H.normalize();};A.Release(true);}};this._FixBookmarkStart(J);if (B) A.SelectBookmark(I);},_FixBookmarkStart:function(A){var B;while ((B=A.nextSibling)){if (B.nodeType==1&&TEListsLib.InlineNonEmptyElements[B.nodeName.toLowerCase()]){if (!B.firstChild) TEDomTools.RemoveNode(B);else TEDomTools.MoveNode(A,B,true);continue;};if (B.nodeType==3&&B.length==0){TEDomTools.RemoveNode(B);continue;};break;}},_MergeSiblings:function(A,B){if (!A||A.nodeType!=1||!TEListsLib.InlineNonEmptyElements[A.nodeName.toLowerCase()]) return;this._MergeNextSibling(A,B);this._MergePreviousSibling(A,B);},_MergeNextSibling:function(A,B){var C=A.nextSibling;var D=(C&&C.nodeType==1&&C.getAttribute('_te_bookmark'));if (D) C=C.nextSibling;if (C&&C.nodeType==1&&C.nodeName==A.nodeName){if (!B) B=this._CreateElementAttribsForComparison(A);if (this._CheckAttributesMatch(C,B)){var E=A.lastChild;if (D) TEDomTools.MoveNode(A.nextSibling,A);TEDomTools.MoveChildren(C,A);TEDomTools.RemoveNode(C);if (E) this._MergeNextSibling(E);}}},_MergePreviousSibling:function(A,B){var C=A.previousSibling;var D=(C&&C.nodeType==1&&C.getAttribute('_te_bookmark'));if (D) C=C.previousSibling;if (C&&C.nodeType==1&&C.nodeName==A.nodeName){if (!B) B=this._CreateElementAttribsForComparison(A);if (this._CheckAttributesMatch(C,B)){var E=A.firstChild;if (D) TEDomTools.MoveNode(A.previousSibling,A,true);TEDomTools.MoveChildren(C,A,true);TEDomTools.RemoveNode(C);if (E) this._MergePreviousSibling(E);}}},_GetStyleText:function(){var A=this._StyleDesc.Styles;var B=(this._StyleDesc.Attributes?this._StyleDesc.Attributes['style']||'':'');if (B.length>0) B+=';';for (var C in A) B+=C+':'+A[C]+';';if (B.length>0&&!(/#\(/.test(B))){B=TETools.NormalizeCssText(B);};return (this._GetStyleText=function() { return B;})();},_GetAttribsForComparison:function(){var A=this._GetAttribsForComparison_$;if (A) return A;A={};var B=this._StyleDesc.Attributes;if (B){for (var C in B){A[C.toLowerCase()]=B[C].toLowerCase();}};if (this._GetStyleText().length>0){A['style']=this._GetStyleText().toLowerCase();};TETools.AppendLengthProperty(A,'_length');return (this._GetAttribsForComparison_$=A);},_GetOverridesForComparison:function(){var A=this._GetOverridesForComparison_$;if (A) return A;A={};var B=this._StyleDesc.Overrides;if (B){if (!TETools.IsArray(B)) B=[B];for (var i=0;i<B.length;i++){var C=B[i];var D;var E;var F;if (typeof C=='string') D=C.toLowerCase();else{D=C.Element?C.Element.toLowerCase():this.Element;F=C.Attributes;};E=A[D]||(A[D]={});if (F){var G=(E.Attributes=E.Attributes||[]);for (var H in F){G.push([H.toLowerCase(),F[H]]);}}}};return (this._GetOverridesForComparison_$=A);},_CreateElementAttribsForComparison:function(A){var B={};var C=0;for (var i=0;i<A.attributes.length;i++){var D=A.attributes[i];if (D.specified){B[D.nodeName.toLowerCase()]=TEDomTools.GetAttributeValue(A,D).toLowerCase();C++;}};B._length=C;return B;},_CheckAttributesMatch:function(A,B){var C=A.attributes;var D=0;for (var i=0;i<C.length;i++){var E=C[i];if (E.specified){var F=E.nodeName.toLowerCase();var G=B[F];if (!G) break;if (G!=TEDomTools.GetAttributeValue(A,E).toLowerCase()) break;D++;}};return (D==B._length);}};
var TEStyles=TE.Styles={_Callbacks:{},_ObjectStyles:{},ApplyStyle:function(A){if (typeof A=='string') A=this.GetStyles()[A];if (A){if (A.GetType()==2) A.ApplyToObject(TESelection.GetSelectedElement());else A.ApplyToSelection(TE.EditorWindow);TE.Events.FireEvent('OnSelectionChange');}},RemoveStyle:function(A){if (typeof A=='string') A=this.GetStyles()[A];if (A){A.RemoveFromSelection(TE.EditorWindow);TE.Events.FireEvent('OnSelectionChange');}},AttachStyleStateChange:function(A,B,C){var D=this._Callbacks[A];if (!D) D=this._Callbacks[A]=[];D.push([B,C]);},CheckSelectionChanges:function(){var A=TESelection.GetBoundaryParentElement(true);if (!A) return;var B=new TEElementPath(A);var C=this.GetStyles();for (var D in C){var E=this._Callbacks[D];if (E){var F=C[D];var G=F.CheckActive(B);if (F._LastState!=G){F._LastState=G;for (var i=0;i<E.length;i++){var H=E[i][0];var I=E[i][1];H.call(I||window,D,G);}}}}},CheckStyleInSelection:function(A){return false;},_GetRemoveFormatTagsRegex:function (){var A=new RegExp('^(?:'+TEConfig.RemoveFormatTags.replace(/,/g,'|')+')$','i');return (this._GetRemoveFormatTagsRegex=function(){return A;})&&A;},RemoveAll:function(){var A=new TEDomRange(TE.EditorWindow);A.MoveToSelection();if (A.CheckIsCollapsed()) return;A.Expand('inline_elements');var B=A.CreateBookmark(true);var C=A.GetBookmarkNode(B,true);var D=A.GetBookmarkNode(B,false);A.Release(true);var E=this._GetRemoveFormatTagsRegex();var F=new TEElementPath(C);var G=F.Elements;var H;for (var i=1;i<G.length;i++){H=G[i];if (H==F.Block||H==F.BlockLimit) break;if (E.test(H.nodeName)) TEDomTools.BreakParent(C,H,A);};F=new TEElementPath(D);G=F.Elements;for (var i=1;i<G.length;i++){H=G[i];if (H==F.Block||H==F.BlockLimit) break;elementName=H.nodeName.toLowerCase();if (E.test(H.nodeName)) TEDomTools.BreakParent(D,H,A);};var I=TEDomTools.GetNextSourceNode(C,true,1);while (I){if (I==D) break;var J=TEDomTools.GetNextSourceNode(I,false,1);if (E.test(I.nodeName)) TEDomTools.RemoveNode(I,true);I=J;};A.SelectBookmark(B);TE.Events.FireEvent('OnSelectionChange');},GetStyle:function(A){return this.GetStyles()[A];},GetStyles:function(){var A=this._GetStyles;if (!A){A=this._GetStyles=TETools.Merge(this._LoadStylesCore(),this._LoadStylesCustom(),this._LoadStylesXml());};return A;},CheckHasObjectStyle:function(A){return!!this._ObjectStyles[A];},_LoadStylesCore:function(){var A={};var B=TEConfig.CoreStyles;for (var C in B){var D=A['_TE_'+C]=new TEStyle(B[C]);D.IsCore=true;};return A;},_LoadStylesCustom:function(){var A={};var B=TEConfig.CustomStyles;if (B){for (var C in B){var D=A[C]=new TEStyle(B[C]);D.Name=C;}};return A;},_LoadStylesXml:function(){var A={};var B=TEConfig.StylesXmlPath;if (!B||B.length==0) return A;var C=new TEXml();C.LoadUrl(B);var D=TEXml.TransformToObject(C.SelectSingleNode('Styles'));var E=D.$Style;if (!E) return A;for (var i=0;i<E.length;i++){var F=E[i];var G=(F.element||'').toLowerCase();if (G.length==0) throw('The element name is required. Error loading "'+B+'"');var H={Element:G,Attributes:{},Styles:{},Overrides:[]};var I=F.$Attribute||[];for (var j=0;j<I.length;j++){H.Attributes[I[j].name]=I[j].value;};var J=F.$Style||[];for (j=0;j<J.length;j++){H.Styles[J[j].name]=J[j].value;};var K=F.$Override;if (K){for (j=0;j<K.length;j++){var L=K[j];var M={Element:L.element};var N=L.$Attribute;if (N){M.Attributes={};for (var k=0;k<N.length;k++){var O=N[k].value||null;if (O){var P=O&&TERegexLib.RegExp.exec(O);if (P) O=new RegExp(P[1],P[2]||'');};M.Attributes[N[k].name]=O;}};H.Overrides.push(M);}};var Q=new TEStyle(H);Q.Name=F.name||G;if (Q.GetType()==2) this._ObjectStyles[G]=true;A[Q.Name]=Q;};return A;}};
var TEListHandler={OutdentListItem:function(A){var B=A.parentNode;if (B.tagName.toUpperCase().Equals('UL','OL')){var C=TETools.GetElementDocument(A);var D=new TEDocumentFragment(C);var E=D.RootNode;var F=false;var G=TEDomTools.GetFirstChild(A,['UL','OL']);if (G){F=true;var H;while ((H=G.firstChild)) E.appendChild(G.removeChild(H));TEDomTools.RemoveNode(G);};var I;var J=false;while ((I=A.nextSibling)){if (!F&&I.nodeType==1&&I.nodeName.toUpperCase()=='LI') J=F=true;E.appendChild(I.parentNode.removeChild(I));if (!J&&I.nodeType==1&&I.nodeName.toUpperCase().Equals('UL','OL')) TEDomTools.RemoveNode(I,true);};var K=B.parentNode.tagName.toUpperCase();var L=(K=='LI');if (L||K.Equals('UL','OL')){if (F){var G=B.cloneNode(false);D.AppendTo(G);A.appendChild(G);}else if (L) D.InsertAfterNode(B.parentNode);else D.InsertAfterNode(B);if (L) TEDomTools.InsertAfterNode(B.parentNode,B.removeChild(A));else TEDomTools.InsertAfterNode(B,B.removeChild(A));}else{if (F){var N=B.cloneNode(false);D.AppendTo(N);TEDomTools.InsertAfterNode(B,N);};var O=C.createElement(TEConfig.EnterMode=='p'?'p':'div');TEDomTools.MoveChildren(B.removeChild(A),O);TEDomTools.InsertAfterNode(B,O);if (TEConfig.EnterMode=='br'){if (TEBrowserInfo.IsGecko) O.parentNode.insertBefore(TETools.CreateBogusBR(C),O);else TEDomTools.InsertAfterNode(O,TETools.CreateBogusBR(C));TEDomTools.RemoveNode(O,true);}};if (this.CheckEmptyList(B)) TEDomTools.RemoveNode(B,true);}},CheckEmptyList:function(A){return (TEDomTools.GetFirstChild(A,'LI')==null);},CheckListHasContents:function(A){var B=A.firstChild;while (B){switch (B.nodeType){case 1:if (!B.nodeName.IEquals('UL','LI')) return true;break;case 3:if (B.nodeValue.Trim().length>0) return true;};B=B.nextSibling;};return false;}};
var TEElementPath=function(A){var B=null;var C=null;var D=[];var e=A;while (e){if (e.nodeType==1){if (!this.LastElement) this.LastElement=e;var E=e.nodeName.toLowerCase();if (!C){if (!B&&TEListsLib.PathBlockElements[E]!=null) B=e;if (TEListsLib.PathBlockLimitElements[E]!=null){if (!B&&E=='div') B=e;else C=e;}};D.push(e);if (E=='body') break;};e=e.parentNode;};this.Block=B;this.BlockLimit=C;this.Elements=D;};
var TEDomRange=function(A){this.Window=A;this._Cache={};};TEDomRange.prototype={_UpdateElementInfo:function(){var A=this._Range;if (!A) this.Release(true);else{var B=A.startContainer;var C=A.endContainer;var D=new TEElementPath(B);this.StartNode=B.nodeType==3?B:B.childNodes[A.startOffset];this.StartContainer=B;this.StartBlock=D.Block;this.StartBlockLimit=D.BlockLimit;if (B!=C) D=new TEElementPath(C);var E=C;if (A.endOffset==0){while (E&&!E.previousSibling) E=E.parentNode;if (E) E=E.previousSibling;}else if (E.nodeType==1) E=E.childNodes[A.endOffset-1];this.EndNode=E;this.EndContainer=C;this.EndBlock=D.Block;this.EndBlockLimit=D.BlockLimit;};this._Cache={};},CreateRange:function(){return new TEW3CRange(this.Window.document);},DeleteContents:function(){if (this._Range){this._Range.deleteContents();this._UpdateElementInfo();}},ExtractContents:function(){if (this._Range){var A=this._Range.extractContents();this._UpdateElementInfo();return A;}},CheckIsCollapsed:function(){if (this._Range) return this._Range.collapsed;},Collapse:function(A){if (this._Range) this._Range.collapse(A);this._UpdateElementInfo();},Clone:function(){var A=TETools.CloneObject(this);if (this._Range) A._Range=this._Range.cloneRange();return A;},MoveToNodeContents:function(A){if (!this._Range) this._Range=this.CreateRange();this._Range.selectNodeContents(A);this._UpdateElementInfo();},MoveToElementStart:function(A){this.SetStart(A,1);this.SetEnd(A,1);},MoveToElementEditStart:function(A){var B;while ((B=A.firstChild)&&B.nodeType==1&&TEListsLib.EmptyElements[B.nodeName.toLowerCase()]==null) A=B;this.MoveToElementStart(A);},InsertNode:function(A){if (this._Range) this._Range.insertNode(A);},CheckIsEmpty:function(){if (this.CheckIsCollapsed()) return true;var A=this.Window.document.createElement('div');this._Range.cloneContents().AppendTo(A);TEDomTools.TrimNode(A);return (A.innerHTML.length==0);},CheckStartOfBlock:function(){var A=this._Cache;var B=A.IsStartOfBlock;if (B!=undefined) return B;var C=this.StartBlock||this.StartBlockLimit;var D=this._Range.startContainer;var E=this._Range.startOffset;var F;if (E>0){if (D.nodeType==3){var G=D.nodeValue.substr(0,E).Trim();if (G.length!=0) return A.IsStartOfBlock=false;}else F=D.childNodes[E-1];};if (!F) F=TEDomTools.GetPreviousSourceNode(D,true,null,C);while (F){switch (F.nodeType){case 1:if (!TEListsLib.InlineChildReqElements[F.nodeName.toLowerCase()]) return A.IsStartOfBlock=false;break;case 3:if (F.nodeValue.Trim().length>0) return A.IsStartOfBlock=false;};F=TEDomTools.GetPreviousSourceNode(F,false,null,C);};return A.IsStartOfBlock=true;},CheckEndOfBlock:function(A){var B=this._Cache.IsEndOfBlock;if (B!=undefined) return B;var C=this.EndBlock||this.EndBlockLimit;var D=this._Range.endContainer;var E=this._Range.endOffset;var F;if (D.nodeType==3){var G=D.nodeValue;if (E<G.length){G=G.substr(E);if (G.Trim().length!=0) return this._Cache.IsEndOfBlock=false;}}else F=D.childNodes[E];if (!F) F=TEDomTools.GetNextSourceNode(D,true,null,C);var H=false;while (F){switch (F.nodeType){case 1:var I=F.nodeName.toLowerCase();if (TEListsLib.InlineChildReqElements[I]) break;if (I=='br'&&!H){H=true;break;};return this._Cache.IsEndOfBlock=false;case 3:if (F.nodeValue.Trim().length>0) return this._Cache.IsEndOfBlock=false;};F=TEDomTools.GetNextSourceNode(F,false,null,C);};if (A) this.Select();return this._Cache.IsEndOfBlock=true;},CreateBookmark:function(A){var B={StartId:(new Date()).valueOf()+Math.floor(Math.random()*1000)+'S',EndId:(new Date()).valueOf()+Math.floor(Math.random()*1000)+'E'};var C=this.Window.document;var D;var E;var F;if (!this.CheckIsCollapsed()){E=C.createElement('span');E.style.display='none';E.id=B.EndId;E.setAttribute('_te_bookmark',true);E.innerHTML='&nbsp;';F=this.Clone();F.Collapse(false);F.InsertNode(E);};D=C.createElement('span');D.style.display='none';D.id=B.StartId;D.setAttribute('_te_bookmark',true);D.innerHTML='&nbsp;';F=this.Clone();F.Collapse(true);F.InsertNode(D);if (A){B.StartNode=D;B.EndNode=E;};if (E){this.SetStart(D,4);this.SetEnd(E,3);}else this.MoveToPosition(D,4);return B;},GetBookmarkNode:function(A,B){var C=this.Window.document;if (B) return A.StartNode||C.getElementById(A.StartId);else return A.EndNode||C.getElementById(A.EndId);},MoveToBookmark:function(A,B){var C=this.GetBookmarkNode(A,true);var D=this.GetBookmarkNode(A,false);this.SetStart(C,3);if (!B) TEDomTools.RemoveNode(C);if (D){this.SetEnd(D,3);if (!B) TEDomTools.RemoveNode(D);}else this.Collapse(true);this._UpdateElementInfo();},CreateBookmark2:function(){if (!this._Range) return { "Start":0,"End":0 };var A={"Start":[this._Range.startOffset],"End":[this._Range.endOffset]};var B=this._Range.startContainer.previousSibling;var C=this._Range.endContainer.previousSibling;var D=this._Range.startContainer;var E=this._Range.endContainer;while (B&&B.nodeType==3){A.Start[0]+=B.length;D=B;B=B.previousSibling;};while (C&&C.nodeType==3){A.End[0]+=C.length;E=C;C=C.previousSibling;};if (D.nodeType==1&&D.childNodes[A.Start[0]]&&D.childNodes[A.Start[0]].nodeType==3){var F=D.childNodes[A.Start[0]];var G=0;while (F.previousSibling&&F.previousSibling.nodeType==3){F=F.previousSibling;G+=F.length;};D=F;A.Start[0]=G;};if (E.nodeType==1&&E.childNodes[A.End[0]]&&E.childNodes[A.End[0]].nodeType==3){var F=E.childNodes[A.End[0]];var G=0;while (F.previousSibling&&F.previousSibling.nodeType==3){F=F.previousSibling;G+=F.length;};E=F;A.End[0]=G;};A.Start=TEDomTools.GetNodeAddress(D,true).concat(A.Start);A.End=TEDomTools.GetNodeAddress(E,true).concat(A.End);return A;},MoveToBookmark2:function(A){var B=TEDomTools.GetNodeFromAddress(this.Window.document,A.Start.slice(0,-1),true);var C=TEDomTools.GetNodeFromAddress(this.Window.document,A.End.slice(0,-1),true);this.Release(true);this._Range=new TEW3CRange(this.Window.document);var D=A.Start[A.Start.length-1];var E=A.End[A.End.length-1];while (B.nodeType==3&&D>B.length){if (!B.nextSibling||B.nextSibling.nodeType!=3) break;D-=B.length;B=B.nextSibling;};while (C.nodeType==3&&E>C.length){if (!C.nextSibling||C.nextSibling.nodeType!=3) break;E-=C.length;C=C.nextSibling;};this._Range.setStart(B,D);this._Range.setEnd(C,E);this._UpdateElementInfo();},MoveToPosition:function(A,B){this.SetStart(A,B);this.Collapse(true);},SetStart:function(A,B,C){var D=this._Range;if (!D) D=this._Range=this.CreateRange();switch(B){case 1:D.setStart(A,0);break;case 2:D.setStart(A,A.childNodes.length);break;case 3:D.setStartBefore(A);break;case 4:D.setStartAfter(A);};if (!C) this._UpdateElementInfo();},SetEnd:function(A,B,C){var D=this._Range;if (!D) D=this._Range=this.CreateRange();switch(B){case 1:D.setEnd(A,0);break;case 2:D.setEnd(A,A.childNodes.length);break;case 3:D.setEndBefore(A);break;case 4:D.setEndAfter(A);};if (!C) this._UpdateElementInfo();},Expand:function(A){var B,oSibling;switch (A){case 'inline_elements':if (this._Range.startOffset==0){B=this._Range.startContainer;if (B.nodeType!=1) B=B.previousSibling?null:B.parentNode;if (B){while (TEListsLib.InlineNonEmptyElements[B.nodeName.toLowerCase()]){this._Range.setStartBefore(B);if (B!=B.parentNode.firstChild) break;B=B.parentNode;}}};B=this._Range.endContainer;var C=this._Range.endOffset;if ((B.nodeType==3&&C>=B.nodeValue.length)||(B.nodeType==1&&C>=B.childNodes.length)||(B.nodeType!=1&&B.nodeType!=3)){if (B.nodeType!=1) B=B.nextSibling?null:B.parentNode;if (B){while (TEListsLib.InlineNonEmptyElements[B.nodeName.toLowerCase()]){this._Range.setEndAfter(B);if (B!=B.parentNode.lastChild) break;B=B.parentNode;}}};break;case 'block_contents':case 'list_contents':var D=TEListsLib.BlockBoundaries;if (A=='list_contents'||TEConfig.EnterMode=='br') D=TEListsLib.ListBoundaries;if (this.StartBlock&&TEConfig.EnterMode!='br'&&A=='block_contents') this.SetStart(this.StartBlock,1);else{B=this._Range.startContainer;if (B.nodeType==1){var E=B.childNodes[this._Range.startOffset];if (E) B=TEDomTools.GetPreviousSourceNode(E,true);else B=B.lastChild||B;};while (B&&(B.nodeType!=1||(B!=this.StartBlockLimit&&!D[B.nodeName.toLowerCase()]))){this._Range.setStartBefore(B);B=B.previousSibling||B.parentNode;}};if (this.EndBlock&&TEConfig.EnterMode!='br'&&A=='block_contents'&&this.EndBlock.nodeName.toLowerCase()!='li') this.SetEnd(this.EndBlock,2);else{B=this._Range.endContainer;if (B.nodeType==1) B=B.childNodes[this._Range.endOffset]||B.lastChild;while (B&&(B.nodeType!=1||(B!=this.StartBlockLimit&&!D[B.nodeName.toLowerCase()]))){this._Range.setEndAfter(B);B=B.nextSibling||B.parentNode;};if (B&&B.nodeName.toLowerCase()=='br') this._Range.setEndAfter(B);};this._UpdateElementInfo();}},SplitBlock:function(){if (!this._Range) this.MoveToSelection();if (this.StartBlockLimit==this.EndBlockLimit){var A=this.StartBlock;var B=this.EndBlock;var C=null;if (TEConfig.EnterMode!='br'){if (!A){A=this.FixBlock(true);B=this.EndBlock;};if (!B) B=this.FixBlock(false);};var D=(A!=null&&this.CheckStartOfBlock());var E=(B!=null&&this.CheckEndOfBlock());if (!this.CheckIsEmpty()) this.DeleteContents();if (A&&B&&A==B){if (E){C=new TEElementPath(this.StartContainer);this.MoveToPosition(B,4);B=null;}else if (D){C=new TEElementPath(this.StartContainer);this.MoveToPosition(A,3);A=null;}else{this.SetEnd(A,2);var F=this.ExtractContents();B=A.cloneNode(false);B.removeAttribute('id',false);F.AppendTo(B);TEDomTools.InsertAfterNode(A,B);this.MoveToPosition(A,4);if (TEBrowserInfo.IsGecko&&!A.nodeName.IEquals(['ul','ol'])) TETools.AppendBogusBr(A);}};return {PreviousBlock:A,NextBlock:B,WasStartOfBlock:D,WasEndOfBlock:E,ElementPath:C};};return null;},FixBlock:function(A){var B=this.CreateBookmark();this.Collapse(A);this.Expand('block_contents');var C=this.Window.document.createElement(TEConfig.EnterMode);this.ExtractContents().AppendTo(C);TEDomTools.TrimNode(C);this.InsertNode(C);this.MoveToBookmark(B);return C;},Release:function(A){if (!A) this.Window=null;this.StartNode=null;this.StartContainer=null;this.StartBlock=null;this.StartBlockLimit=null;this.EndNode=null;this.EndContainer=null;this.EndBlock=null;this.EndBlockLimit=null;this._Range=null;this._Cache=null;},CheckHasRange:function(){return!!this._Range;},GetTouchedStartNode:function(){var A=this._Range;var B=A.startContainer;if (A.collapsed||B.nodeType!=1) return B;return B.childNodes[A.startOffset]||B;},GetTouchedEndNode:function(){var A=this._Range;var B=A.endContainer;if (A.collapsed||B.nodeType!=1) return B;return B.childNodes[A.endOffset-1]||B;}};
TEDomRange.prototype.MoveToSelection=function(){this.Release(true);this._Range=new TEW3CRange(this.Window.document);var A=this.Window.document.selection;if (A.type!='Control'){var B=this._GetSelectionMarkerTag(true);var C=this._GetSelectionMarkerTag(false);if (!B&&!C){this._Range.setStart(this.Window.document.body,0);this._UpdateElementInfo();return;};this._Range.setStart(B.parentNode,TEDomTools.GetIndexOf(B));B.parentNode.removeChild(B);this._Range.setEnd(C.parentNode,TEDomTools.GetIndexOf(C));C.parentNode.removeChild(C);this._UpdateElementInfo();}else{var D=A.createRange().item(0);if (D){this._Range.setStartBefore(D);this._Range.setEndAfter(D);this._UpdateElementInfo();}}};TEDomRange.prototype.Select=function(A){if (this._Range) this.SelectBookmark(this.CreateBookmark(true),A);};TEDomRange.prototype.SelectBookmark=function(A,B){var C=this.CheckIsCollapsed();var D;var E;var F=this.GetBookmarkNode(A,true);if (!F) return;var G;if (!C) G=this.GetBookmarkNode(A,false);var H=this.Window.document.body.createTextRange();H.moveToElementText(F);H.moveStart('character',1);if (G){var I=this.Window.document.body.createTextRange();I.moveToElementText(G);H.setEndPoint('EndToEnd',I);H.moveEnd('character',-1);}else{D=(B||!F.previousSibling||F.previousSibling.nodeName.toLowerCase()=='br')&&!F.nextSibing;E=this.Window.document.createElement('span');E.innerHTML='&#65279;';F.parentNode.insertBefore(E,F);if (D){F.parentNode.insertBefore(this.Window.document.createTextNode('\ufeff'),F);}};if (!this._Range) this._Range=this.CreateRange();this._Range.setStartBefore(F);F.parentNode.removeChild(F);if (C){if (D){H.moveStart('character',-1);H.select();this.Window.document.selection.clear();}else H.select();TEDomTools.RemoveNode(E);}else{this._Range.setEndBefore(G);G.parentNode.removeChild(G);H.select();}};TEDomRange.prototype._GetSelectionMarkerTag=function(A){var B=this.Window.document;var C=B.selection;var D;try{D=C.createRange();}catch (e){return null;};if (D.parentElement().document!=B) return null;D.collapse(A===true);var E='te_dom_range_temp_'+(new Date()).valueOf()+'_'+Math.floor(Math.random()*1000);D.pasteHTML('<span id="'+E+'"></span>');return B.getElementById(E);};
var TEDomRangeIterator=function(A){this.Range=A;this.ForceBrBreak=false;this.EnforceRealBlocks=false;};TEDomRangeIterator.CreateFromSelection=function(A){var B=new TEDomRange(A);B.MoveToSelection();return new TEDomRangeIterator(B);};TEDomRangeIterator.prototype={GetNextParagraph:function(){var A;var B;var C;var D;var E;var F=this.ForceBrBreak?TEListsLib.ListBoundaries:TEListsLib.BlockBoundaries;if (!this._LastNode){var B=this.Range.Clone();B.Expand(this.ForceBrBreak?'list_contents':'block_contents');this._NextNode=B.GetTouchedStartNode();this._LastNode=B.GetTouchedEndNode();B=null;};var H=this._NextNode;var I=this._LastNode;while (H){var J=false;var K=(H.nodeType!=1);var L=false;if (!K){var M=H.nodeName.toLowerCase();if (F[M]){if (M=='br') K=true;else if (!B&&H.childNodes.length==0&&M!='hr'){A=H;C=H==I;break;};J=true;}else{if (H.firstChild){if (!B){B=new TEDomRange(this.Range.Window);B.SetStart(H,3,true);};H=H.firstChild;continue;};K=true;}}else if (H.nodeType==3){if (/^[\r\n\t ]+$/.test(H.nodeValue)) K=false;};if (K&&!B){B=new TEDomRange(this.Range.Window);B.SetStart(H,3,true);};C=((!J||K)&&H==I);if (B&&!J){while (!H.nextSibling&&!C){var N=H.parentNode;if (F[N.nodeName.toLowerCase()]){J=true;C=C||(N==I);break;};H=N;C=(H==I);L=true;}};if (K) B.SetEnd(H,4,true);if ((J||C)&&B){B._UpdateElementInfo();if (B.StartNode==B.EndNode&&B.StartNode.parentNode==B.StartBlockLimit&&B.StartNode.getAttribute&&B.StartNode.getAttribute('_te_bookmark')) B=null;else break;};if (C) break;H=TEDomTools.GetNextSourceNode(H,L,null,I);};if (!A){if (!B){this._NextNode=null;return null;};A=B.StartBlock;if (!A&&!this.EnforceRealBlocks&&B.StartBlockLimit.nodeName.IEquals('DIV','TH','TD')&&B.CheckStartOfBlock()&&B.CheckEndOfBlock()){A=B.StartBlockLimit;}else if (!A||(this.EnforceRealBlocks&&A.nodeName.toLowerCase()=='li')){A=this.Range.Window.document.createElement(TEConfig.EnterMode=='p'?'p':'div');B.ExtractContents().AppendTo(A);TEDomTools.TrimNode(A);B.InsertNode(A);D=true;E=true;}else if (A.nodeName.toLowerCase()!='li'){if (!B.CheckStartOfBlock()||!B.CheckEndOfBlock()){A=A.cloneNode(false);B.ExtractContents().AppendTo(A);TEDomTools.TrimNode(A);var O=B.SplitBlock();D=!O.WasStartOfBlock;E=!O.WasEndOfBlock;TEDebug.Output('removePreviousBr='+D+',removeLastBr='+E);B.InsertNode(A);}}else if (!C){this._NextNode=A==I?null:TEDomTools.GetNextSourceNode(B.EndNode,true,null,I);return A;}};if (D){var P=A.previousSibling;if (P&&P.nodeType==1){if (P.nodeName.toLowerCase()=='br') P.parentNode.removeChild(P);else if (P.lastChild&&P.lastChild.nodeName.IEquals('br')) P.removeChild(P.lastChild);}};if (E){var Q=A.lastChild;if (Q&&Q.nodeType==1&&Q.nodeName.toLowerCase()=='br') A.removeChild(Q);};this._NextNode=(C||A==I)?null:TEDomTools.GetNextSourceNode(A,true,null,I);return A;}};
var TEDocumentFragment=function(A){this._Document=A;this.RootNode=A.createElement('div');};TEDocumentFragment.prototype={AppendTo:function(A){TEDomTools.MoveChildren(this.RootNode,A);},AppendHtml:function(A){var B=this._Document.createElement('div');B.innerHTML=A;TEDomTools.MoveChildren(B,this.RootNode);},InsertAfterNode:function(A){var B=this.RootNode;var C;while((C=B.lastChild)) TEDomTools.InsertAfterNode(A,B.removeChild(C));}};
var TEW3CRange=function(A){this._Document=A;this.startContainer=null;this.startOffset=null;this.endContainer=null;this.endOffset=null;this.collapsed=true;};TEW3CRange.CreateRange=function(A){return new TEW3CRange(A);};TEW3CRange.CreateFromRange=function(A,B){var C=TEW3CRange.CreateRange(A);C.setStart(B.startContainer,B.startOffset);C.setEnd(B.endContainer,B.endOffset);return C;};TEW3CRange.prototype={_UpdateCollapsed:function(){this.collapsed=(this.startContainer==this.endContainer&&this.startOffset==this.endOffset);},setStart:function(A,B){this.startContainer=A;this.startOffset=B;if (!this.endContainer){this.endContainer=A;this.endOffset=B;};this._UpdateCollapsed();},setEnd:function(A,B){this.endContainer=A;this.endOffset=B;if (!this.startContainer){this.startContainer=A;this.startOffset=B;};this._UpdateCollapsed();},setStartAfter:function(A){this.setStart(A.parentNode,TEDomTools.GetIndexOf(A)+1);},setStartBefore:function(A){this.setStart(A.parentNode,TEDomTools.GetIndexOf(A));},setEndAfter:function(A){this.setEnd(A.parentNode,TEDomTools.GetIndexOf(A)+1);},setEndBefore:function(A){this.setEnd(A.parentNode,TEDomTools.GetIndexOf(A));},collapse:function(A){if (A){this.endContainer=this.startContainer;this.endOffset=this.startOffset;}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset;};this.collapsed=true;},selectNodeContents:function(A){this.setStart(A,0);this.setEnd(A,A.nodeType==3?A.data.length:A.childNodes.length);},insertNode:function(A){var B=this.startContainer;var C=this.startOffset;if (B.nodeType==3){B.splitText(C);if (B==this.endContainer) this.setEnd(B.nextSibling,this.endOffset-this.startOffset);TEDomTools.InsertAfterNode(B,A);return;}else{B.insertBefore(A,B.childNodes[C]||null);if (B==this.endContainer){this.endOffset++;this.collapsed=false;}}},deleteContents:function(){if (this.collapsed) return;this._ExecContentsAction(0);},extractContents:function(){var A=new TEDocumentFragment(this._Document);if (!this.collapsed) this._ExecContentsAction(1,A);return A;},cloneContents:function(){var A=new TEDocumentFragment(this._Document);if (!this.collapsed) this._ExecContentsAction(2,A);return A;},_ExecContentsAction:function(A,B){var C=this.startContainer;var D=this.endContainer;var E=this.startOffset;var F=this.endOffset;var G=false;var H=false;if (D.nodeType==3) D=D.splitText(F);else{if (D.childNodes.length>0){if (F>D.childNodes.length-1){D=TEDomTools.InsertAfterNode(D.lastChild,this._Document.createTextNode(''));H=true;}else D=D.childNodes[F];}};if (C.nodeType==3){C.splitText(E);if (C==D) D=C.nextSibling;}else{if (C.childNodes.length>0&&E<=C.childNodes.length-1){if (E==0){C=C.insertBefore(this._Document.createTextNode(''),C.firstChild);G=true;}else C=C.childNodes[E].previousSibling;}};var I=TEDomTools.GetParents(C);var J=TEDomTools.GetParents(D);var i,topStart,topEnd;for (i=0;i<I.length;i++){topStart=I[i];topEnd=J[i];if (topStart!=topEnd) break;};var K,levelStartNode,levelClone,currentNode,currentSibling;if (B) K=B.RootNode;for (var j=i;j<I.length;j++){levelStartNode=I[j];if (K&&levelStartNode!=C) levelClone=K.appendChild(levelStartNode.cloneNode(levelStartNode==C));currentNode=levelStartNode.nextSibling;while(currentNode){if (currentNode==J[j]||currentNode==D) break;currentSibling=currentNode.nextSibling;if (A==2) K.appendChild(currentNode.cloneNode(true));else{currentNode.parentNode.removeChild(currentNode);if (A==1) K.appendChild(currentNode);};currentNode=currentSibling;};if (K) K=levelClone;};if (B) K=B.RootNode;for (var k=i;k<J.length;k++){levelStartNode=J[k];if (A>0&&levelStartNode!=D) levelClone=K.appendChild(levelStartNode.cloneNode(levelStartNode==D));if (!I[k]||levelStartNode.parentNode!=I[k].parentNode){currentNode=levelStartNode.previousSibling;while(currentNode){if (currentNode==I[k]||currentNode==C) break;currentSibling=currentNode.previousSibling;if (A==2) K.insertBefore(currentNode.cloneNode(true),K.firstChild);else{currentNode.parentNode.removeChild(currentNode);if (A==1) K.insertBefore(currentNode,K.firstChild);};currentNode=currentSibling;}};if (K) K=levelClone;};if (A==2){var L=this.startContainer;if (L.nodeType==3){L.data+=L.nextSibling.data;L.parentNode.removeChild(L.nextSibling);};var M=this.endContainer;if (M.nodeType==3&&M.nextSibling){M.data+=M.nextSibling.data;M.parentNode.removeChild(M.nextSibling);}}else{if (topStart&&topEnd&&(C.parentNode!=topStart.parentNode||D.parentNode!=topEnd.parentNode)){var N=TEDomTools.GetIndexOf(topEnd);if (G&&topEnd.parentNode==C.parentNode) N--;this.setStart(topEnd.parentNode,N);};this.collapse(true);};if(G) C.parentNode.removeChild(C);if(H&&D.parentNode) D.parentNode.removeChild(D);},cloneRange:function(){return TEW3CRange.CreateFromRange(this._Document,this);}};
var TEEnterKey=function(A,B,C,D){this.Window=A;this.EnterMode=B||'p';this.ShiftEnterMode=C||'br';var E=new TEKeystrokeHandler(false);E._EnterKey=this;E.OnKeystroke=TEEnterKey_OnKeystroke;E.SetKeystrokes([[13,'Enter'],[SHIFT+13,'ShiftEnter'],[9,'Tab'],[8,'Backspace'],[CTRL+8,'CtrlBackspace'],[46,'Delete']]);if (D>0){this.TabText='';while (D-->0) this.TabText+='\xa0';};E.AttachToElement(A.document);};function TEEnterKey_OnKeystroke(A,B){var C=this._EnterKey;try{switch (B){case 'Enter':return C.DoEnter();break;case 'ShiftEnter':return C.DoShiftEnter();break;case 'Backspace':return C.DoBackspace();break;case 'Delete':return C.DoDelete();break;case 'Tab':return C.DoTab();break;case 'CtrlBackspace':return C.DoCtrlBackspace();break;}}catch (e){};return false;};TEEnterKey.prototype.DoEnter=function(A,B){TEUndo.SaveUndoStep();this._HasShift=(B===true);var C=TESelection.GetParentElement();var D=new TEElementPath(C);var E=A||this.EnterMode;if (E=='br'||D.Block&&D.Block.tagName.toLowerCase()=='pre') return this._ExecuteEnterBr();else return this._ExecuteEnterBlock(E);};TEEnterKey.prototype.DoShiftEnter=function(){return this.DoEnter(this.ShiftEnterMode,true);};TEEnterKey.prototype.DoBackspace=function(){var A=false;var B=new TEDomRange(this.Window);B.MoveToSelection();if (TEBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(B,this.Window.document.body)){this._FixIESelectAllBug(B);return true;};var C=B.CheckIsCollapsed();if (!C){if (TEBrowserInfo.IsIE&&this.Window.document.selection.type.toLowerCase()=="control"){var D=this.Window.document.selection.createRange();for (var i=D.length-1;i>=0;i--){var E=D.item(i);E.parentNode.removeChild(E);};return true;};return false;};var F=B.StartBlock;var G=B.EndBlock;if (B.StartBlockLimit==B.EndBlockLimit&&F&&G){if (!C){var H=B.CheckEndOfBlock();B.DeleteContents();if (F!=G){B.SetStart(G,1);B.SetEnd(G,1);};B.Select();A=(F==G);};if (B.CheckStartOfBlock()){var I=B.StartBlock;var J=TEDomTools.GetPreviousSourceElement(I,true,['BODY',B.StartBlockLimit.nodeName],['UL','OL']);A=this._ExecuteBackspace(B,J,I);}else if (TEBrowserInfo.IsGeckoLike){B.Select();}};B.Release();return A;};TEEnterKey.prototype.DoCtrlBackspace=function(){TEUndo.SaveUndoStep();var A=new TEDomRange(this.Window);A.MoveToSelection();if (TEBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(A,this.Window.document.body)){this._FixIESelectAllBug(A);return true;};return false;};TEEnterKey.prototype._ExecuteBackspace=function(A,B,C){var D=false;if (!B&&C&&C.nodeName.IEquals('LI')&&C.parentNode.parentNode.nodeName.IEquals('LI')){this._OutdentWithSelection(C,A);return true;};if (B&&B.nodeName.IEquals('LI')){var E=TEDomTools.GetLastChild(B,['UL','OL']);while (E){B=TEDomTools.GetLastChild(E,'LI');E=TEDomTools.GetLastChild(B,['UL','OL']);}};if (B&&C){if (C.nodeName.IEquals('LI')&&!B.nodeName.IEquals('LI')){this._OutdentWithSelection(C,A);return true;};var F=C.parentNode;var G=B.nodeName.toLowerCase();if (TEListsLib.EmptyElements[G]!=null||G=='table'){TEDomTools.RemoveNode(B);D=true;}else{TEDomTools.RemoveNode(C);while (F.innerHTML.Trim().length==0){var H=F.parentNode;H.removeChild(F);F=H;};TEDomTools.LTrimNode(C);TEDomTools.RTrimNode(B);A.SetStart(B,2,true);A.Collapse(true);var I=A.CreateBookmark(true);if (!C.tagName.IEquals(['TABLE'])) TEDomTools.MoveChildren(C,B);A.SelectBookmark(I);D=true;}};return D;};TEEnterKey.prototype.DoDelete=function(){TEUndo.SaveUndoStep();var A=false;var B=new TEDomRange(this.Window);B.MoveToSelection();if (TEBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(B,this.Window.document.body)){this._FixIESelectAllBug(B);return true;};if (B.CheckIsCollapsed()&&B.CheckEndOfBlock(TEBrowserInfo.IsGeckoLike)){var C=B.StartBlock;var D=TETools.GetElementAscensor(C,'td');var E=TEDomTools.GetNextSourceElement(C,true,[B.StartBlockLimit.nodeName],['UL','OL','TR'],true);if (D){var F=TETools.GetElementAscensor(E,'td');if (F!=D) return true;};A=this._ExecuteBackspace(B,C,E);};B.Release();return A;};TEEnterKey.prototype.DoTab=function(){var A=new TEDomRange(this.Window);A.MoveToSelection();var B=A._Range.startContainer;while (B){if (B.nodeType==1){var C=B.tagName.toLowerCase();if (C=="tr"||C=="td"||C=="th"||C=="tbody"||C=="table") return false;else break;};B=B.parentNode;};if (this.TabText){A.DeleteContents();A.InsertNode(this.Window.document.createTextNode(this.TabText));A.Collapse(false);A.Select();};return true;};TEEnterKey.prototype._ExecuteEnterBlock=function(A,B){var C=B||new TEDomRange(this.Window);var D=C.SplitBlock();if (D){var E=D.PreviousBlock;var F=D.NextBlock;var G=D.WasStartOfBlock;var H=D.WasEndOfBlock;if (!D.WasStartOfBlock&&!D.WasEndOfBlock){if (F.nodeName.IEquals('li')&&F.firstChild&&F.firstChild.nodeName.IEquals(['ul','ol'])) F.insertBefore(F.ownerDocument.createTextNode('\xa0'),F.firstChild);if (F) C.MoveToElementEditStart(F);}else{if (G&&H&&E.tagName.toUpperCase()=='LI'){C.MoveToElementStart(E);this._OutdentWithSelection(E,C);C.Release();return true;};var I;if (E){var J=E.tagName.toUpperCase();if (!this._HasShift&&!(/^H[1-6]$/).test(J)){I=TEDomTools.CloneElement(E);}}else if (F) I=TEDomTools.CloneElement(F);if (!I) I=this.Window.document.createElement(A);var K=D.ElementPath;if (K){var L=I;for (var i=0,len=K.Elements.length;i<len;i++){var M=K.Elements[i];if (M==K.Block||M==K.BlockLimit) break;if (TEListsLib.InlineChildReqElements[M.nodeName.toLowerCase()]) L=L.appendChild(TEDomTools.CloneElement(M));}};if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(I);C.InsertNode(I);if (TEBrowserInfo.IsIE){C.MoveToNodeContents(I);C.Select();};C.MoveToElementEditStart(G&&!H?F:I);};if (TEBrowserInfo.IsSafari) TEDomTools.ScrollIntoView(F||I,false);else if (TEBrowserInfo.IsGeckoLike) (F||I).scrollIntoView(false);C.Select();};C.Release();return true;};TEEnterKey.prototype._ExecuteEnterBr=function(A){var B=new TEDomRange(this.Window);B.MoveToSelection();if (B.StartBlockLimit==B.EndBlockLimit){B.DeleteContents();B.MoveToSelection();var C=B.CheckStartOfBlock();var D=B.CheckEndOfBlock();var E=B.StartBlock?B.StartBlock.tagName.toUpperCase():'';var F=this._HasShift;var G=false;if (!F&&E=='LI') return this._ExecuteEnterBlock(null,B);if (!F&&D&&(/^H[1-6]$/).test(E)){TEDomTools.InsertAfterNode(B.StartBlock,this.Window.document.createElement('br'));if (TEBrowserInfo.IsGecko) TEDomTools.InsertAfterNode(B.StartBlock,this.Window.document.createTextNode(''));B.SetStart(B.StartBlock.nextSibling,TEBrowserInfo.IsIE?3:1);}else{var H;G=E.IEquals('pre');if (G) H=this.Window.document.createTextNode(TEBrowserInfo.IsIE?'\r':'\n');else H=this.Window.document.createElement('br');B.InsertNode(H);if (TEBrowserInfo.IsGecko) TEDomTools.InsertAfterNode(H,this.Window.document.createTextNode(''));if (D&&TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(H.parentNode);if (TEBrowserInfo.IsIE) B.SetStart(H,4);else B.SetStart(H.nextSibling,1);if (!TEBrowserInfo.IsIE){var I=null;if (TEBrowserInfo.IsOpera) I=this.Window.document.createElement('span');else I=this.Window.document.createElement('br');H.parentNode.insertBefore(I,H.nextSibling);if (TEBrowserInfo.IsSafari) TEDomTools.ScrollIntoView(I,false);else I.scrollIntoView(false);I.parentNode.removeChild(I);}};B.Collapse(true);B.Select(G);};B.Release();return true;};TEEnterKey.prototype._OutdentWithSelection=function(A,B){var C=B.CreateBookmark();TEListHandler.OutdentListItem(A);B.MoveToBookmark(C);B.Select();};TEEnterKey.prototype._CheckIsAllContentsIncluded=function(A,B){var C=false;var D=false;if (A.StartContainer==B||A.StartContainer==B.firstChild) C=(A._Range.startOffset==0);if (A.EndContainer==B||A.EndContainer==B.lastChild){var E=A.EndContainer.nodeType==3?A.EndContainer.length:A.EndContainer.childNodes.length;D=(A._Range.endOffset==E);};return C&&D;};TEEnterKey.prototype._FixIESelectAllBug=function(A){var B=this.Window.document;B.body.innerHTML='';var C;if (TEConfig.EnterMode.IEquals(['div','p'])){C=B.createElement(TEConfig.EnterMode);B.body.appendChild(C);}else C=B.body;A.MoveToNodeContents(C);A.Collapse(true);A.Select();A.Release();};
var TEDocumentProcessor={};TEDocumentProcessor._Items=[];TEDocumentProcessor.AppendNew=function(){var A={};this._Items.AddItem(A);return A;};TEDocumentProcessor.Process=function(A){var B,i=0;while((B=this._Items[i++])) B.ProcessDocument(A);};var TEDocumentProcessor_CreateFakeImage=function(A,B){var C=TE.EditorDocument.createElement('IMG');C.className=A;C.src=TEConfig.FullBasePath+'images/spacer.gif';C.setAttribute('_tefakelement','true',0);C.setAttribute('_terealelement',TETempBin.AddElement(B),0);return C;};if (TEBrowserInfo.IsIE||TEBrowserInfo.IsOpera){var TEAnchorsProcessor=TEDocumentProcessor.AppendNew();TEAnchorsProcessor.ProcessDocument=function(A){var B=A.getElementsByTagName('A');var C;var i=B.length-1;while (i>=0&&(C=B[i--])){if (C.name.length>0){if (C.innerHTML!==''){if (TEBrowserInfo.IsIE) C.className+=' TE__AnchorC';}else{var D=TEDocumentProcessor_CreateFakeImage('TE__Anchor',C.cloneNode(true));D.setAttribute('_teanchor','true',0);C.parentNode.insertBefore(D,C);C.parentNode.removeChild(C);}}}}};var TEPageBreaksProcessor=TEDocumentProcessor.AppendNew();TEPageBreaksProcessor.ProcessDocument=function(A){var B=A.getElementsByTagName('DIV');var C;var i=B.length-1;while (i>=0&&(C=B[i--])){if (C.style.pageBreakAfter=='always'&&C.childNodes.length==1&&C.childNodes[0].style&&C.childNodes[0].style.display=='none'){var D=TEDocumentProcessor_CreateFakeImage('TE__PageBreak',C.cloneNode(true));C.parentNode.insertBefore(D,C);C.parentNode.removeChild(C);}}};var TEFlashProcessor=TEDocumentProcessor.AppendNew();TEFlashProcessor.ProcessDocument=function(A){var B=TE.IsDirty();var C=A.getElementsByTagName('EMBED');var D;var i=C.length-1;while (i>=0&&(D=C[i--])){var E=D.attributes['type'];if ((D.src&&D.src.EndsWith('.swf',true))||(E&&E.nodeValue=='application/x-shockwave-flash')){var F=D.cloneNode(true);var G=TEDocumentProcessor_CreateFakeImage('TE__Flash',F);G.setAttribute('_teflash','true',0);TEFlashProcessor.RefreshView(G,D);D.parentNode.insertBefore(G,D);D.parentNode.removeChild(D);}};if (!B) TE.ResetIsDirty();};TEFlashProcessor.RefreshView=function(A,B){if (B.getAttribute('width')>0) A.style.width=TETools.ConvertHtmlSizeToStyle(B.getAttribute('width'));if (B.getAttribute('height')>0) A.style.height=TETools.ConvertHtmlSizeToStyle(B.getAttribute('height'));};TE.GetRealElement=function(A){var e=TETempBin.Elements[A.getAttribute('_terealelement')];if (A.getAttribute('_teflash')){if (A.style.width.length>0) e.width=TETools.ConvertStyleSizeToHtml(A.style.width);if (A.style.height.length>0) e.height=TETools.ConvertStyleSizeToHtml(A.style.height);};return e;};if (TEBrowserInfo.IsIE){TEDocumentProcessor.AppendNew().ProcessDocument=function(A){var B=A.getElementsByTagName('HR');var C;var i=B.length-1;while (i>=0&&(C=B[i--])){var D=A.createElement('hr');D.mergeAttributes(C,true);TEDomTools.InsertAfterNode(C,D);C.parentNode.removeChild(C);}}};TEDocumentProcessor.AppendNew().ProcessDocument=function(A){var B=A.getElementsByTagName('INPUT');var C;var i=B.length-1;while (i>=0&&(C=B[i--])){if (C.type=='hidden'){var D=TEDocumentProcessor_CreateFakeImage('TE__InputHidden',C.cloneNode(true));D.setAttribute('_teinputhidden','true',0);C.parentNode.insertBefore(D,C);C.parentNode.removeChild(C);}}}
var TESelection=TE.Selection={GetParentBlock:function(){var A=this.GetParentElement();while (A){if (TEListsLib.BlockBoundaries[A.nodeName.toLowerCase()]) break;A=A.parentNode;};return A;},ApplyStyle:function(A){TEStyles.ApplyStyle(new TEStyle(A));}};
TESelection.GetType=function(){try{var A=TE.EditorDocument.selection.type;if (A=='Control'||A=='Text') return A;if (TE.EditorDocument.selection.createRange().parentElement) return 'Text';}catch(e){};return 'None';};TESelection.GetSelectedElement=function(){if (this.GetType()=='Control'){var A=TE.EditorDocument.selection.createRange();if (A&&A.item) return TE.EditorDocument.selection.createRange().item(0);};return null;};TESelection.GetParentElement=function(){switch (this.GetType()){case 'Control':var A=TESelection.GetSelectedElement();return A?A.parentElement:null;case 'None':return null;default:return TE.EditorDocument.selection.createRange().parentElement();}};TESelection.GetBoundaryParentElement=function(A){switch (this.GetType()){case 'Control':var B=TESelection.GetSelectedElement();return B?B.parentElement:null;case 'None':return null;default:var C=TE.EditorDocument;var D=C.selection.createRange();D.collapse(A!==false);var B=D.parentElement();return TETools.GetElementDocument(B)==C?B:null;}};TESelection.SelectNode=function(A){TE.Focus();TE.EditorDocument.selection.empty();var B;try{B=TE.EditorDocument.body.createControlRange();B.addElement(A);}catch(e){B=TE.EditorDocument.body.createTextRange();B.moveToElementText(A);};B.select();};TESelection.Collapse=function(A){TE.Focus();if (this.GetType()=='Text'){var B=TE.EditorDocument.selection.createRange();B.collapse(A==null||A===true);B.select();}};TESelection.HasAncestorNode=function(A){var B;if (TE.EditorDocument.selection.type=="Control"){B=this.GetSelectedElement();}else{var C=TE.EditorDocument.selection.createRange();B=C.parentElement();};while (B){if (B.tagName==A) return true;B=B.parentNode;};return false;};TESelection.MoveToAncestorNode=function(A){var B,oRange;if (!TE.EditorDocument) return null;if (TE.EditorDocument.selection.type=="Control"){oRange=TE.EditorDocument.selection.createRange();for (i=0;i<oRange.length;i++){if (oRange(i).parentNode){B=oRange(i).parentNode;break;}}}else{oRange=TE.EditorDocument.selection.createRange();B=oRange.parentElement();};while (B&&B.nodeName!=A) B=B.parentNode;return B;};TESelection.Delete=function(){var A=TE.EditorDocument.selection;if (A.type.toLowerCase()!="none"){A.clear();};return A;};
var TETableHandler={};TETableHandler.InsertRow=function(A){var B=TESelection.MoveToAncestorNode('TR');if (!B) return;var C=B.cloneNode(true);B.parentNode.insertBefore(C,B);TETableHandler.ClearRow(A?C:B);};TETableHandler.DeleteRows=function(A){if (!A){var B=TETableHandler.GetSelectedCells();var C=[];for (var i=0;i<B.length;i++){var D=TETools.GetElementAscensor(B[i],'TR');C[D.rowIndex]=D;};for (var i=C.length;i>=0;i--){if (C[i]) TETableHandler.DeleteRows(C[i]);};return;};var E=TETools.GetElementAscensor(A,'TABLE');if (E.rows.length==1){TETableHandler.DeleteTable(E);return;};A.parentNode.removeChild(A);};TETableHandler.DeleteTable=function(A){if (!A){A=TESelection.GetSelectedElement();if (!A||A.tagName!='TABLE') A=TESelection.MoveToAncestorNode('TABLE');};if (!A) return;TESelection.SelectNode(A);TESelection.Collapse();if (A.parentNode.childNodes.length==1) A.parentNode.parentNode.removeChild(A.parentNode);else A.parentNode.removeChild(A);};TETableHandler.InsertColumn=function(A){var B=null;var C=this.GetSelectedCells();if (C&&C.length) B=C[A?0:(C.length-1)];if (!B) return;var D=TETools.GetElementAscensor(B,'TABLE');var E=B.cellIndex;for (var i=0;i<D.rows.length;i++){var F=D.rows[i];if (F.cells.length<(E+1)) continue;B=F.cells[E].cloneNode(false);if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(B);var G=F.cells[E];if (A) F.insertBefore(B,G);else if (G.nextSibling) F.insertBefore(B,G.nextSibling);else F.appendChild(B);}};TETableHandler.DeleteColumns=function(A){if (!A){var B=TETableHandler.GetSelectedCells();for (var i=B.length;i>=0;i--){if (B[i]) TETableHandler.DeleteColumns(B[i]);};return;};if (!A) return;var C=TETools.GetElementAscensor(A,'TABLE');var D=A.cellIndex;for (var i=C.rows.length-1;i>=0;i--){var E=C.rows[i];if (D==0&&E.cells.length==1){TETableHandler.DeleteRows(E);continue;};if (E.cells[D]) E.removeChild(E.cells[D]);}};TETableHandler.InsertCell=function(A,B){var C=null;var D=this.GetSelectedCells();if (D&&D.length) C=D[B?0:(D.length-1)];if (!C) return null;var E=TE.EditorDocument.createElement('TD');if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(E);if (!B&&C.cellIndex==C.parentNode.cells.length-1) C.parentNode.appendChild(E);else C.parentNode.insertBefore(E,B?C:C.nextSibling);return E;};TETableHandler.DeleteCell=function(A){if (A.parentNode.cells.length==1){TETableHandler.DeleteRows(TETools.GetElementAscensor(A,'TR'));return;};A.parentNode.removeChild(A);};TETableHandler.DeleteCells=function(){var A=TETableHandler.GetSelectedCells();for (var i=A.length-1;i>=0;i--){TETableHandler.DeleteCell(A[i]);}};TETableHandler._MarkCells=function(A,B){for (var i=0;i<A.length;i++) A[i][B]=true;};TETableHandler._UnmarkCells=function(A,B){for (var i=0;i<A.length;i++){if (TEBrowserInfo.IsIE) A[i].removeAttribute(B);else delete A[i][B];}};TETableHandler._ReplaceCellsByMarker=function(A,B,C){for (var i=0;i<A.length;i++){for (var j=0;j<A[i].length;j++){if (A[i][j][B]) A[i][j]=C;}}};TETableHandler._GetMarkerGeometry=function(A,B,C,D){var E=0;var F=0;var G=0;var H=0;for (var i=C;A[B][i]&&A[B][i][D];i++) E++;for (var i=C-1;A[B][i]&&A[B][i][D];i--){E++;G++;};for (var i=B;A[i]&&A[i][C]&&A[i][C][D];i++) F++;for (var i=B-1;A[i]&&A[i][C]&&A[i][C][D];i--){F++;H++;};return { 'width':E,'height':F,'x':G,'y':H };};TETableHandler.CheckIsSelectionRectangular=function(){var A=TETableHandler.GetSelectedCells();if (A.length<1) return false;this._MarkCells(A,'_CellSelected');var B=this._CreateTableMap(A[0].parentNode.parentNode);var C=A[0].parentNode.rowIndex;var D=this._GetCellIndexSpan(B,C,A[0]);var E=this._GetMarkerGeometry(B,C,D,'_CellSelected');var F=D-E.x;var G=C-E.y;if (E.width>=E.height){for (D=F;D<F+E.width;D++){C=G+(D-F) % E.height;if (!B[C]||!B[C][D]){this._UnmarkCells(A,'_CellSelected');return false;};var g=this._GetMarkerGeometry(B,C,D,'_CellSelected');if (g.width!=E.width||g.height!=E.height){this._UnmarkCells(A,'_CellSelected');return false;}}}else{for (C=G;C<G+E.height;C++){D=F+(C-G) % E.width;if (!B[C]||!B[C][D]){this._UnmarkCells(A,'_CellSelected');return false;};var g=this._GetMarkerGeometry(B,C,D,'_CellSelected');if (g.width!=E.width||g.height!=E.height){this._UnmarkCells(A,'_CellSelected');return false;}}};this._UnmarkCells(A,'_CellSelected');return true;};TETableHandler.MergeCells=function(){var A=this.GetSelectedCells();if (A.length<2) return;var B=A[0];var C=this._CreateTableMap(B.parentNode.parentNode);var D=B.parentNode.rowIndex;var E=this._GetCellIndexSpan(C,D,B);this._MarkCells(A,'_SelectedCells');var F=this._GetMarkerGeometry(C,D,E,'_SelectedCells');var G=E-F.x;var H=D-F.y;var I=B.ownerDocument.createDocumentFragment();for (var i=0;i<F.height;i++){var J=0;for (var j=0;j<F.width;j++){var K=C[H+i][G+j];while (K.childNodes.length>0){var L=K.removeChild(K.firstChild);if (L.nodeType!=1||(L.getAttribute('type',2)!='_moz'&&L.getAttribute('_moz_dirty')!=null)){I.appendChild(L);J++;}}};if (J>0) I.appendChild(B.ownerDocument.createElement('br'));};this._ReplaceCellsByMarker(C,'_SelectedCells',B);this._UnmarkCells(A,'_SelectedCells');this._InstallTableMap(C,B.parentNode.parentNode);B.appendChild(I);if (TEBrowserInfo.IsGeckoLike&&(!B.firstChild)) TETools.AppendBogusBr(B);this._MoveCaretToCell(B,false);};TETableHandler.MergeRight=function(){var A=this.GetMergeRightTarget();if (A==null) return;var B=A.refCell;var C=A.tableMap;var D=A.nextCell;var E=TE.EditorDocument.createDocumentFragment();while (D&&D.childNodes&&D.childNodes.length>0) E.appendChild(D.removeChild(D.firstChild));D.parentNode.removeChild(D);B.appendChild(E);this._MarkCells([D],'_Replace');this._ReplaceCellsByMarker(C,'_Replace',B);this._InstallTableMap(C,B.parentNode.parentNode);this._MoveCaretToCell(B,false);};TETableHandler.MergeDown=function(){var A=this.GetMergeDownTarget();if (A==null) return;var B=A.refCell;var C=A.tableMap;var D=A.nextCell;var E=B.ownerDocument.createDocumentFragment();while (D&&D.childNodes&&D.childNodes.length>0) E.appendChild(D.removeChild(D.firstChild));if (E.firstChild) E.insertBefore(D.ownerDocument.createElement('br'),E.firstChild);B.appendChild(E);this._MarkCells([D],'_Replace');this._ReplaceCellsByMarker(C,'_Replace',B);this._InstallTableMap(C,B.parentNode.parentNode);this._MoveCaretToCell(B,false);};TETableHandler.HorizontalSplitCell=function(){var A=TETableHandler.GetSelectedCells();if (A.length!=1) return;var B=A[0];var C=this._CreateTableMap(B.parentNode.parentNode);var D=B.parentNode.rowIndex;var E=TETableHandler._GetCellIndexSpan(C,D,B);var F=isNaN(B.colSpan)?1:B.colSpan;if (F>1){var G=Math.ceil(F/2);var H=B.ownerDocument.createElement('td');if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(H);var I=E+G;var J=E+F;var K=isNaN(B.rowSpan)?1:B.rowSpan;for (var r=D;r<D+K;r++){for (var i=I;i<J;i++) C[r][i]=H;}}else{var L=[];for (var i=0;i<C.length;i++){var M=C[i].slice(0,E);if (C[i].length<=E){L.push(M);continue;};if (C[i][E]==B){M.push(B);M.push(B.ownerDocument.createElement('td'));if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(M[M.length-1]);}else{M.push(C[i][E]);M.push(C[i][E]);};for (var j=E+1;j<C[i].length;j++) M.push(C[i][j]);L.push(M);};C=L;};this._InstallTableMap(C,B.parentNode.parentNode);};TETableHandler.VerticalSplitCell=function(){var A=TETableHandler.GetSelectedCells();if (A.length!=1) return;var B=A[0];var C=this._CreateTableMap(B.parentNode.parentNode);var D=TETableHandler._GetCellIndexSpan(C,B.parentNode.rowIndex,B);var E=B.rowSpan;var F=B.parentNode.rowIndex;if (isNaN(E)) E=1;if (E>1){B.rowSpan=Math.ceil(E/2);var G=F+Math.ceil(E/2);var H=null;for (var i=D+1;i<C[G].length;i++){if (C[G][i].parentNode.rowIndex==G){H=C[G][i];break;}};var I=TE.EditorDocument.createElement('td');I.rowSpan=Math.floor(E/2);if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(I);B.parentNode.parentNode.rows[G].insertBefore(I,H);}else{var G=F+1;var K=TE.EditorDocument.createElement('tr');B.parentNode.parentNode.insertBefore(K,B.parentNode.parentNode.rows[G]);for (var i=0;i<C[F].length;){var L=C[F][i].colSpan;if (isNaN(L)||L<1) L=1;if (i==D){i+=L;continue;};var M=C[F][i].rowSpan;if (isNaN(M)) M=1;C[F][i].rowSpan=M+1;i+=L;};var I=TE.EditorDocument.createElement('td');if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(I);K.appendChild(I);}};TETableHandler._GetCellIndexSpan=function(A,B,C){if (A.length<B+1) return null;var D=A[B];for (var c=0;c<D.length;c++){if (D[c]==C) return c;};return null;};TETableHandler._GetCellLocation=function(A,B){for (var i=0;i<A.length;i++){for (var c=0;c<A[i].length;c++){if (A[i][c]==B) return [i,c];}};return null;};TETableHandler._GetColumnCells=function(A,B){var C=[];for (var r=0;r<A.length;r++){var D=A[r][B];if (D&&(C.length==0||C[C.length-1]!=D)) C[C.length]=D;};return C;};TETableHandler._CreateTableMap=function(A){var B=A.rows;var r=-1;var C=[];for (var i=0;i<B.length;i++){r++;if (!C[r]) C[r]=[];var c=-1;for (var j=0;j<B[i].cells.length;j++){var D=B[i].cells[j];c++;while (C[r][c]) c++;var E=isNaN(D.colSpan)?1:D.colSpan;var F=isNaN(D.rowSpan)?1:D.rowSpan;for (var G=0;G<F;G++){if (!C[r+G]) C[r+G]=[];for (var H=0;H<E;H++){C[r+G][c+H]=B[i].cells[j];}};c+=E-1;}};return C;};TETableHandler._InstallTableMap=function(A,B){while (B.rows.length>0){var C=B.rows[0];C.parentNode.removeChild(C);};for (var i=0;i<A.length;i++){for (var j=0;j<A[i].length;j++){var D=A[i][j];if (D.parentNode) D.parentNode.removeChild(D);D.colSpan=D.rowSpan=1;}};var E=0;for (var i=0;i<A.length;i++){for (var j=0;j<A[i].length;j++){var D=A[i][j];if (!D) continue;if (j>E) E=j;if (D._colScanned===true) continue;if (A[i][j-1]==D) D.colSpan++;if (A[i][j+1]!=D) D._colScanned=true;}};for (var i=0;i<=E;i++){for (var j=0;j<A.length;j++){if (!A[j]) continue;var D=A[j][i];if (!D||D._rowScanned===true) continue;if (A[j-1]&&A[j-1][i]==D) D.rowSpan++;if (!A[j+1]||A[j+1][i]!=D) D._rowScanned=true;}};for (var i=0;i<A.length;i++){for (var j=0;j<A[i].length;j++){var D=A[i][j];if (TEBrowserInfo.IsIE){D.removeAttribute('_colScanned');D.removeAttribute('_rowScanned');}else{delete D._colScanned;delete D._rowScanned;}}};for (var i=0;i<A.length;i++){var I=B.ownerDocument.createElement('tr');for (var j=0;j<A[i].length;){var D=A[i][j];if (A[i-1]&&A[i-1][j]==D){j+=D.colSpan;continue;};I.appendChild(D);j+=D.colSpan;if (D.colSpan==1) D.removeAttribute('colspan');if (D.rowSpan==1) D.removeAttribute('rowspan');};B.appendChild(I);}};TETableHandler._MoveCaretToCell=function (A,B){var C=new TEDomRange(TE.EditorWindow);C.MoveToNodeContents(A);C.Collapse(B);C.Select();};TETableHandler.ClearRow=function(A){var B=A.cells;for (var i=0;i<B.length;i++){B[i].innerHTML='';if (TEBrowserInfo.IsGeckoLike) TETools.AppendBogusBr(B[i]);}};TETableHandler.GetMergeRightTarget=function(){var A=this.GetSelectedCells();if (A.length!=1) return null;var B=A[0];var C=this._CreateTableMap(B.parentNode.parentNode);var D=B.parentNode.rowIndex;var E=this._GetCellIndexSpan(C,D,B);var F=E+(isNaN(B.colSpan)?1:B.colSpan);var G=C[D][F];if (!G) return null;this._MarkCells([B,G],'_SizeTest');var H=this._GetMarkerGeometry(C,D,E,'_SizeTest');var I=this._GetMarkerGeometry(C,D,F,'_SizeTest');this._UnmarkCells([B,G],'_SizeTest');if (H.height!=I.height||H.y!=I.y) return null;return { 'refCell':B,'nextCell':G,'tableMap':C };};TETableHandler.GetMergeDownTarget=function(){var A=this.GetSelectedCells();if (A.length!=1) return null;var B=A[0];var C=this._CreateTableMap(B.parentNode.parentNode);var D=B.parentNode.rowIndex;var E=this._GetCellIndexSpan(C,D,B);var F=D+(isNaN(B.rowSpan)?1:B.rowSpan);if (!C[F]) return null;var G=C[F][E];if (!G) return null;this._MarkCells([B,G],'_SizeTest');var H=this._GetMarkerGeometry(C,D,E,'_SizeTest');var I=this._GetMarkerGeometry(C,F,E,'_SizeTest');this._UnmarkCells([B,G],'_SizeTest');if (H.width!=I.width||H.x!=I.x) return null;return { 'refCell':B,'nextCell':G,'tableMap':C };};
TETableHandler.GetSelectedCells=function(){if (TESelection.GetType()=='Control'){var A=TESelection.MoveToAncestorNode('TD');return A?[A]:[];};var B=[];var C=TE.EditorDocument.selection.createRange();var D=TESelection.GetParentElement();if (D&&D.tagName.Equals('TD','TH')) B[0]=D;else{D=TESelection.MoveToAncestorNode('TABLE');if (D){for (var i=0;i<D.cells.length;i++){var E=TE.EditorDocument.body.createTextRange();E.moveToElementText(D.cells[i]);if (C.inRange(E)||(C.compareEndPoints('StartToStart',E)>=0&&C.compareEndPoints('StartToEnd',E)<=0)||(C.compareEndPoints('EndToStart',E)>=0&&C.compareEndPoints('EndToEnd',E)<=0)){B[B.length]=D.cells[i];}}}};return B;};
var TEXml=function(){this.Error=false;};TEXml.GetAttribute=function(A,B,C){var D=A.attributes.getNamedItem(B);return D?D.value:C;};TEXml.TransformToObject=function(A){if (!A) return null;var B={};var C=A.attributes;for (var i=0;i<C.length;i++){var D=C[i];B[D.name]=D.value;};var E=A.childNodes;for (i=0;i<E.length;i++){var F=E[i];if (F.nodeType==1){var G='$'+F.nodeName;var H=B[G];if (!H) H=B[G]=[];H.push(this.TransformToObject(F));}};return B;}
TEXml.prototype={LoadUrl:function(A){this.Error=false;var B=TETools.CreateXmlObject('XmlHttp');if (!B){this.Error=true;return;};B.open("GET",A,false);B.send(null);if (B.status==200||B.status==304) this.DOMDocument=B.responseXML;else if (B.status==0&&B.readyState==4){this.DOMDocument=TETools.CreateXmlObject('DOMDocument');this.DOMDocument.async=false;this.DOMDocument.resolveExternals=false;this.DOMDocument.loadXML(B.responseText);}else{this.DOMDocument=null;};if (this.DOMDocument==null||this.DOMDocument.firstChild==null){this.Error=true;if (window.confirm('Error loading "'+A+'"\r\nDo you want to see more info?')) alert('URL requested: "'+A+'"\r\nServer response:\r\nStatus: '+B.status+'\r\nResponse text:\r\n'+B.responseText);}},SelectNodes:function(A,B){if (this.Error) return [];if (B) return B.selectNodes(A);else return this.DOMDocument.selectNodes(A);},SelectSingleNode:function(A,B){if (this.Error) return null;if (B) return B.selectSingleNode(A);else return this.DOMDocument.selectSingleNode(A);}};
var TENamedCommand=function(A){this.Name=A;};TENamedCommand.prototype.Execute=function(){TE.ExecuteNamedCommand(this.Name);};TENamedCommand.prototype.GetState=function(){return TE.GetNamedCommandState(this.Name);};
var TEStyleCommand=function(){};TEStyleCommand.prototype={Name:'Style',Execute:function(A,B){TEUndo.SaveUndoStep();if (B.Selected) TE.Styles.RemoveStyle(B.Style);else TE.Styles.ApplyStyle(B.Style);TEUndo.SaveUndoStep();TE.Focus();TE.Events.FireEvent('OnSelectionChange');},GetState:function(){if (!TE.EditorDocument) return -1;if (TESelection.GetType()=='Control'){var A=TESelection.GetSelectedElement();if (!A||!TEStyles.CheckHasObjectStyle(A.nodeName.toLowerCase())) return -1;};return 0;}};
var TEDialogCommand=function(A,B,C,D,E,F,G){this.Name=A;this.Title=B;this.Url=C;this.Width=D;this.Height=E;this.GetStateFunction=F;this.GetStateParam=G;this.Resizable=false;};TEDialogCommand.prototype.Execute=function(){TEDialog.OpenDialog('TEDialog_'+this.Name,this.Title,this.Url,this.Width,this.Height,null,null,this.Resizable);};TEDialogCommand.prototype.GetState=function(){if (this.GetStateFunction) return this.GetStateFunction(this.GetStateParam);else return 0;};var TEUndefinedCommand=function(){this.Name='Undefined';};TEUndefinedCommand.prototype.Execute=function(){alert(TELang.NotImplemented);};TEUndefinedCommand.prototype.GetState=function(){return 0;};var TEFormatBlockCommand=function(){};TEFormatBlockCommand.prototype={Name:'FormatBlock',Execute:TEStyleCommand.prototype.Execute,GetState:function(){return TE.EditorDocument?0:-1;}};var TEFontNameCommand=function(){};TEFontNameCommand.prototype={Name:'FontName',Execute:TEStyleCommand.prototype.Execute,GetState:TEFormatBlockCommand.prototype.GetState};var TEFontSizeCommand=function(){};TEFontSizeCommand.prototype={Name:'FontSize',Execute:TEStyleCommand.prototype.Execute,GetState:TEFormatBlockCommand.prototype.GetState};var TEPreviewCommand=function(){this.Name='Preview';};TEPreviewCommand.prototype.Execute=function(){TE.Preview();};TEPreviewCommand.prototype.GetState=function(){return 0;};var TESaveCommand=function(){this.Name='Save';};TESaveCommand.prototype.Execute=function(){var A=TE.GetParentForm();if (typeof(A.onsubmit)=='function'){var B=A.onsubmit();if (B!=null&&B===false) return;};if (typeof(A.submit)=='function') A.submit();else A.submit.click();};TESaveCommand.prototype.GetState=function(){return 0;};var TENewPageCommand=function(){this.Name='NewPage';};TENewPageCommand.prototype.Execute=function(){TEUndo.SaveUndoStep();TE.SetData('');TEUndo.Typing=true;TE.Focus();};TENewPageCommand.prototype.GetState=function(){return 0;};var TESourceCommand=function(){this.Name='Source';};TESourceCommand.prototype.Execute=function(){if (TEConfig.SourcePopup){var A=TEConfig.ScreenWidth*0.65;var B=TEConfig.ScreenHeight*0.65;TEDialog.OpenDialog('TEDialog_Source',TELang.Source,'dialog/te_source.html',A,B,null,null,true);}else TE.SwitchEditMode();};TESourceCommand.prototype.GetState=function(){return (TE.EditMode==0?0:1);};var TEUndoCommand=function(){this.Name='Undo';};TEUndoCommand.prototype.Execute=function(){TEUndo.Undo();};TEUndoCommand.prototype.GetState=function(){return (TEUndo.CheckUndoState()?0:-1);};var TERedoCommand=function(){this.Name='Redo';};TERedoCommand.prototype.Execute=function(){TEUndo.Redo();};TERedoCommand.prototype.GetState=function(){return (TEUndo.CheckRedoState()?0:-1);};var TEPageBreakCommand=function(){this.Name='PageBreak';};TEPageBreakCommand.prototype.Execute=function(){TEUndo.SaveUndoStep();var e=TE.EditorDocument.createElement('DIV');e.style.pageBreakAfter='always';e.innerHTML='<span style="DISPLAY:none">&nbsp;</span>';var A=TEDocumentProcessor_CreateFakeImage('TE__PageBreak',e);var B=new TEDomRange(TE.EditorWindow);B.MoveToSelection();var C=B.SplitBlock();if (C.NextBlock) C.NextBlock.parentNode.insertBefore(A,C.NextBlock);else C.PreviousBlock.parentNode.insertBefore(A,C.PreviousBlock.nextSibling);TE.Events.FireEvent('OnSelectionChange');};TEPageBreakCommand.prototype.GetState=function(){return 0;};var TEUnlinkCommand=function(){this.Name='Unlink';};TEUnlinkCommand.prototype.Execute=function(){TEUndo.SaveUndoStep();if (TEBrowserInfo.IsGeckoLike){var A=TE.Selection.MoveToAncestorNode('A');if (A) TETools.RemoveOuterTags(A);return;};TE.ExecuteNamedCommand(this.Name);};TEUnlinkCommand.prototype.GetState=function(){var A=TE.GetNamedCommandState(this.Name);if (A==0&&TE.EditMode==0){var B=TESelection.MoveToAncestorNode('A');var C=(B&&B.name.length>0&&B.href.length==0);if (C) A=-1;};return A;};var TESelectAllCommand=function(){this.Name='SelectAll';};TESelectAllCommand.prototype.Execute=function(){if (TE.EditMode==0){TE.ExecuteNamedCommand('SelectAll');}else{var A=TE.EditingArea.Textarea;if (TEBrowserInfo.IsIE){A.createTextRange().execCommand('SelectAll');}else{A.selectionStart=0;A.selectionEnd=A.value.length;};A.focus();}};TESelectAllCommand.prototype.GetState=function(){return 0;};var TEPasteCommand=function(){this.Name='Paste';};TEPasteCommand.prototype={Execute:function(){if (TEBrowserInfo.IsIE) TE.Paste();else TE.ExecuteNamedCommand('Paste');},GetState:function(){return TE.GetNamedCommandState('Paste');}};var TERuleCommand=function(){this.Name='Rule';};TERuleCommand.prototype={Execute:function(){TEUndo.SaveUndoStep();TE.InsertElement('hr');},GetState:function(){return TE.GetNamedCommandState('InsertHorizontalRule');}};var TECopyCommand=function(){this.Name='Copy';};TECopyCommand.prototype={Execute:function(){TE.ExecuteNamedCommand(this.Name);},GetState:function(){return TE.GetNamedCommandState('Cut');}};var TEAnchorDeleteCommand=function(){this.Name='AnchorDelete';};TEAnchorDeleteCommand.prototype={Execute:function(){if (TE.Selection.GetType()=='Control'){TE.Selection.Delete();}else{var A=TE.Selection.GetSelectedElement();if (A){if (A.tagName=='IMG'&&A.getAttribute('_teanchor')) oAnchor=TE.GetRealElement(A);else A=null;};if (!A){oAnchor=TE.Selection.MoveToAncestorNode('A');if (oAnchor) TE.Selection.SelectNode(oAnchor);};if (oAnchor.href.length!=0){oAnchor.removeAttribute('name');if (TEBrowserInfo.IsIE) oAnchor.className=oAnchor.className.replace(TERegexLib.TE_Class,'');return;};if (A){A.parentNode.removeChild(A);return;};if (oAnchor.innerHTML.length==0){oAnchor.parentNode.removeChild(oAnchor);return;};TETools.RemoveOuterTags(oAnchor);};if (TEBrowserInfo.IsGecko) TE.Selection.Collapse(true);},GetState:function(){return TE.GetNamedCommandState('Unlink');}};
var TEShowBlockCommand=function(A,B){this.Name=A;if (B!=undefined) this._SavedState=B;else this._SavedState=null;};TEShowBlockCommand.prototype.Execute=function(){var A=this.GetState();if (A==-1) return;var B=TE.EditorDocument.body;if (A==1) B.className=B.className.replace(/(^| )TE__ShowBlocks/g,'');else B.className+=' TE__ShowBlocks';TE.Events.FireEvent('OnSelectionChange');};TEShowBlockCommand.prototype.GetState=function(){if (TE.EditMode!=0) return -1;if (!TE.EditorDocument) return 0;if (/TE__ShowBlocks(?:\s|$)/.test(TE.EditorDocument.body.className)) return 1;return 0;};TEShowBlockCommand.prototype.SaveState=function(){this._SavedState=this.GetState();};TEShowBlockCommand.prototype.RestoreState=function(){if (this._SavedState!=null&&this.GetState()!=this._SavedState) this.Execute();};
var TESpellCheckCommand=function(){this.Name='SpellCheck';this.IsEnabled=(TEConfig.SpellChecker=='ieSpell'||TEConfig.SpellChecker=='SpellerPages');};TESpellCheckCommand.prototype.Execute=function(){switch (TEConfig.SpellChecker){case 'ieSpell':this._RunIeSpell();break;case 'SpellerPages':TEDialog.OpenDialog('TEDialog_SpellCheck','Spell Check','dialog/te_spellerpages.html',440,480);break;}};TESpellCheckCommand.prototype._RunIeSpell=function(){try{var A=new ActiveXObject("ieSpell.ieSpellExtension");A.CheckAllLinkedDocuments(TE.EditorDocument);}catch(e){if(e.number==-2146827859){if (confirm(TELang.IeSpellDownload)) window.open(TEConfig.IeSpellDownloadUrl,'IeSpellDownload');}else alert('Error Loading ieSpell: '+e.message+' ('+e.number+')');}};TESpellCheckCommand.prototype.GetState=function(){return this.IsEnabled?0:-1;}
var TETextColorCommand=function(A){this.Name=A=='ForeColor'?'TextColor':'BGColor';this.Type=A;var B;if (TEBrowserInfo.IsIE) B=window;else if (TE.ToolbarSet._IFrame) B=TETools.GetElementWindow(TE.ToolbarSet._IFrame);else B=window.parent;this._Panel=new TEPanel(B);this._Panel.AppendStyleSheet(TEConfig.SkinPath+'te_editor.css');this._Panel.MainNode.className='TE_Panel';this._CreatePanelBody(this._Panel.Document,this._Panel.MainNode);TETools.DisableSelection(this._Panel.Document.body);};TETextColorCommand.prototype.Execute=function(A,B,C){this._Panel.Show(A,B,C);};TETextColorCommand.prototype.SetColor=function(A){TEUndo.SaveUndoStep();var B=TEStyles.GetStyle('_TE_'+(this.Type=='ForeColor'?'Color':'BackColor'));if (!A||A.length==0) TE.Styles.RemoveStyle(B);else{B.SetVariable('Color',A);TEStyles.ApplyStyle(B);};TEUndo.SaveUndoStep();TE.Focus();TE.Events.FireEvent('OnSelectionChange');};TETextColorCommand.prototype.GetState=function(){return 0;};function TETextColorCommand_OnMouseOver(){this.className='ColorSelected';};function TETextColorCommand_OnMouseOut(){this.className='ColorDeselected';};function TETextColorCommand_OnClick(A,B,C){this.className='ColorDeselected';B.SetColor(C);B._Panel.Hide();};function TETextColorCommand_AutoOnClick(A,B){this.className='ColorDeselected';B.SetColor('');B._Panel.Hide();};function TETextColorCommand_MoreOnClick(A,B){this.className='ColorDeselected';B._Panel.Hide();TEDialog.OpenDialog('TEDialog_Color',TELang.DlgColorTitle,'dialog/te_colorselector.html',400,330,TETools.Hitch(B,'SetColor'));};TETextColorCommand.prototype._CreatePanelBody=function(A,B){function CreateSelectionDiv(){var C=A.createElement("DIV");C.className='ColorDeselected';TETools.AddEventListenerEx(C,'mouseover',TETextColorCommand_OnMouseOver);TETools.AddEventListenerEx(C,'mouseout',TETextColorCommand_OnMouseOut);return C;};var D=B.appendChild(A.createElement("TABLE"));D.className='ForceBaseFont';D.style.tableLayout='fixed';D.cellPadding=0;D.cellSpacing=0;D.border=0;D.width=150;var E=D.insertRow(-1).insertCell(-1);E.colSpan=8;var C=E.appendChild(CreateSelectionDiv());C.innerHTML='<table cellspacing="0" cellpadding="0" width="100%" border="0">\n			<tr>\n				<td><div class="ColorBoxBorder"><div class="ColorBox" style="background-color: #000000"></div></div></td>\n				<td nowrap width="100%" align="center">'+TELang.ColorAutomatic+'</td>\n			</tr>\n		</table>';TETools.AddEventListenerEx(C,'click',TETextColorCommand_AutoOnClick,this);if (!TEBrowserInfo.IsIE) C.style.width='96%';var G=TEConfig.FontColors.toString().split(',');var H=0;while (H<G.length){var I=D.insertRow(-1);for (var i=0;i<8;i++,H++){if (H<G.length){var J=G[H].split('/');var K='#'+J[0];var L=J[1]||K;};C=I.insertCell(-1).appendChild(CreateSelectionDiv());C.innerHTML='<div class="ColorBoxBorder"><div class="ColorBox" style="background-color: '+K+'"></div></div>';if (H>=G.length) C.style.visibility='hidden';else TETools.AddEventListenerEx(C,'click',TETextColorCommand_OnClick,[this,L]);}};if (TEConfig.EnableMoreFontColors){E=D.insertRow(-1).insertCell(-1);E.colSpan=8;C=E.appendChild(CreateSelectionDiv());C.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td nowrap align="center">'+TELang.ColorMoreColors+'</td></tr></table>';TETools.AddEventListenerEx(C,'click',TETextColorCommand_MoreOnClick,this);};if (!TEBrowserInfo.IsIE) C.style.width='96%';};
var TEPastePlainTextCommand=function(){this.Name='PasteText';};TEPastePlainTextCommand.prototype.Execute=function(){TE.PasteAsPlainText();};TEPastePlainTextCommand.prototype.GetState=function(){return TE.GetNamedCommandState('Paste');};
var TEPasteWordCommand=function(){this.Name='PasteWord';};TEPasteWordCommand.prototype.Execute=function(){TE.PasteFromWord();};TEPasteWordCommand.prototype.GetState=function(){if (TEConfig.ForcePasteAsPlainText) return -1;else return TE.GetNamedCommandState('Paste');};
var TETableCommand=function(A){this.Name=A;};TETableCommand.prototype.Execute=function(){TEUndo.SaveUndoStep();if (!TEBrowserInfo.IsGecko){switch (this.Name){case 'TableMergeRight':return TETableHandler.MergeRight();case 'TableMergeDown':return TETableHandler.MergeDown();}};switch (this.Name){case 'TableInsertRowAfter':return TETableHandler.InsertRow(false);case 'TableInsertRowBefore':return TETableHandler.InsertRow(true);case 'TableDeleteRows':return TETableHandler.DeleteRows();case 'TableInsertColumnAfter':return TETableHandler.InsertColumn(false);case 'TableInsertColumnBefore':return TETableHandler.InsertColumn(true);case 'TableDeleteColumns':return TETableHandler.DeleteColumns();case 'TableInsertCellAfter':return TETableHandler.InsertCell(null,false);case 'TableInsertCellBefore':return TETableHandler.InsertCell(null,true);case 'TableDeleteCells':return TETableHandler.DeleteCells();case 'TableMergeCells':return TETableHandler.MergeCells();case 'TableHorizontalSplitCell':return TETableHandler.HorizontalSplitCell();case 'TableVerticalSplitCell':return TETableHandler.VerticalSplitCell();case 'TableDelete':return TETableHandler.DeleteTable();default:return alert(TELang.UnknownCommand.replace(/%1/g,this.Name));}};TETableCommand.prototype.GetState=function(){if (TE.EditorDocument!=null&&TESelection.HasAncestorNode('TABLE')){switch (this.Name){case 'TableHorizontalSplitCell':case 'TableVerticalSplitCell':if (TETableHandler.GetSelectedCells().length==1) return 0;else return -1;case 'TableMergeCells':if (TETableHandler.CheckIsSelectionRectangular()&&TETableHandler.GetSelectedCells().length>1) return 0;else return -1;case 'TableMergeRight':return TETableHandler.GetMergeRightTarget()?0:-1;case 'TableMergeDown':return TETableHandler.GetMergeDownTarget()?0:-1;default:return 0;}}else return -1;};
var TEFitWindow=function(){this.Name='FitWindow';};TEFitWindow.prototype.Execute=function(){var A=window.frameElement;var B=A.style;var C=parent;var D=C.document.documentElement;var E=C.document.body;var F=E.style;var G;if (!this.IsMaximized){if(TEBrowserInfo.IsIE) C.attachEvent('onresize',TEFitWindow_Resize);else C.addEventListener('resize',TEFitWindow_Resize,true);this._ScrollPos=TETools.GetScrollPosition(C);G=A;while((G=G.parentNode)){if (G.nodeType==1){G._teSavedStyles=TETools.SaveStyles(G);G.style.zIndex=TEConfig.FloatingPanelsZIndex-1;}};if (TEBrowserInfo.IsIE){this.documentElementOverflow=D.style.overflow;D.style.overflow='hidden';F.overflow='hidden';}else{F.overflow='hidden';F.width='0px';F.height='0px';};this._EditorFrameStyles=TETools.SaveStyles(A);var H=TETools.GetViewPaneSize(C);B.position="absolute";B.zIndex=TEConfig.FloatingPanelsZIndex-1;B.left="0px";B.top="0px";B.width=H.Width+"px";B.height=H.Height+"px";if (!TEBrowserInfo.IsIE){B.borderRight=B.borderBottom="9999px solid white";B.backgroundColor="white";};C.scrollTo(0,0);var I=TETools.GetWindowPosition(C,A);if (I.x!=0) B.left=(-1*I.x)+"px";if (I.y!=0) B.top=(-1*I.y)+"px";this.IsMaximized=true;}else{if(TEBrowserInfo.IsIE) C.detachEvent("onresize",TEFitWindow_Resize);else C.removeEventListener("resize",TEFitWindow_Resize,true);G=A;while((G=G.parentNode)){if (G._teSavedStyles){TETools.RestoreStyles(G,G._teSavedStyles);G._teSavedStyles=null;}};if (TEBrowserInfo.IsIE) D.style.overflow=this.documentElementOverflow;TETools.RestoreStyles(A,this._EditorFrameStyles);C.scrollTo(this._ScrollPos.X,this._ScrollPos.Y);this.IsMaximized=false;};TEToolbarItems.GetItem('FitWindow').RefreshState();if (TE.EditMode==0) TE.EditingArea.MakeEditable();TE.Focus();};TEFitWindow.prototype.GetState=function(){if (TEConfig.ToolbarLocation!='In') return -1;else return (this.IsMaximized?1:0);};function TEFitWindow_Resize(){var A=TETools.GetViewPaneSize(parent);var B=window.frameElement.style;B.width=A.Width+'px';B.height=A.Height+'px';};
var TEListCommand=function(A,B){this.Name=A;this.TagName=B;};TEListCommand.prototype={GetState:function(){if (TE.EditMode!=0||!TE.EditorWindow) return -1;var A=TESelection.GetBoundaryParentElement(true);var B=A;while (B){if (B.nodeName.IEquals(['ul','ol'])) break;B=B.parentNode;};if (B&&B.nodeName.IEquals(this.TagName)) return 1;else return 0;},Execute:function(){TEUndo.SaveUndoStep();var A=TE.EditorDocument;var B=new TEDomRange(TE.EditorWindow);B.MoveToSelection();var C=this.GetState();if (C==0){TEDomTools.TrimNode(A.body);if (!A.body.firstChild){var D=A.createElement('p');A.body.appendChild(D);B.MoveToNodeContents(D);}};var E=B.CreateBookmark();var F=[];var G={};var H=new TEDomRangeIterator(B);var I;H.ForceBrBreak=(C==0);var J=true;var K=null;while (J){while ((I=H.GetNextParagraph())){var L=new TEElementPath(I);var M=null;var N=false;var O=L.BlockLimit;for (var i=L.Elements.length-1;i>=0;i--){var P=L.Elements[i];if (P.nodeName.IEquals(['ol','ul'])){if (O._TE_ListGroupObject) O._TE_ListGroupObject=null;var Q=P._TE_ListGroupObject;if (Q) Q.contents.push(I);else{Q={ 'root':P,'contents':[I] };F.push(Q);TEDomTools.SetElementMarker(G,P,'_TE_ListGroupObject',Q);};N=true;break;}};if (N) continue;var R=O;if (R._TE_ListGroupObject) R._TE_ListGroupObject.contents.push(I);else{var Q={ 'root':R,'contents':[I] };TEDomTools.SetElementMarker(G,R,'_TE_ListGroupObject',Q);F.push(Q);}};if (TEBrowserInfo.IsIE) J=false;else{if (K==null){K=[];var T=TE.EditorWindow.getSelection();if (T&&F.length==0) K.push(T.getRangeAt(0));for (var i=1;T&&i<T.rangeCount;i++) K.push(T.getRangeAt(i));};if (K.length<1) J=false;else{var U=TEW3CRange.CreateFromRange(A,K.shift());B._Range=U;B._UpdateElementInfo();if (B.StartNode.nodeName.IEquals('td')) B.SetStart(B.StartNode,1);if (B.EndNode.nodeName.IEquals('td')) B.SetEnd(B.EndNode,2);H=new TEDomRangeIterator(B);H.ForceBrBreak=(C==0);}}};var W=[];while (F.length>0){var Q=F.shift();if (C==0){if (Q.root.nodeName.IEquals(['ul','ol'])) this._ChangeListType(Q,G,W);else this._CreateList(Q,W);}else if (C==1&&Q.root.nodeName.IEquals(['ul','ol'])) this._RemoveList(Q,G);};for (var i=0;i<W.length;i++){var M=W[i];var Z=false;var a=M;while (!Z){a=a.nextSibling;if (a&&a.nodeType==3&&a.nodeValue.search(/^[\n\r\t ]*$/)==0) continue;Z=true;};if (a&&a.nodeName.IEquals(this.TagName)){a.parentNode.removeChild(a);while (a.firstChild) M.appendChild(a.removeChild(a.firstChild));};Z=false;a=M;while (!Z){a=a.previousSibling;if (a&&a.nodeType==3&&a.nodeValue.search(/^[\n\r\t ]*$/)==0) continue;Z=true;};if (a&&a.nodeName.IEquals(this.TagName)){a.parentNode.removeChild(a);while (a.lastChild) M.insertBefore(a.removeChild(a.lastChild),M.firstChild);}};TEDomTools.ClearAllMarkers(G);B.MoveToBookmark(E);B.Select();TE.Focus();TE.Events.FireEvent('OnSelectionChange');},_ChangeListType:function(A,B,C){var D=TEDomTools.ListToArray(A.root,B);var E=[];for (var i=0;i<A.contents.length;i++){var F=A.contents[i];F=TETools.GetElementAscensor(F,'li');if (!F||F._TE_ListItem_Processed) continue;E.push(F);TEDomTools.SetElementMarker(B,F,'_TE_ListItem_Processed',true);};var G=A.root.ownerDocument.createElement(this.TagName);for (var i=0;i<E.length;i++){var H=E[i]._TE_ListArray_Index;D[H].parent=G;};var I=TEDomTools.ArrayToList(D,B);for (var i=0;i<I.listNode.childNodes.length;i++){if (I.listNode.childNodes[i].nodeName.IEquals(this.TagName)) C.push(I.listNode.childNodes[i]);};A.root.parentNode.replaceChild(I.listNode,A.root);},_CreateList:function(A,B){var C=A.contents;var D=A.root.ownerDocument;var E=[];if (C.length==1&&C[0]==A.root){var F=D.createElement('div');while (C[0].firstChild) F.appendChild(C[0].removeChild(C[0].firstChild));C[0].appendChild(F);C[0]=F;};var G=A.contents[0].parentNode;for (var i=0;i<C.length;i++) G=TEDomTools.GetCommonParents(G,C[i].parentNode).pop();for (var i=0;i<C.length;i++){var H=C[i];while (H.parentNode){if (H.parentNode==G){E.push(H);break;};H=H.parentNode;}};if (E.length<1) return;var I=E[E.length-1].nextSibling;var J=D.createElement(this.TagName);B.push(J);while (E.length){var K=E.shift();var L=D.createDocumentFragment();while (K.firstChild) L.appendChild(K.removeChild(K.firstChild));K.parentNode.removeChild(K);var M=D.createElement('li');M.appendChild(L);J.appendChild(M);};G.insertBefore(J,I);},_RemoveList:function(A,B){var C=TEDomTools.ListToArray(A.root,B);var D=[];for (var i=0;i<A.contents.length;i++){var E=A.contents[i];E=TETools.GetElementAscensor(E,'li');if (!E||E._TE_ListItem_Processed) continue;D.push(E);TEDomTools.SetElementMarker(B,E,'_TE_ListItem_Processed',true);};var F=null;for (var i=0;i<D.length;i++){var G=D[i]._TE_ListArray_Index;C[G].indent=-1;F=G;};for (var i=F+1;i<C.length;i++){if (C[i].indent>C[i-1].indent+1){var H=C[i-1].indent+1-C[i].indent;var I=C[i].indent;while (C[i]&&C[i].indent>=I){C[i].indent+=H;i++;};i--;}};var J=TEDomTools.ArrayToList(C,B);if (A.root.nextSibling==null||A.root.nextSibling.nodeName.IEquals('br')){if (J.listNode.lastChild.nodeName.IEquals('br')) J.listNode.removeChild(J.listNode.lastChild);};A.root.parentNode.replaceChild(J.listNode,A.root);}};
var TEJustifyCommand=function(A){this.AlignValue=A;var B=TEConfig.ContentLangDirection.toLowerCase();this.IsDefaultAlign=(A=='left'&&B=='ltr')||(A=='right'&&B=='rtl');var C=this._CssClassName=(function(){var D=TEConfig.JustifyClasses;if (D){switch (A){case 'left':return D[0];case 'center':return D[1];case 'right':return D[2];case 'justify':return D[3];}};return null;})();if (C&&C.length>0) this._CssClassRegex=new RegExp('(?:^|\\s+)'+C+'(?=$|\\s)');};TEJustifyCommand._GetClassNameRegex=function(){var A=TEJustifyCommand._ClassRegex;if (A!=undefined) return A;var B=[];var C=TEConfig.JustifyClasses;if (C){for (var i=0;i<4;i++){var D=C[i];if (D&&D.length>0) B.push(D);}};if (B.length>0) A=new RegExp('(?:^|\\s+)(?:'+B.join('|')+')(?=$|\\s)');else A=null;return TEJustifyCommand._ClassRegex=A;};TEJustifyCommand.prototype={Execute:function(){TEUndo.SaveUndoStep();var A=new TEDomRange(TE.EditorWindow);A.MoveToSelection();var B=this.GetState();if (B==-1) return;var C=A.CreateBookmark();var D=this._CssClassName;var E=new TEDomRangeIterator(A);var F;while ((F=E.GetNextParagraph())){F.removeAttribute('align');if (D){var G=F.className.replace(TEJustifyCommand._GetClassNameRegex(),'');if (B==0){if (G.length>0) G+=' ';F.className=G+D;}else if (G.length==0) TEDomTools.RemoveAttribute(F,'class');}else{var H=F.style;if (B==0) H.textAlign=this.AlignValue;else{H.textAlign='';if (H.cssText.length==0) F.removeAttribute('style');}}};A.MoveToBookmark(C);A.Select();TE.Focus();TE.Events.FireEvent('OnSelectionChange');},GetState:function(){if (TE.EditMode!=0||!TE.EditorWindow) return -1;var A=new TEElementPath(TESelection.GetBoundaryParentElement(true));var B=A.Block||A.BlockLimit;if (!B||B.nodeName.toLowerCase()=='body') return 0;var C;if (TEBrowserInfo.IsIE) C=B.currentStyle.textAlign;else C=TE.EditorWindow.getComputedStyle(B,'').getPropertyValue('text-align');C=C.replace(/(-moz-|-webkit-|start|auto)/i,'');if ((!C&&this.IsDefaultAlign)||C==this.AlignValue) return 1;return 0;}};
var TEIndentCommand=function(A,B){this.Name=A;this.Offset=B;this.IndentCSSProperty=TEConfig.ContentLangDirection.IEquals('ltr')?'marginLeft':'marginRight';};TEIndentCommand._InitIndentModeParameters=function(){if (TEConfig.IndentClasses&&TEConfig.IndentClasses.length>0){this._UseIndentClasses=true;this._IndentClassMap={};for (var i=0;i<TEConfig.IndentClasses.length;i++) this._IndentClassMap[TEConfig.IndentClasses[i]]=i+1;this._ClassNameRegex=new RegExp('(?:^|\\s+)('+TEConfig.IndentClasses.join('|')+')(?=$|\\s)');}else this._UseIndentClasses=false;};TEIndentCommand.prototype={Execute:function(){TEUndo.SaveUndoStep();var A=new TEDomRange(TE.EditorWindow);A.MoveToSelection();var B=A.CreateBookmark();var C=TEDomTools.GetCommonParentNode(A.StartNode||A.StartContainer,A.EndNode||A.EndContainer,['ul','ol']);if (C) this._IndentList(A,C);else this._IndentBlock(A);A.MoveToBookmark(B);A.Select();TE.Focus();TE.Events.FireEvent('OnSelectionChange');},GetState:function(){if (TE.EditMode!=0||!TE.EditorWindow) return -1;if (TEIndentCommand._UseIndentClasses==undefined) TEIndentCommand._InitIndentModeParameters();var A=TESelection.GetBoundaryParentElement(true);var B=TESelection.GetBoundaryParentElement(false);var C=TEDomTools.GetCommonParentNode(A,B,['ul','ol']);if (C){if (this.Name.IEquals('outdent')) return 0;var D=TETools.GetElementAscensor(A,'li');if (!D||!D.previousSibling) return -1;return 0;};if (!TEIndentCommand._UseIndentClasses&&this.Name.IEquals('indent')) return 0;var E=new TEElementPath(A);var F=E.Block||E.BlockLimit;if (!F) return -1;if (TEIndentCommand._UseIndentClasses){var G=F.className.match(TEIndentCommand._ClassNameRegex);var H=0;if (G!=null){G=G[1];H=TEIndentCommand._IndentClassMap[G];};if ((this.Name=='outdent'&&H==0)||(this.Name=='indent'&&H==TEConfig.IndentClasses.length)) return -1;return 0;}else{var I=parseInt(F.style[this.IndentCSSProperty],10);if (isNaN(I)) I=0;if (I<=0) return -1;return 0;}},_IndentBlock:function(A){var B=new TEDomRangeIterator(A);A.Expand('block_contents');var C=TEDomTools.GetCommonParents(A.StartContainer,A.EndContainer);var D=C[C.length-1];var E;while ((E=B.GetNextParagraph())){if (!(E==D||E.parentNode==D)) continue;if (TEIndentCommand._UseIndentClasses){var F=E.className.match(TEIndentCommand._ClassNameRegex);var G=0;if (F!=null){F=F[1];G=TEIndentCommand._IndentClassMap[F];};if (this.Name.IEquals('outdent')) G--;else if (this.Name.IEquals('indent')) G++;G=Math.min(G,TEConfig.IndentClasses.length);G=Math.max(G,0);var H=E.className.replace(TEIndentCommand._ClassNameRegex,'');if (G<1) E.className=H;else E.className=(H.length>0?H+' ':'')+TEConfig.IndentClasses[G-1];}else{var I=parseInt(E.style[this.IndentCSSProperty],10);if (isNaN(I)) I=0;I+=this.Offset;I=Math.max(I,0);I=Math.ceil(I/this.Offset)*this.Offset;E.style[this.IndentCSSProperty]=I?I+TEConfig.IndentUnit:'';if (E.getAttribute('style')=='') E.removeAttribute('style');}}},_IndentList:function(A,B){var C=A.StartContainer;var D=A.EndContainer;while (C&&C.parentNode!=B) C=C.parentNode;while (D&&D.parentNode!=B) D=D.parentNode;if (!C||!D) return;var E=C;var F=[];var G=false;while (G==false){if (E==D) G=true;F.push(E);E=E.nextSibling;};if (F.length<1) return;var H=TEDomTools.GetParents(B);for (var i=0;i<H.length;i++){if (H[i].nodeName.IEquals(['ul','ol'])){B=H[i];break;}};var I=this.Name.IEquals('indent')?1:-1;var J=F[0];var K=F[F.length-1];var L={};var M=TEDomTools.ListToArray(B,L);var N=M[K._TE_ListArray_Index].indent;for (var i=J._TE_ListArray_Index;i<=K._TE_ListArray_Index;i++) M[i].indent+=I;for (var i=K._TE_ListArray_Index+1;i<M.length&&M[i].indent>N;i++) M[i].indent+=I;var O=TEDomTools.ArrayToList(M);if (O) B.parentNode.replaceChild(O.listNode,B);TEDomTools.ClearAllMarkers(L);}};
var TEBlockQuoteCommand=function(){};TEBlockQuoteCommand.prototype={Execute:function(){TEUndo.SaveUndoStep();var A=this.GetState();var B=new TEDomRange(TE.EditorWindow);B.MoveToSelection();var C=B.CreateBookmark();if (TEBrowserInfo.IsIE){var D=B.GetBookmarkNode(C,true);var E=B.GetBookmarkNode(C,false);var F;if (D&&D.parentNode.nodeName.IEquals('blockquote')&&!D.previousSibling){F=D;while ((F=F.nextSibling)){if (TEListsLib.BlockElements[F.nodeName.toLowerCase()]) TEDomTools.MoveNode(D,F,true);}};if (E&&E.parentNode.nodeName.IEquals('blockquote')&&!E.previousSibling){F=E;while ((F=F.nextSibling)){if (TEListsLib.BlockElements[F.nodeName.toLowerCase()]){if (F.firstChild==D) TEDomTools.InsertAfterNode(D,E);else TEDomTools.MoveNode(E,F,true);}}}};var G=new TEDomRangeIterator(B);var H;if (A==0){G.EnforceRealBlocks=true;var I=[];while ((H=G.GetNextParagraph())) I.push(H);if (I.length<1){para=B.Window.document.createElement(TEConfig.EnterMode.IEquals('p')?'p':'div');B.InsertNode(para);para.appendChild(B.Window.document.createTextNode('\ufeff'));B.MoveToBookmark(C);B.MoveToNodeContents(para);B.Collapse(true);C=B.CreateBookmark();I.push(para);};var J=I[0].parentNode;var K=[];for (var i=0;i<I.length;i++){H=I[i];J=TEDomTools.GetCommonParents(H.parentNode,J).pop();};var L=null;while (I.length>0){H=I.shift();while (H.parentNode!=J) H=H.parentNode;if (H!=L) K.push(H);L=H;};while (K.length>0){H=K.shift();if (H.nodeName.IEquals('blockquote')){var M=H.ownerDocument.createDocumentFragment();while (H.firstChild){M.appendChild(H.removeChild(H.firstChild));I.push(M.lastChild);};H.parentNode.replaceChild(M,H);}else I.push(H);};var N=B.Window.document.createElement('blockquote');J.insertBefore(N,I[0]);while (I.length>0){H=I.shift();N.appendChild(H);}}else if (A==1){var O=[];while ((H=G.GetNextParagraph())){var P=null;var Q=null;while (H.parentNode){if (H.parentNode.nodeName.IEquals('blockquote')){P=H.parentNode;Q=H;break;};H=H.parentNode;};if (P&&Q) O.push(Q);};var R=[];while (O.length>0){var S=O.shift();var N=S.parentNode;if (S==S.parentNode.firstChild){N.parentNode.insertBefore(N.removeChild(S),N);if (!N.firstChild) N.parentNode.removeChild(N);}else if (S==S.parentNode.lastChild){N.parentNode.insertBefore(N.removeChild(S),N.nextSibling);if (!N.firstChild) N.parentNode.removeChild(N);}else TEDomTools.BreakParent(S,S.parentNode,B);R.push(S);};if (TEConfig.EnterMode.IEquals('br')){while (R.length){var S=R.shift();var W=true;if (S.nodeName.IEquals('div')){var M=S.ownerDocument.createDocumentFragment();var Y=W&&S.previousSibling&&!TEListsLib.BlockBoundaries[S.previousSibling.nodeName.toLowerCase()];if (W&&Y) M.appendChild(S.ownerDocument.createElement('br'));var Z=S.nextSibling&&!TEListsLib.BlockBoundaries[S.nextSibling.nodeName.toLowerCase()];while (S.firstChild) M.appendChild(S.removeChild(S.firstChild));if (Z) M.appendChild(S.ownerDocument.createElement('br'));S.parentNode.replaceChild(M,S);W=false;}}}};B.MoveToBookmark(C);B.Select();TE.Focus();TE.Events.FireEvent('OnSelectionChange');},GetState:function(){if (TE.EditMode!=0||!TE.EditorWindow) return -1;var A=new TEElementPath(TESelection.GetBoundaryParentElement(true));var B=A.Block||A.BlockLimit;if (!B||B.nodeName.toLowerCase()=='body') return 0;for (var i=0;i<A.Elements.length;i++){if (A.Elements[i].nodeName.IEquals('blockquote')) return 1;};return 0;}};
var TECoreStyleCommand=function(A){this.Name='CoreStyle';this.StyleName='_TE_'+A;this.IsActive=false;TEStyles.AttachStyleStateChange(this.StyleName,this._OnStyleStateChange,this);};TECoreStyleCommand.prototype={Execute:function(){TEUndo.SaveUndoStep();if (this.IsActive) TEStyles.RemoveStyle(this.StyleName);else TEStyles.ApplyStyle(this.StyleName);TE.Focus();TE.Events.FireEvent('OnSelectionChange');},GetState:function(){return this.IsActive?1:0;},_OnStyleStateChange:function(A,B){this.IsActive=B;}};
var TERemoveFormatCommand=function(){this.Name='RemoveFormat';};TERemoveFormatCommand.prototype={Execute:function(){TEStyles.RemoveAll();TE.Focus();TE.Events.FireEvent('OnSelectionChange');},GetState:function(){return TE.EditorWindow?0:-1;}};
var TECommands=TE.Commands={};TECommands.LoadedCommands={};TECommands.RegisterCommand=function(A,B){this.LoadedCommands[A]=B;};TECommands.GetCommand=function(A){var B=TECommands.LoadedCommands[A];if (B) return B;switch (A){case 'Bold':case 'Italic':case 'Underline':case 'StrikeThrough':case 'Subscript':case 'Superscript':B=new TECoreStyleCommand(A);break;case 'RemoveFormat':B=new TERemoveFormatCommand();break;case 'DocProps':B=new TEDialogCommand('DocProps',TELang.DocProps,'dialog/te_docprops.html',400,390,TECommands.GetFullPageState);break;case 'Templates':B=new TEDialogCommand('Templates',TELang.DlgTemplatesTitle,'dialog/te_template.html',380,450);break;case 'Link':B=new TEDialogCommand('Link',TELang.DlgLnkWindowTitle,'dialog/te_link.html',400,330);break;case 'Unlink':B=new TEUnlinkCommand();break;case 'Anchor':B=new TEDialogCommand('Anchor',TELang.DlgAnchorTitle,'dialog/te_anchor.html',370,170);break;case 'AnchorDelete':B=new TEAnchorDeleteCommand();break;case 'BulletedList':B=new TEDialogCommand('BulletedList',TELang.BulletedListProp,'dialog/te_listprop.html?UL',370,170);break;case 'NumberedList':B=new TEDialogCommand('NumberedList',TELang.NumberedListProp,'dialog/te_listprop.html?OL',370,170);break;case 'About':B=new TEDialogCommand('About',TELang.About,'dialog/te_about.html',400,330);break;case 'Find':B=new TEDialogCommand('Find',TELang.DlgFindAndReplaceTitle,'dialog/te_replace.html',340,250);break;case 'Replace':B=new TEDialogCommand('Replace',TELang.DlgFindAndReplaceTitle,'dialog/te_replace.html',340,250);break;case 'Image':B=new TEDialogCommand('Image',TELang.DlgImgTitle,'dialog/te_image.html',450,400);break;case 'Flash':B=new TEDialogCommand('Flash',TELang.DlgFlashTitle,'dialog/te_flash.html',450,400);break;case 'SpecialChar':B=new TEDialogCommand('SpecialChar',TELang.DlgSpecialCharTitle,'dialog/te_specialchar.html',400,320);break;case 'Smiley':B=new TEDialogCommand('Smiley',TELang.DlgSmileyTitle,'dialog/te_smiley.html',TEConfig.SmileyWindowWidth,TEConfig.SmileyWindowHeight);break;case 'Table':B=new TEDialogCommand('Table',TELang.DlgTableTitle,'dialog/te_table.html',480,250);break;case 'TableProp':B=new TEDialogCommand('Table',TELang.DlgTableTitle,'dialog/te_table.html?Parent',480,250);break;case 'TableCellProp':B=new TEDialogCommand('TableCell',TELang.DlgCellTitle,'dialog/te_tablecell.html',550,250);break;case 'Style':B=new TEStyleCommand();break;case 'FontName':B=new TEFontNameCommand();break;case 'FontSize':B=new TEFontSizeCommand();break;case 'FontFormat':B=new TEFormatBlockCommand();break;case 'Source':B=new TESourceCommand();break;case 'Preview':B=new TEPreviewCommand();break;case 'Save':B=new TESaveCommand();break;case 'NewPage':B=new TENewPageCommand();break;case 'PageBreak':B=new TEPageBreakCommand();break;case 'Rule':B=new TERuleCommand();break;case 'TextColor':B=new TETextColorCommand('ForeColor');break;case 'BGColor':B=new TETextColorCommand('BackColor');break;case 'Paste':B=new TEPasteCommand();break;case 'PasteText':B=new TEPastePlainTextCommand();break;case 'PasteWord':B=new TEPasteWordCommand();break;case 'JustifyLeft':B=new TEJustifyCommand('left');break;case 'JustifyCenter':B=new TEJustifyCommand('center');break;case 'JustifyRight':B=new TEJustifyCommand('right');break;case 'JustifyFull':B=new TEJustifyCommand('justify');break;case 'Indent':B=new TEIndentCommand('indent',TEConfig.IndentLength);break;case 'Outdent':B=new TEIndentCommand('outdent',TEConfig.IndentLength*-1);break;case 'Blockquote':B=new TEBlockQuoteCommand();break;case 'TableInsertRowAfter':B=new TETableCommand('TableInsertRowAfter');break;case 'TableInsertRowBefore':B=new TETableCommand('TableInsertRowBefore');break;case 'TableDeleteRows':B=new TETableCommand('TableDeleteRows');break;case 'TableInsertColumnAfter':B=new TETableCommand('TableInsertColumnAfter');break;case 'TableInsertColumnBefore':B=new TETableCommand('TableInsertColumnBefore');break;case 'TableDeleteColumns':B=new TETableCommand('TableDeleteColumns');break;case 'TableInsertCellAfter':B=new TETableCommand('TableInsertCellAfter');break;case 'TableInsertCellBefore':B=new TETableCommand('TableInsertCellBefore');break;case 'TableDeleteCells':B=new TETableCommand('TableDeleteCells');break;case 'TableMergeCells':B=new TETableCommand('TableMergeCells');break;case 'TableMergeRight':B=new TETableCommand('TableMergeRight');break;case 'TableMergeDown':B=new TETableCommand('TableMergeDown');break;case 'TableHorizontalSplitCell':B=new TETableCommand('TableHorizontalSplitCell');break;case 'TableVerticalSplitCell':B=new TETableCommand('TableVerticalSplitCell');break;case 'TableDelete':B=new TETableCommand('TableDelete');break;case 'Form':B=new TEDialogCommand('Form',TELang.Form,'dialog/te_form.html',380,230);break;case 'Checkbox':B=new TEDialogCommand('Checkbox',TELang.Checkbox,'dialog/te_checkbox.html',380,230);break;case 'Radio':B=new TEDialogCommand('Radio',TELang.RadioButton,'dialog/te_radiobutton.html',380,230);break;case 'TextField':B=new TEDialogCommand('TextField',TELang.TextField,'dialog/te_textfield.html',380,230);break;case 'Textarea':B=new TEDialogCommand('Textarea',TELang.Textarea,'dialog/te_textarea.html',380,230);break;case 'HiddenField':B=new TEDialogCommand('HiddenField',TELang.HiddenField,'dialog/te_hiddenfield.html',380,230);break;case 'Button':B=new TEDialogCommand('Button',TELang.Button,'dialog/te_button.html',380,230);break;case 'Select':B=new TEDialogCommand('Select',TELang.SelectionField,'dialog/te_select.html',400,380);break;case 'ImageButton':B=new TEDialogCommand('ImageButton',TELang.ImageButton,'dialog/te_image.html?ImageButton',450,400);break;case 'SpellCheck':B=new TESpellCheckCommand();break;case 'FitWindow':B=new TEFitWindow();break;case 'Undo':B=new TEUndoCommand();break;case 'Redo':B=new TERedoCommand();break;case 'Copy':B=new TECopyCommand();break;case 'SelectAll':B=new TESelectAllCommand();break;case 'InsertOrderedList':B=new TEListCommand('insertorderedlist','ol');break;case 'InsertUnorderedList':B=new TEListCommand('insertunorderedlist','ul');break;case 'ShowBlocks':B=new TEShowBlockCommand('ShowBlocks',TEConfig.StartupShowBlocks?1:0);break;case 'Undefined':B=new TEUndefinedCommand();break;default:if (TERegexLib.NamedCommands.test(A)) B=new TENamedCommand(A);else{alert(TELang.UnknownCommand.replace(/%1/g,A));return null;}};TECommands.LoadedCommands[A]=B;return B;};TECommands.GetFullPageState=function(){return TEConfig.FullPage?0:-1;};TECommands.GetBooleanState=function(A){return A?-1:0;};
var TEPanel=function(A){this.IsRTL=(TELang.Dir=='rtl');this.IsContextMenu=false;this._LockCounter=0;this._Window=A||window;var B;if (TEBrowserInfo.IsIE){this._Popup=this._Window.createPopup();B=this.Document=this._Popup.document;TE.IECleanup.AddItem(this,TEPanel_Cleanup);}else{var C=this._IFrame=this._Window.document.createElement('iframe');C.src='javascript:void(0)';C.allowTransparency=true;C.frameBorder='0';C.scrolling='no';C.width=C.height=0;TEDomTools.SetElementStyles(C,{position:'absolute',zIndex:TEConfig.FloatingPanelsZIndex});if (this._Window==window.parent&&window.frameElement){var D=null;if (TEBrowserInfo.IsGecko&&TE&&TE.EditorDocument) D=[TE.EditorDocument.body.scrollLeft,TE.EditorDocument.body.scrollTop];window.frameElement.parentNode.insertBefore(C,window.frameElement);if (D){var E=function(){TE.EditorDocument.body.scrollLeft=D[0];TE.EditorDocument.body.scrollTop=D[1];};setTimeout(E,500);}}else this._Window.document.body.appendChild(C);var F=C.contentWindow;B=this.Document=F.document;var G='';if (TEBrowserInfo.IsSafari) G='<base href="'+window.document.location+'">';B.open();B.write('<html><head>'+G+'<\/head><body style="margin:0px;padding:0px;"><\/body><\/html>');B.close();TETools.AddEventListenerEx(F,'focus',TEPanel_Window_OnFocus,this);TETools.AddEventListenerEx(F,'blur',TEPanel_Window_OnBlur,this);};B.dir=TELang.Dir;TETools.AddEventListener(B,'contextmenu',TETools.CancelEvent);this.MainNode=B.body.appendChild(B.createElement('DIV'));this.MainNode.style.cssFloat=this.IsRTL?'right':'left';};TEPanel.prototype.AppendStyleSheet=function(A){TETools.AppendStyleSheet(this.Document,A);};TEPanel.prototype.Preload=function(x,y,A){if (this._Popup) this._Popup.show(x,y,0,0,A);};TEPanel.prototype.Show=function(x,y,A,B,C){var D;var E=this.MainNode;if (this._Popup){this._Popup.show(x,y,0,0,A);TEDomTools.SetElementStyles(E,{B:B?B+'px':'',C:C?C+'px':''});D=E.offsetWidth;if (this.IsRTL){if (this.IsContextMenu) x=x-D+1;else if (A) x=(x*-1)+A.offsetWidth-D;};this._Popup.show(x,y,D,E.offsetHeight,A);if (this.OnHide){if (this._Timer) CheckPopupOnHide.call(this,true);this._Timer=TETools.SetInterval(CheckPopupOnHide,100,this);}}else{if (typeof(TE.ToolbarSet.CurrentInstance.FocusManager)!='undefined') TE.ToolbarSet.CurrentInstance.FocusManager.Lock();if (this.ParentPanel){this.ParentPanel.Lock();TEPanel_Window_OnBlur(null,this.ParentPanel);};if (TEPanel._OpenedPanel) TEPanel._OpenedPanel.Hide();TEDomTools.SetElementStyles(E,{B:B?B+'px':'',C:C?C+'px':''});D=E.offsetWidth;if (!B)	this._IFrame.width=1;if (!C)	this._IFrame.height=1;D=E.offsetWidth||E.firstChild.offsetWidth;var F=TETools.GetDocumentPosition(this._Window,A.nodeType==9?(TETools.IsStrictMode(A)?A.documentElement:A.body):A);var G=TEDomTools.GetPositionedAncestor(TETools.GetElementWindow(this._IFrame),this._IFrame.parentNode);if (G){var H=TETools.GetDocumentPosition(TETools.GetElementWindow(G),G);F.x-=H.x;F.y-=H.y;};if (this.IsRTL&&!this.IsContextMenu) x=(x*-1);x+=F.x;y+=F.y;if (this.IsRTL){if (this.IsContextMenu) x=x-D+1;else if (A) x=x+A.offsetWidth-D;}else{var I=TETools.GetViewPaneSize(this._Window);var J=TETools.GetScrollPosition(this._Window);var K=I.Height+J.Y;var L=I.Width+J.X;if ((x+D)>L) x-=x+D-L;if ((y+E.offsetHeight)>K) y-=y+E.offsetHeight-K;};if (x<0) x=0;TEDomTools.SetElementStyles(this._IFrame,{left:x+'px',top:y+'px'});var M=D;var N=E.offsetHeight;this._IFrame.width=M;this._IFrame.height=N;this._IFrame.contentWindow.focus();TEPanel._OpenedPanel=this;};this._IsOpened=true;TETools.RunFunction(this.OnShow,this);};TEPanel.prototype.Hide=function(A){if (this._Popup) this._Popup.hide();else{if (!this._IsOpened||this._LockCounter>0) return;if (typeof(TEFocusManager)!='undefined') TEFocusManager.Unlock();this._IFrame.width=this._IFrame.height=0;this._IsOpened=false;if (this.ParentPanel) this.ParentPanel.Unlock();if (!A) TETools.RunFunction(this.OnHide,this);}};TEPanel.prototype.CheckIsOpened=function(){if (this._Popup) return this._Popup.isOpen;else return this._IsOpened;};TEPanel.prototype.CreateChildPanel=function(){var A=this._Popup?TETools.GetDocumentWindow(this.Document):this._Window;var B=new TEPanel(A);B.ParentPanel=this;return B;};TEPanel.prototype.Lock=function(){this._LockCounter++;};TEPanel.prototype.Unlock=function(){if (--this._LockCounter==0&&!this.HasFocus) this.Hide();};function TEPanel_Window_OnFocus(e,A){A.HasFocus=true;};function TEPanel_Window_OnBlur(e,A){A.HasFocus=false;if (A._LockCounter==0) TETools.RunFunction(A.Hide,A);};function CheckPopupOnHide(A){if (A||!this._Popup.isOpen){window.clearInterval(this._Timer);this._Timer=null;TETools.RunFunction(this.OnHide,this);}};function TEPanel_Cleanup(){this._Popup=null;this._Window=null;this.Document=null;this.MainNode=null;};
var TEIcon=function(A){var B=A?typeof(A):'undefined';switch (B){case 'number':this.Path=TEConfig.SkinPath+'te_strip.gif';this.Size=16;this.Position=A;break;case 'undefined':this.Path=TE_SPACER_PATH;break;case 'string':this.Path=A;break;default:this.Path=A[0];this.Size=A[1];this.Position=A[2];}};TEIcon.prototype.CreateIconElement=function(A){var B,eIconImage;if (this.Position){var C='-'+((this.Position-1)*this.Size)+'px';if (TEBrowserInfo.IsIE){B=A.createElement('DIV');eIconImage=B.appendChild(A.createElement('IMG'));eIconImage.src=this.Path;eIconImage.style.top=C;}else{B=A.createElement('IMG');B.src=TE_SPACER_PATH;B.style.backgroundPosition='0px '+C;B.style.backgroundImage='url("'+this.Path+'")';}}else{if (TEBrowserInfo.IsIE){B=A.createElement('DIV');eIconImage=B.appendChild(A.createElement('IMG'));eIconImage.src=this.Path?this.Path:TE_SPACER_PATH;}else{B=A.createElement('IMG');B.src=this.Path?this.Path:TE_SPACER_PATH;}};B.className='TB_Button_Image';return B;}
var TEToolbarButtonUI=function(A,B,C,D,E,F){this.Name=A;this.Label=B||A;this.Tooltip=C||this.Label;this.Style=E||0;this.State=F||0;this.Icon=new TEIcon(D);if (TE.IECleanup) TE.IECleanup.AddItem(this,TEToolbarButtonUI_Cleanup);};TEToolbarButtonUI.prototype._CreatePaddingElement=function(A){var B=A.createElement('IMG');B.className='TB_Button_Padding';B.src=TE_SPACER_PATH;return B;};TEToolbarButtonUI.prototype.Create=function(A){var B=TETools.GetElementDocument(A);var C=this.MainElement=B.createElement('DIV');C.title=this.Tooltip;if (TEBrowserInfo.IsGecko) C.onmousedown=TETools.CancelEvent;TETools.AddEventListenerEx(C,'mouseover',TEToolbarButtonUI_OnMouseOver,this);TETools.AddEventListenerEx(C,'mouseout',TEToolbarButtonUI_OnMouseOut,this);TETools.AddEventListenerEx(C,'click',TEToolbarButtonUI_OnClick,this);this.ChangeState(this.State,true);if (this.Style==0&&!this.ShowArrow){C.appendChild(this.Icon.CreateIconElement(B));}else{var D=C.appendChild(B.createElement('TABLE'));D.cellPadding=0;D.cellSpacing=0;var E=D.insertRow(-1);var F=E.insertCell(-1);if (this.Style==0||this.Style==2) F.appendChild(this.Icon.CreateIconElement(B));else F.appendChild(this._CreatePaddingElement(B));if (this.Style==1||this.Style==2){F=E.insertCell(-1);F.className='TB_Button_Text';F.noWrap=true;F.appendChild(B.createTextNode(this.Label));};if (this.ShowArrow){if (this.Style!=0){E.insertCell(-1).appendChild(this._CreatePaddingElement(B));};F=E.insertCell(-1);var G=F.appendChild(B.createElement('IMG'));G.src=TEConfig.SkinPath+'images/toolbar.buttonarrow.gif';G.width=5;G.height=3;};F=E.insertCell(-1);F.appendChild(this._CreatePaddingElement(B));};A.appendChild(C);};TEToolbarButtonUI.prototype.ChangeState=function(A,B){if (!B&&this.State==A) return;var e=this.MainElement;if (!e) return;switch (parseInt(A,10)){case 0:e.className='TB_Button_Off';break;case 1:e.className='TB_Button_On';break;case -1:e.className='TB_Button_Disabled';break;};this.State=A;};function TEToolbarButtonUI_OnMouseOver(A,B){if (B.State==0) this.className='TB_Button_Off_Over';else if (B.State==1) this.className='TB_Button_On_Over';};function TEToolbarButtonUI_OnMouseOut(A,B){if (B.State==0) this.className='TB_Button_Off';else if (B.State==1) this.className='TB_Button_On';};function TEToolbarButtonUI_OnClick(A,B){if (B.OnClick&&B.State!=-1) B.OnClick(B);};function TEToolbarButtonUI_Cleanup(){this.MainElement=null;};
var TEToolbarButton=function(A,B,C,D,E,F,G){this.CommandName=A;this.Label=B;this.Tooltip=C;this.Style=D;this.SourceView=E?true:false;this.ContextSensitive=F?true:false;if (G==null) this.IconPath=TEConfig.SkinPath+'toolbar/'+A.toLowerCase()+'.gif';else if (typeof(G)=='number') this.IconPath=[TEConfig.SkinPath+'te_strip.gif',16,G];else this.IconPath=G;};TEToolbarButton.prototype.Create=function(A){this._UIButton=new TEToolbarButtonUI(this.CommandName,this.Label,this.Tooltip,this.IconPath,this.Style);this._UIButton.OnClick=this.Click;this._UIButton._ToolbarButton=this;this._UIButton.Create(A);};TEToolbarButton.prototype.RefreshState=function(){var A=TE.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).GetState();if (A==this._UIButton.State) return;this._UIButton.ChangeState(A);};TEToolbarButton.prototype.Click=function(){var A=this._ToolbarButton||this;TE.ToolbarSet.CurrentInstance.Commands.GetCommand(A.CommandName).Execute();};TEToolbarButton.prototype.Enable=function(){this.RefreshState();};TEToolbarButton.prototype.Disable=function(){this._UIButton.ChangeState(-1);}
var TESpecialCombo=function(A,B,C,D,E){this.FieldWidth=B||100;this.PanelWidth=C||150;this.PanelMaxHeight=D||150;this.Label='&nbsp;';this.Caption=A;this.Tooltip=A;this.Style=2;this.Enabled=true;this.Items={};this._Panel=new TEPanel(E||window);this._Panel.AppendStyleSheet(TEConfig.SkinPath+'te_editor.css');this._PanelBox=this._Panel.MainNode.appendChild(this._Panel.Document.createElement('DIV'));this._PanelBox.className='SC_Panel';this._PanelBox.style.width=this.PanelWidth+'px';this._PanelBox.innerHTML='<table cellpadding="0" cellspacing="0" width="100%" style="TABLE-LAYOUT: fixed"><tr><td nowrap></td></tr></table>';this._ItemsHolderEl=this._PanelBox.getElementsByTagName('TD')[0];if (TE.IECleanup) TE.IECleanup.AddItem(this,TESpecialCombo_Cleanup);};function TESpecialCombo_ItemOnMouseOver(){this.className+=' SC_ItemOver';};function TESpecialCombo_ItemOnMouseOut(){this.className=this.originalClass;};function TESpecialCombo_ItemOnClick(A,B,C){this.className=this.originalClass;B._Panel.Hide();B.SetLabel(this.TEItemLabel);if (typeof(B.OnSelect)=='function') B.OnSelect(C,this);};TESpecialCombo.prototype.ClearItems=function (){if (this.Items) this.Items={};var A=this._ItemsHolderEl;while (A.firstChild) A.removeChild(A.firstChild);};TESpecialCombo.prototype.AddItem=function(A,B,C,D){var E=this._ItemsHolderEl.appendChild(this._Panel.Document.createElement('DIV'));E.className=E.originalClass='SC_Item';E.innerHTML=B;E.TEItemLabel=C||A;E.Selected=false;if (TEBrowserInfo.IsIE) E.style.width='100%';if (D) E.style.backgroundColor=D;TETools.AddEventListenerEx(E,'mouseover',TESpecialCombo_ItemOnMouseOver);TETools.AddEventListenerEx(E,'mouseout',TESpecialCombo_ItemOnMouseOut);TETools.AddEventListenerEx(E,'click',TESpecialCombo_ItemOnClick,[this,A]);this.Items[A.toString().toLowerCase()]=E;return E;};TESpecialCombo.prototype.SelectItem=function(A){if (typeof A=='string') A=this.Items[A.toString().toLowerCase()];if (A){A.className=A.originalClass='SC_ItemSelected';A.Selected=true;}};TESpecialCombo.prototype.SelectItemByLabel=function(A,B){for (var C in this.Items){var D=this.Items[C];if (D.TEItemLabel==A){D.className=D.originalClass='SC_ItemSelected';D.Selected=true;if (B) this.SetLabel(A);}}};TESpecialCombo.prototype.DeselectAll=function(A){for (var i in this.Items){if (!this.Items[i]) continue;this.Items[i].className=this.Items[i].originalClass='SC_Item';this.Items[i].Selected=false;};if (A) this.SetLabel('');};TESpecialCombo.prototype.SetLabelById=function(A){A=A?A.toString().toLowerCase():'';var B=this.Items[A];this.SetLabel(B?B.TEItemLabel:'');};TESpecialCombo.prototype.SetLabel=function(A){A=(!A||A.length==0)?'&nbsp;':A;if (A==this.Label) return;this.Label=A;var B=this._LabelEl;if (B){B.innerHTML=A;TETools.DisableSelection(B);}};TESpecialCombo.prototype.SetEnabled=function(A){this.Enabled=A;if (this._OuterTable) this._OuterTable.className=A?'':'SC_FieldDisabled';};TESpecialCombo.prototype.Create=function(A){var B=TETools.GetElementDocument(A);var C=this._OuterTable=A.appendChild(B.createElement('TABLE'));C.cellPadding=0;C.cellSpacing=0;C.insertRow(-1);var D;var E;switch (this.Style){case 0:D='TB_ButtonType_Icon';E=false;break;case 1:D='TB_ButtonType_Text';E=false;break;case 2:E=true;break;};if (this.Caption&&this.Caption.length>0&&E){var F=C.rows[0].insertCell(-1);F.innerHTML=this.Caption;F.className='SC_FieldCaption';};var G=TETools.AppendElement(C.rows[0].insertCell(-1),'div');if (E){G.className='SC_Field';G.style.width=this.FieldWidth+'px';G.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" style="TABLE-LAYOUT: fixed;"><tbody><tr><td class="SC_FieldLabel"><label>&nbsp;</label></td><td class="SC_FieldButton">&nbsp;</td></tr></tbody></table>';this._LabelEl=G.getElementsByTagName('label')[0];this._LabelEl.innerHTML=this.Label;}else{G.className='TB_Button_Off';G.innerHTML='<table title="'+this.Tooltip+'" class="'+D+'" cellspacing="0" cellpadding="0" border="0"><tr><td><img class="TB_Button_Padding" src="'+TE_SPACER_PATH+'" /></td><td class="TB_Text">'+this.Caption+'</td><td><img class="TB_Button_Padding" src="'+TE_SPACER_PATH+'" /></td><td class="TB_ButtonArrow"><img src="'+TEConfig.SkinPath+'images/toolbar.buttonarrow.gif" width="5" height="3"></td><td><img class="TB_Button_Padding" src="'+TE_SPACER_PATH+'" /></td></tr></table>';};TETools.AddEventListenerEx(G,'mouseover',TESpecialCombo_OnMouseOver,this);TETools.AddEventListenerEx(G,'mouseout',TESpecialCombo_OnMouseOut,this);TETools.AddEventListenerEx(G,'click',TESpecialCombo_OnClick,this);TETools.DisableSelection(this._Panel.Document.body);};function TESpecialCombo_Cleanup(){this._LabelEl=null;this._OuterTable=null;this._ItemsHolderEl=null;this._PanelBox=null;if (this.Items){for (var A in this.Items) this.Items[A]=null;}};function TESpecialCombo_OnMouseOver(A,B){if (B.Enabled){switch (B.Style){case 0:this.className='TB_Button_On_Over';break;case 1:this.className='TB_Button_On_Over';break;case 2:this.className='SC_Field SC_FieldOver';break;}}};function TESpecialCombo_OnMouseOut(A,B){switch (B.Style){case 0:this.className='TB_Button_Off';break;case 1:this.className='TB_Button_Off';break;case 2:this.className='SC_Field';break;}};function TESpecialCombo_OnClick(e,A){if (A.Enabled){var B=A._Panel;var C=A._PanelBox;var D=A._ItemsHolderEl;var E=A.PanelMaxHeight;if (A.OnBeforeClick) A.OnBeforeClick(A);if (TEBrowserInfo.IsIE) B.Preload(0,this.offsetHeight,this);if (D.offsetHeight>E) C.style.height=E+'px';else C.style.height='';B.Show(0,this.offsetHeight,this);}};
var TEToolbarSpecialCombo=function(){this.SourceView=false;this.ContextSensitive=true;};TEToolbarSpecialCombo.prototype.DefaultLabel='';function TEToolbarSpecialCombo_OnSelect(A,B){TE.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).Execute(A,B);};TEToolbarSpecialCombo.prototype.Create=function(A){this._Combo=new TESpecialCombo(this.GetLabel(),this.FieldWidth,this.PanelWidth,this.PanelMaxHeight,TEBrowserInfo.IsIE?window:TETools.GetElementWindow(A).parent);this._Combo.Tooltip=this.Tooltip;this._Combo.Style=this.Style;this.CreateItems(this._Combo);this._Combo.Create(A);this._Combo.CommandName=this.CommandName;this._Combo.OnSelect=TEToolbarSpecialCombo_OnSelect;};function TEToolbarSpecialCombo_RefreshActiveItems(A,B){A.DeselectAll();A.SelectItem(B);A.SetLabelById(B);};TEToolbarSpecialCombo.prototype.RefreshState=function(){var A;var B=TE.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).GetState();if (B!=-1){A=1;if (this.RefreshActiveItems) this.RefreshActiveItems(this._Combo,B);else{if (this._LastValue!==B){this._LastValue=B;if (!B||B.length==0){this._Combo.DeselectAll();this._Combo.SetLabel(this.DefaultLabel);}else TEToolbarSpecialCombo_RefreshActiveItems(this._Combo,B);}}}else A=-1;if (A==this.State) return;if (A==-1){this._Combo.DeselectAll();this._Combo.SetLabel('');};this.State=A;this._Combo.SetEnabled(A!=-1);};TEToolbarSpecialCombo.prototype.Enable=function(){this.RefreshState();};TEToolbarSpecialCombo.prototype.Disable=function(){this.State=-1;this._Combo.DeselectAll();this._Combo.SetLabel('');this._Combo.SetEnabled(false);};
var TEToolbarStyleCombo=function(A,B){if (A===false) return;this.CommandName='Style';this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:2;this.DefaultLabel=TEConfig.DefaultStyleLabel||'';};TEToolbarStyleCombo.prototype=new TEToolbarSpecialCombo;TEToolbarStyleCombo.prototype.GetLabel=function(){return TELang.Style;};TEToolbarStyleCombo.prototype.GetStyles=function(){var A={};var B=TE.ToolbarSet.CurrentInstance.Styles.GetStyles();for (var C in B){var D=B[C];if (!D.IsCore) A[C]=D;};return A;};TEToolbarStyleCombo.prototype.CreateItems=function(A){var B=A._Panel.Document;TETools.AppendStyleSheet(B,TEConfig.ToolbarComboPreviewCSS);TETools.AppendStyleString(B,TEConfig.EditorAreaStyles);B.body.className+=' ForceBaseFont';TEConfig.ApplyBodyAttributes(B.body);var C=this.GetStyles();for (var D in C){var E=C[D];var F=E.GetType()==2?D:TEToolbarStyleCombo_BuildPreview(E,E.Label||D);var G=A.AddItem(D,F);G.Style=E;};A.OnBeforeClick=this.StyleCombo_OnBeforeClick;};TEToolbarStyleCombo.prototype.RefreshActiveItems=function(A){var B=TE.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if (B){var C=new TEElementPath(B);var D=C.Elements;for (var e=0;e<D.length;e++){for (var i in A.Items){var E=A.Items[i];var F=E.Style;if (F.CheckElementRemovable(D[e],true)){A.SetLabel(F.Label||F.Name);return;}}}};A.SetLabel(this.DefaultLabel);};TEToolbarStyleCombo.prototype.StyleCombo_OnBeforeClick=function(A){A.DeselectAll();var B;var C;var D;var E=TE.ToolbarSet.CurrentInstance.Selection;if (E.GetType()=='Control'){B=E.GetSelectedElement();D=B.nodeName.toLowerCase();}else{B=E.GetBoundaryParentElement(true);C=new TEElementPath(B);};for (var i in A.Items){var F=A.Items[i];var G=F.Style;if ((D&&G.Element==D)||(!D&&G.GetType()!=2)){F.style.display='';if ((C&&G.CheckActive(C))||(!C&&G.CheckElementRemovable(B,true))) A.SelectItem(G.Name);}else F.style.display='none';}};function TEToolbarStyleCombo_BuildPreview(A,B){var C=A.GetType();var D=[];if (C==0) D.push('<div class="BaseFont">');var E=A.Element;if (E=='bdo') E='span';D=['<',E];var F=A._StyleDesc.Attributes;if (F){for (var G in F){D.push(' ',G,'="',A.GetFinalAttributeValue(G),'"');}};if (A._GetStyleText().length>0) D.push(' style="',A.GetFinalStyleValue(),'"');D.push('>',B,'</',E,'>');if (C==0) D.push('</div>');return D.join('');}
var TEToolbarFontFormatCombo=function(A,B){if (A===false) return;this.CommandName='FontFormat';this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:2;this.NormalLabel='Normal';this.PanelWidth=190;this.DefaultLabel=TEConfig.DefaultFontFormatLabel||'';};TEToolbarFontFormatCombo.prototype=new TEToolbarStyleCombo(false);TEToolbarFontFormatCombo.prototype.GetLabel=function(){return TELang.FontFormat;};TEToolbarFontFormatCombo.prototype.GetStyles=function(){var A={};var B=TELang['FontFormats'].split(';');var C={p:B[0],pre:B[1],address:B[2],h1:B[3],h2:B[4],h3:B[5],h4:B[6],h5:B[7],h6:B[8],div:B[9]||(B[0]+' (DIV)')};var D=TEConfig.FontFormats.split(';');for (var i=0;i<D.length;i++){var E=D[i];var F=TEStyles.GetStyle('_TE_'+E);if (F){F.Label=C[E];A['_TE_'+E]=F;}else alert("The TEConfig.CoreStyles['"+E+"'] setting was not found. Please check the teconfig.js file");};return A;};TEToolbarFontFormatCombo.prototype.RefreshActiveItems=function(A){var B=TE.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if (B){var C=new TEElementPath(B);var D=C.Block;if (D){for (var i in A.Items){var E=A.Items[i];var F=E.Style;if (F.CheckElementRemovable(D)){A.SetLabel(F.Label);return;}}}};A.SetLabel(this.DefaultLabel);};TEToolbarFontFormatCombo.prototype.StyleCombo_OnBeforeClick=function(A){A.DeselectAll();var B=TE.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if (B){var C=new TEElementPath(B);var D=C.Block;for (var i in A.Items){var E=A.Items[i];var F=E.Style;if (F.CheckElementRemovable(D)){A.SelectItem(E);return;}}}};
var TEToolbarFontsCombo=function(A,B){this.CommandName='FontName';this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:2;this.DefaultLabel=TEConfig.DefaultFontLabel||'';};TEToolbarFontsCombo.prototype=new TEToolbarFontFormatCombo(false);TEToolbarFontsCombo.prototype.GetLabel=function(){return TELang.Font;};TEToolbarFontsCombo.prototype.GetStyles=function(){var A=TEStyles.GetStyle('_TE_FontFace');if (!A){alert("The TEConfig.CoreStyles['Size'] setting was not found. Please check the teconfig.js file");return {};};var B={};var C=TEConfig.FontNames.split(';');for (var i=0;i<C.length;i++){var D=C[i].split('/');var E=D[0];var F=D[1]||E;var G=TETools.CloneObject(A);G.SetVariable('Font',E);G.Label=F;B[F]=G;};return B;};TEToolbarFontsCombo.prototype.RefreshActiveItems=TEToolbarStyleCombo.prototype.RefreshActiveItems;TEToolbarFontsCombo.prototype.StyleCombo_OnBeforeClick=function(A){A.DeselectAll();var B=TESelection.GetBoundaryParentElement(true);if (B){var C=new TEElementPath(B);for (var i in A.Items){var D=A.Items[i];var E=D.Style;if (E.CheckActive(C)){A.SelectItem(D);return;}}}};
var TEToolbarFontSizeCombo=function(A,B){this.CommandName='FontSize';this.Label=this.GetLabel();this.Tooltip=A?A:this.Label;this.Style=B?B:2;this.DefaultLabel=TEConfig.DefaultFontSizeLabel||'';this.FieldWidth=70;};TEToolbarFontSizeCombo.prototype=new TEToolbarFontFormatCombo(false);TEToolbarFontSizeCombo.prototype.GetLabel=function(){return TELang.FontSize;};TEToolbarFontSizeCombo.prototype.GetStyles=function(){var A=TEStyles.GetStyle('_TE_Size');if (!A){alert("The TEConfig.CoreStyles['FontFace'] setting was not found. Please check the teconfig.js file");return {};};var B={};var C=TEConfig.FontSizes.split(';');for (var i=0;i<C.length;i++){var D=C[i].split('/');var E=D[0];var F=D[1]||E;var G=TETools.CloneObject(A);G.SetVariable('Size',E);G.Label=F;B[F]=G;};return B;};TEToolbarFontSizeCombo.prototype.RefreshActiveItems=TEToolbarStyleCombo.prototype.RefreshActiveItems;TEToolbarFontSizeCombo.prototype.StyleCombo_OnBeforeClick=TEToolbarFontsCombo.prototype.StyleCombo_OnBeforeClick;
var TEToolbarPanelButton=function(A,B,C,D,E){this.CommandName=A;var F;if (E==null) F=TEConfig.SkinPath+'toolbar/'+A.toLowerCase()+'.gif';else if (typeof(E)=='number') F=[TEConfig.SkinPath+'te_strip.gif',16,E];var G=this._UIButton=new TEToolbarButtonUI(A,B,C,F,D);G._TEToolbarPanelButton=this;G.ShowArrow=true;G.OnClick=TEToolbarPanelButton_OnButtonClick;};TEToolbarPanelButton.prototype.TypeName='TEToolbarPanelButton';TEToolbarPanelButton.prototype.Create=function(A){A.className+='Menu';this._UIButton.Create(A);var B=TE.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName)._Panel;B._TEToolbarPanelButton=this;var C=B.Document.body.appendChild(B.Document.createElement('div'));C.style.position='absolute';C.style.top='0px';var D=this.LineImg=C.appendChild(B.Document.createElement('IMG'));D.className='TB_ConnectionLine';D.style.position='absolute';D.src=TE_SPACER_PATH;B.OnHide=TEToolbarPanelButton_OnPanelHide;};function TEToolbarPanelButton_OnButtonClick(A){var B=this._TEToolbarPanelButton;var e=B._UIButton.MainElement;B._UIButton.ChangeState(1);B.LineImg.style.width=(e.offsetWidth-2)+'px';TE.ToolbarSet.CurrentInstance.Commands.GetCommand(B.CommandName).Execute(0,e.offsetHeight-1,e);};function TEToolbarPanelButton_OnPanelHide(){var A=this._TEToolbarPanelButton;A._UIButton.ChangeState(0);};TEToolbarPanelButton.prototype.RefreshState=TEToolbarButton.prototype.RefreshState;TEToolbarPanelButton.prototype.Enable=TEToolbarButton.prototype.Enable;TEToolbarPanelButton.prototype.Disable=TEToolbarButton.prototype.Disable;
var TEToolbarItems={};TEToolbarItems.LoadedItems={};TEToolbarItems.RegisterItem=function(A,B){this.LoadedItems[A]=B;};TEToolbarItems.GetItem=function(A){var B=TEToolbarItems.LoadedItems[A];if (B) return B;switch (A){case 'Source':B=new TEToolbarButton('Source',TELang.Source,null,2,true,true,1);break;case 'DocProps':B=new TEToolbarButton('DocProps',TELang.DocProps,null,null,null,null,2);break;case 'Save':B=new TEToolbarButton('Save',TELang.Save,null,null,true,null,3);break;case 'NewPage':B=new TEToolbarButton('NewPage',TELang.NewPage,null,null,true,null,4);break;case 'Preview':B=new TEToolbarButton('Preview',TELang.Preview,null,null,true,null,5);break;case 'Templates':B=new TEToolbarButton('Templates',TELang.Templates,null,null,null,null,6);break;case 'About':B=new TEToolbarButton('About',TELang.About,null,null,true,null,47);break;case 'Cut':B=new TEToolbarButton('Cut',TELang.Cut,null,null,false,true,7);break;case 'Copy':B=new TEToolbarButton('Copy',TELang.Copy,null,null,false,true,8);break;case 'Paste':B=new TEToolbarButton('Paste',TELang.Paste,null,null,false,true,9);break;case 'PasteText':B=new TEToolbarButton('PasteText',TELang.PasteText,null,null,false,true,10);break;case 'PasteWord':B=new TEToolbarButton('PasteWord',TELang.PasteWord,null,null,false,true,11);break;case 'Print':B=new TEToolbarButton('Print',TELang.Print,null,null,false,true,12);break;case 'SpellCheck':B=new TEToolbarButton('SpellCheck',TELang.SpellCheck,null,null,null,null,13);break;case 'Undo':B=new TEToolbarButton('Undo',TELang.Undo,null,null,false,true,14);break;case 'Redo':B=new TEToolbarButton('Redo',TELang.Redo,null,null,false,true,15);break;case 'SelectAll':B=new TEToolbarButton('SelectAll',TELang.SelectAll,null,null,true,null,18);break;case 'RemoveFormat':B=new TEToolbarButton('RemoveFormat',TELang.RemoveFormat,null,null,false,true,19);break;case 'FitWindow':B=new TEToolbarButton('FitWindow',TELang.FitWindow,null,null,true,true,66);break;case 'Bold':B=new TEToolbarButton('Bold',TELang.Bold,null,null,false,true,20);break;case 'Italic':B=new TEToolbarButton('Italic',TELang.Italic,null,null,false,true,21);break;case 'Underline':B=new TEToolbarButton('Underline',TELang.Underline,null,null,false,true,22);break;case 'StrikeThrough':B=new TEToolbarButton('StrikeThrough',TELang.StrikeThrough,null,null,false,true,23);break;case 'Subscript':B=new TEToolbarButton('Subscript',TELang.Subscript,null,null,false,true,24);break;case 'Superscript':B=new TEToolbarButton('Superscript',TELang.Superscript,null,null,false,true,25);break;case 'OrderedList':B=new TEToolbarButton('InsertOrderedList',TELang.NumberedListLbl,TELang.NumberedList,null,false,true,26);break;case 'UnorderedList':B=new TEToolbarButton('InsertUnorderedList',TELang.BulletedListLbl,TELang.BulletedList,null,false,true,27);break;case 'Outdent':B=new TEToolbarButton('Outdent',TELang.DecreaseIndent,null,null,false,true,28);break;case 'Indent':B=new TEToolbarButton('Indent',TELang.IncreaseIndent,null,null,false,true,29);break;case 'Blockquote':B=new TEToolbarButton('Blockquote',TELang.Blockquote,null,null,false,true,73);break;case 'Link':B=new TEToolbarButton('Link',TELang.InsertLinkLbl,TELang.InsertLink,null,false,true,34);break;case 'Unlink':B=new TEToolbarButton('Unlink',TELang.RemoveLink,null,null,false,true,35);break;case 'Anchor':B=new TEToolbarButton('Anchor',TELang.Anchor,null,null,null,null,36);break;case 'Image':B=new TEToolbarButton('Image',TELang.InsertImageLbl,TELang.InsertImage,null,false,true,37);break;case 'Flash':B=new TEToolbarButton('Flash',TELang.InsertFlashLbl,TELang.InsertFlash,null,false,true,38);break;case 'Table':B=new TEToolbarButton('Table',TELang.InsertTableLbl,TELang.InsertTable,null,false,true,39);break;case 'SpecialChar':B=new TEToolbarButton('SpecialChar',TELang.InsertSpecialCharLbl,TELang.InsertSpecialChar,null,false,true,42);break;case 'Smiley':B=new TEToolbarButton('Smiley',TELang.InsertSmileyLbl,TELang.InsertSmiley,null,false,true,41);break;case 'PageBreak':B=new TEToolbarButton('PageBreak',TELang.PageBreakLbl,TELang.PageBreak,null,false,true,43);break;case 'Rule':B=new TEToolbarButton('Rule',TELang.InsertLineLbl,TELang.InsertLine,null,false,true,40);break;case 'JustifyLeft':B=new TEToolbarButton('JustifyLeft',TELang.LeftJustify,null,null,false,true,30);break;case 'JustifyCenter':B=new TEToolbarButton('JustifyCenter',TELang.CenterJustify,null,null,false,true,31);break;case 'JustifyRight':B=new TEToolbarButton('JustifyRight',TELang.RightJustify,null,null,false,true,32);break;case 'JustifyFull':B=new TEToolbarButton('JustifyFull',TELang.BlockJustify,null,null,false,true,33);break;case 'Style':B=new TEToolbarStyleCombo();break;case 'FontName':B=new TEToolbarFontsCombo();break;case 'FontSize':B=new TEToolbarFontSizeCombo();break;case 'FontFormat':B=new TEToolbarFontFormatCombo();break;case 'TextColor':B=new TEToolbarPanelButton('TextColor',TELang.TextColor,null,null,45);break;case 'BGColor':B=new TEToolbarPanelButton('BGColor',TELang.BGColor,null,null,46);break;case 'Find':B=new TEToolbarButton('Find',TELang.Find,null,null,null,null,16);break;case 'Replace':B=new TEToolbarButton('Replace',TELang.Replace,null,null,null,null,17);break;case 'Form':B=new TEToolbarButton('Form',TELang.Form,null,null,null,null,48);break;case 'Checkbox':B=new TEToolbarButton('Checkbox',TELang.Checkbox,null,null,null,null,49);break;case 'Radio':B=new TEToolbarButton('Radio',TELang.RadioButton,null,null,null,null,50);break;case 'TextField':B=new TEToolbarButton('TextField',TELang.TextField,null,null,null,null,51);break;case 'Textarea':B=new TEToolbarButton('Textarea',TELang.Textarea,null,null,null,null,52);break;case 'HiddenField':B=new TEToolbarButton('HiddenField',TELang.HiddenField,null,null,null,null,56);break;case 'Button':B=new TEToolbarButton('Button',TELang.Button,null,null,null,null,54);break;case 'Select':B=new TEToolbarButton('Select',TELang.SelectionField,null,null,null,null,53);break;case 'ImageButton':B=new TEToolbarButton('ImageButton',TELang.ImageButton,null,null,null,null,55);break;case 'ShowBlocks':B=new TEToolbarButton('ShowBlocks',TELang.ShowBlocks,null,null,null,true,72);break;default:alert(TELang.UnknownToolbarItem.replace(/%1/g,A));return null;};TEToolbarItems.LoadedItems[A]=B;return B;};
var TEToolbar=function(){this.Items=[];};TEToolbar.prototype.AddItem=function(A){return this.Items[this.Items.length]=A;};TEToolbar.prototype.AddButton=function(A,B,C,D,E,F){if (typeof(D)=='number') D=[this.DefaultIconsStrip,this.DefaultIconSize,D];var G=new TEToolbarButtonUI(A,B,C,D,E,F);G._TEToolbar=this;G.OnClick=TEToolbar_OnItemClick;return this.AddItem(G);};function TEToolbar_OnItemClick(A){var B=A._TEToolbar;if (B.OnItemClick) B.OnItemClick(B,A);};TEToolbar.prototype.AddSeparator=function(){this.AddItem(new TEToolbarSeparator());};TEToolbar.prototype.Create=function(A){var B=TETools.GetElementDocument(A);var e=B.createElement('table');e.className='TB_Toolbar';e.style.styleFloat=e.style.cssFloat=(TELang.Dir=='ltr'?'left':'right');e.dir=TELang.Dir;e.cellPadding=0;e.cellSpacing=0;var C=e.insertRow(-1);var D;if (!this.HideStart){D=C.insertCell(-1);D.appendChild(B.createElement('div')).className='TB_Start';};for (var i=0;i<this.Items.length;i++){this.Items[i].Create(C.insertCell(-1));};if (!this.HideEnd){D=C.insertCell(-1);D.appendChild(B.createElement('div')).className='TB_End';};A.appendChild(e);};var TEToolbarSeparator=function(){};TEToolbarSeparator.prototype.Create=function(A){TETools.AppendElement(A,'div').className='TB_Separator';}
var TEToolbarBreak=function(){};TEToolbarBreak.prototype.Create=function(A){var B=TETools.GetElementDocument(A).createElement('div');B.className='TB_Break';B.style.clear=TELang.Dir=='rtl'?'left':'right';A.appendChild(B);};
function TEToolbarSet_Create(A){var B;var C=A||TEConfig.ToolbarLocation;switch (C){case 'In':document.getElementById('xToolbarRow').style.display='';B=new TEToolbarSet(document);break;case 'None':B=new TEToolbarSet(document);break;default:TE.Events.AttachEvent('OnBlur',TE_OnBlur);TE.Events.AttachEvent('OnFocus',TE_OnFocus);var D;var E=C.match(/^Out:(.+)\((\w+)\)$/);if (E){D=eval('parent.'+E[1]).document.getElementById(E[2]);}else{E=C.match(/^Out:(\w+)$/);if (E) D=parent.document.getElementById(E[1]);};if (!D){alert('Invalid value for "ToolbarLocation"');return arguments.callee('In');};B=D.__TEToolbarSet;if (B) break;var F=TETools.GetElementDocument(D).createElement('iframe');F.src='javascript:void(0)';F.frameBorder=0;F.width='100%';F.height='10';D.appendChild(F);F.unselectable='on';var G=F.contentWindow.document;var H='';if (TEBrowserInfo.IsSafari) H='<base href="'+window.document.location+'">';G.open();G.write('<html><head>'+H+'<script type="text/javascript"> var adjust = function() { window.frameElement.height = document.body.scrollHeight ; }; window.onresize = adjust; window.onload = function () {window.setTimeout( adjust, 0 );}</script></head><body style="overflow: hidden">'+document.getElementById('xToolbarSpace').innerHTML+'</body></html>');G.close();TETools.AddEventListener(G,'contextmenu',TETools.CancelEvent);TETools.AppendStyleSheet(G,TEConfig.SkinPath+'te_editor.css');B=D.__TEToolbarSet=new TEToolbarSet(G);B._IFrame=F;if (TE.IECleanup) TE.IECleanup.AddItem(D,TEToolbarSet_Target_Cleanup);};B.CurrentInstance=TE;TE.AttachToOnSelectionChange(B.RefreshItemsState);return B;};function TE_OnBlur(A){var B=A.ToolbarSet;if (B.CurrentInstance==A) B.Disable();};function TE_OnFocus(A){var B=A.ToolbarSet;var C=A||TE;B.CurrentInstance.FocusManager.RemoveWindow(B._IFrame.contentWindow);B.CurrentInstance=C;C.FocusManager.AddWindow(B._IFrame.contentWindow,true);B.Enable();};function TEToolbarSet_Cleanup(){this._TargetElement=null;this._IFrame=null;};function TEToolbarSet_Target_Cleanup(){this.__TEToolbarSet=null;};var TEToolbarSet=function(A){this._Document=A;this._TargetElement=A.getElementById('xToolbar');var B=A.getElementById('xExpandHandle');var C=A.getElementById('xCollapseHandle');B.title=TELang.ToolbarExpand;TETools.AddEventListener(B,'click',TEToolbarSet_Expand_OnClick);C.title=TELang.ToolbarCollapse;TETools.AddEventListener(C,'click',TEToolbarSet_Collapse_OnClick);if (!TEConfig.ToolbarCanCollapse||TEConfig.ToolbarStartExpanded) this.Expand();else this.Collapse();C.style.display=TEConfig.ToolbarCanCollapse?'':'none';if (TEConfig.ToolbarCanCollapse) C.style.display='';else A.getElementById('xTBLeftBorder').style.display='';this.Toolbars=[];this.IsLoaded=false;if (TE.IECleanup) TE.IECleanup.AddItem(this,TEToolbarSet_Cleanup);};function TEToolbarSet_Expand_OnClick(){TE.ToolbarSet.Expand();};function TEToolbarSet_Collapse_OnClick(){TE.ToolbarSet.Collapse();};TEToolbarSet.prototype.Expand=function(){this._ChangeVisibility(false);};TEToolbarSet.prototype.Collapse=function(){this._ChangeVisibility(true);};TEToolbarSet.prototype._ChangeVisibility=function(A){this._Document.getElementById('xCollapsed').style.display=A?'':'none';this._Document.getElementById('xExpanded').style.display=A?'none':'';if (TEBrowserInfo.IsGecko){TETools.RunFunction(window.onresize);}};TEToolbarSet.prototype.Load=function(A){this.Name=A;this.Items=[];this.ItemsWysiwygOnly=[];this.ItemsContextSensitive=[];this._TargetElement.innerHTML='';var B=TEConfig.ToolbarSets[A];if (!B){alert(TELang.UnknownToolbarSet.replace(/%1/g,A));return;};this.Toolbars=[];for (var x=0;x<B.length;x++){var C=B[x];if (!C) continue;var D;if (typeof(C)=='string'){if (C=='/') D=new TEToolbarBreak();}else{D=new TEToolbar();for (var j=0;j<C.length;j++){var E=C[j];if (E=='-') D.AddSeparator();else{var F=TEToolbarItems.GetItem(E);if (F){D.AddItem(F);this.Items.push(F);if (!F.SourceView) this.ItemsWysiwygOnly.push(F);if (F.ContextSensitive) this.ItemsContextSensitive.push(F);}}}};D.Create(this._TargetElement);this.Toolbars[this.Toolbars.length]=D;};TETools.DisableSelection(this._Document.getElementById('xCollapseHandle').parentNode);if (TE.Status!=2) TE.Events.AttachEvent('OnStatusChange',this.RefreshModeState);else this.RefreshModeState();this.IsLoaded=true;this.IsEnabled=true;TETools.RunFunction(this.OnLoad);};TEToolbarSet.prototype.Enable=function(){if (this.IsEnabled) return;this.IsEnabled=true;var A=this.Items;for (var i=0;i<A.length;i++) A[i].RefreshState();};TEToolbarSet.prototype.Disable=function(){if (!this.IsEnabled) return;this.IsEnabled=false;var A=this.Items;for (var i=0;i<A.length;i++) A[i].Disable();};TEToolbarSet.prototype.RefreshModeState=function(A){if (TE.Status!=2) return;var B=A?A.ToolbarSet:this;var C=B.ItemsWysiwygOnly;if (TE.EditMode==0){for (var i=0;i<C.length;i++) C[i].Enable();B.RefreshItemsState(A);}else{B.RefreshItemsState(A);for (var j=0;j<C.length;j++) C[j].Disable();}};TEToolbarSet.prototype.RefreshItemsState=function(A){var B=(A?A.ToolbarSet:this).ItemsContextSensitive;for (var i=0;i<B.length;i++) B[i].RefreshState();};
var TEDialog={};TEDialog.OpenDialog=function(A,B,C,D,E,F,G,H){var I={};I.Title=B;I.Page=C;I.Editor=window;I.CustomValue=F;var J=TEConfig.BasePath+'tedialog.html';this.Show(I,A,J,D,E,G,H);};
TEDialog.Show=function(A,B,C,D,E,F,G){if (!F) F=window;var H='help:no;scroll:no;status:no;resizable:'+(G?'yes':'no')+';dialogWidth:'+D+'px;dialogHeight:'+E+'px';TEFocusManager.Lock();var I='B';try{A.DialogName=B;I=F.showModalDialog(C,A,H);}catch(e) {};if ('B'===I) alert(TELang.DialogBlocked);TEFocusManager.Unlock();};
var TEMenuItem=function(A,B,C,D,E){this.Name=B;this.Label=C||B;this.IsDisabled=E;this.Icon=new TEIcon(D);this.SubMenu=new TEMenuBlockPanel();this.SubMenu.Parent=A;this.SubMenu.OnClick=TETools.CreateEventListener(TEMenuItem_SubMenu_OnClick,this);if (TE.IECleanup) TE.IECleanup.AddItem(this,TEMenuItem_Cleanup);};TEMenuItem.prototype.AddItem=function(A,B,C,D){this.HasSubMenu=true;return this.SubMenu.AddItem(A,B,C,D);};TEMenuItem.prototype.AddSeparator=function(){this.SubMenu.AddSeparator();};TEMenuItem.prototype.Create=function(A){var B=this.HasSubMenu;var C=TETools.GetElementDocument(A);var r=this.MainElement=A.insertRow(-1);r.className=this.IsDisabled?'MN_Item_Disabled':'MN_Item';if (!this.IsDisabled){TETools.AddEventListenerEx(r,'mouseover',TEMenuItem_OnMouseOver,[this]);TETools.AddEventListenerEx(r,'click',TEMenuItem_OnClick,[this]);if (!B) TETools.AddEventListenerEx(r,'mouseout',TEMenuItem_OnMouseOut,[this]);};var D=r.insertCell(-1);D.className='MN_Icon';D.appendChild(this.Icon.CreateIconElement(C));D=r.insertCell(-1);D.className='MN_Label';D.noWrap=true;D.appendChild(C.createTextNode(this.Label));D=r.insertCell(-1);if (B){D.className='MN_Arrow';var E=D.appendChild(C.createElement('IMG'));E.src=TE_IMAGES_PATH+'arrow_'+TELang.Dir+'.gif';E.width=4;E.height=7;this.SubMenu.Create();this.SubMenu.Panel.OnHide=TETools.CreateEventListener(TEMenuItem_SubMenu_OnHide,this);}};TEMenuItem.prototype.Activate=function(){this.MainElement.className='MN_Item_Over';if (this.HasSubMenu){this.SubMenu.Show(this.MainElement.offsetWidth+2,-2,this.MainElement);};TETools.RunFunction(this.OnActivate,this);};TEMenuItem.prototype.Deactivate=function(){this.MainElement.className='MN_Item';if (this.HasSubMenu) this.SubMenu.Hide();};function TEMenuItem_SubMenu_OnClick(A,B){TETools.RunFunction(B.OnClick,B,[A]);};function TEMenuItem_SubMenu_OnHide(A){A.Deactivate();};function TEMenuItem_OnClick(A,B){if (B.HasSubMenu) B.Activate();else{B.Deactivate();TETools.RunFunction(B.OnClick,B,[B]);}};function TEMenuItem_OnMouseOver(A,B){B.Activate();};function TEMenuItem_OnMouseOut(A,B){B.Deactivate();};function TEMenuItem_Cleanup(){this.MainElement=null;}
var TEMenuBlock=function(){this._Items=[];};TEMenuBlock.prototype.Count=function(){return this._Items.length;};TEMenuBlock.prototype.AddItem=function(A,B,C,D){var E=new TEMenuItem(this,A,B,C,D);E.OnClick=TETools.CreateEventListener(TEMenuBlock_Item_OnClick,this);E.OnActivate=TETools.CreateEventListener(TEMenuBlock_Item_OnActivate,this);this._Items.push(E);return E;};TEMenuBlock.prototype.AddSeparator=function(){this._Items.push(new TEMenuSeparator());};TEMenuBlock.prototype.RemoveAllItems=function(){this._Items=[];var A=this._ItemsTable;if (A){while (A.rows.length>0) A.deleteRow(0);}};TEMenuBlock.prototype.Create=function(A){if (!this._ItemsTable){if (TE.IECleanup) TE.IECleanup.AddItem(this,TEMenuBlock_Cleanup);this._Window=TETools.GetElementWindow(A);var B=TETools.GetElementDocument(A);var C=A.appendChild(B.createElement('table'));C.cellPadding=0;C.cellSpacing=0;TETools.DisableSelection(C);var D=C.insertRow(-1).insertCell(-1);D.className='MN_Menu';var E=this._ItemsTable=D.appendChild(B.createElement('table'));E.cellPadding=0;E.cellSpacing=0;};for (var i=0;i<this._Items.length;i++) this._Items[i].Create(this._ItemsTable);};function TEMenuBlock_Item_OnClick(A,B){if (B.Hide) B.Hide();TETools.RunFunction(B.OnClick,B,[A]);};function TEMenuBlock_Item_OnActivate(A){var B=A._ActiveItem;if (B&&B!=this){if (!TEBrowserInfo.IsIE&&B.HasSubMenu&&!this.HasSubMenu){A._Window.focus();A.Panel.HasFocus=true;};B.Deactivate();};A._ActiveItem=this;};function TEMenuBlock_Cleanup(){this._Window=null;this._ItemsTable=null;};var TEMenuSeparator=function(){};TEMenuSeparator.prototype.Create=function(A){var B=TETools.GetElementDocument(A);var r=A.insertRow(-1);var C=r.insertCell(-1);C.className='MN_Separator MN_Icon';C=r.insertCell(-1);C.className='MN_Separator';C.appendChild(B.createElement('DIV')).className='MN_Separator_Line';C=r.insertCell(-1);C.className='MN_Separator';C.appendChild(B.createElement('DIV')).className='MN_Separator_Line';}
var TEMenuBlockPanel=function(){TEMenuBlock.call(this);};TEMenuBlockPanel.prototype=new TEMenuBlock();TEMenuBlockPanel.prototype.Create=function(){var A=this.Panel=(this.Parent&&this.Parent.Panel?this.Parent.Panel.CreateChildPanel():new TEPanel());A.AppendStyleSheet(TEConfig.SkinPath+'te_editor.css');TEMenuBlock.prototype.Create.call(this,A.MainNode);};TEMenuBlockPanel.prototype.Show=function(x,y,A){if (!this.Panel.CheckIsOpened()) this.Panel.Show(x,y,A);};TEMenuBlockPanel.prototype.Hide=function(){if (this.Panel.CheckIsOpened()) this.Panel.Hide();}
var TEContextMenu=function(A,B){this.CtrlDisable=false;var C=this._Panel=new TEPanel(A);C.AppendStyleSheet(TEConfig.SkinPath+'te_editor.css');C.IsContextMenu=true;if (TEBrowserInfo.IsGecko) C.Document.addEventListener('draggesture',function(e) {e.preventDefault();return false;},true);var D=this._MenuBlock=new TEMenuBlock();D.Panel=C;D.OnClick=TETools.CreateEventListener(TEContextMenu_MenuBlock_OnClick,this);this._Redraw=true;};TEContextMenu.prototype.SetMouseClickWindow=function(A){if (!TEBrowserInfo.IsIE){this._Document=A.document;if (TEBrowserInfo.IsOpera&&!('oncontextmenu' in document.createElement('foo'))){this._Document.addEventListener('mousedown',TEContextMenu_Document_OnMouseDown,false);this._Document.addEventListener('mouseup',TEContextMenu_Document_OnMouseUp,false);};this._Document.addEventListener('contextmenu',TEContextMenu_Document_OnContextMenu,false);}};TEContextMenu.prototype.AddItem=function(A,B,C,D){var E=this._MenuBlock.AddItem(A,B,C,D);this._Redraw=true;return E;};TEContextMenu.prototype.AddSeparator=function(){this._MenuBlock.AddSeparator();this._Redraw=true;};TEContextMenu.prototype.RemoveAllItems=function(){this._MenuBlock.RemoveAllItems();this._Redraw=true;};TEContextMenu.prototype.AttachToElement=function(A){if (TEBrowserInfo.IsIE) TETools.AddEventListenerEx(A,'contextmenu',TEContextMenu_AttachedElement_OnContextMenu,this);else A._TEContextMenu=this;};function TEContextMenu_Document_OnContextMenu(e){var A=e.target;while (A){if (A._TEContextMenu){if (A._TEContextMenu.CtrlDisable&&(e.ctrlKey||e.metaKey)) return true;TETools.CancelEvent(e);TEContextMenu_AttachedElement_OnContextMenu(e,A._TEContextMenu,A);return false;};A=A.parentNode;};return true;};var TEContextMenu_OverrideButton;function TEContextMenu_Document_OnMouseDown(e){if(!e||e.button!=2) return false;var A=e.target;while (A){if (A._TEContextMenu){if (A._TEContextMenu.CtrlDisable&&(e.ctrlKey||e.metaKey)) return true;var B=TEContextMenu_OverrideButton;if(!B){var C=e.target.ownerDocument;B=TEContextMenu_OverrideButton=C.createElement('input');B.type='button';var D=C.createElement('p');C.body.appendChild(D);D.appendChild(B);};B.style.cssText='position:absolute;top:'+(e.clientY-2)+'px;left:'+(e.clientX-2)+'px;width:5px;height:5px;opacity:0.01';};A=A.parentNode;};return false;};function TEContextMenu_Document_OnMouseUp(e){var A=TEContextMenu_OverrideButton;if (A){var B=A.parentNode;B.parentNode.removeChild(B);TEContextMenu_OverrideButton=undefined;if(e&&e.button==2){TEContextMenu_Document_OnContextMenu(e);return false;}}};function TEContextMenu_AttachedElement_OnContextMenu(A,B,C){if (B.CtrlDisable&&(A.ctrlKey||A.metaKey)) return true;var D=C||this;if (B.OnBeforeOpen) B.OnBeforeOpen.call(B,D);if (B._MenuBlock.Count()==0) return false;if (B._Redraw){B._MenuBlock.Create(B._Panel.MainNode);B._Redraw=false;};TETools.DisableSelection(B._Panel.Document.body);var x=0;var y=0;if (TEBrowserInfo.IsIE){x=A.screenX;y=A.screenY;}else if (TEBrowserInfo.IsSafari){x=A.clientX;y=A.clientY;}else{x=A.pageX;y=A.pageY;};B._Panel.Show(x,y,A.currentTarget||null);return false;};function TEContextMenu_MenuBlock_OnClick(A,B){B._Panel.Hide();TETools.RunFunction(B.OnItemClick,B,A);};
TE.ContextMenu={};TE.ContextMenu.Listeners=[];TE.ContextMenu.RegisterListener=function(A){if (A) this.Listeners.push(A);};function TE_ContextMenu_Init(){var A=TE.ContextMenu._InnerContextMenu=new TEContextMenu(TEBrowserInfo.IsIE?window:window.parent,TELang.Dir);A.CtrlDisable=TEConfig.BrowserContextMenuOnCtrl;A.OnBeforeOpen=TE_ContextMenu_OnBeforeOpen;A.OnItemClick=TE_ContextMenu_OnItemClick;var B=TE.ContextMenu;for (var i=0;i<TEConfig.ContextMenu.length;i++) B.RegisterListener(TE_ContextMenu_GetListener(TEConfig.ContextMenu[i]));};function TE_ContextMenu_GetListener(A){switch (A){case 'Generic':return {AddItems:function(menu,tag,tagName){menu.AddItem('Cut',TELang.Cut,7,TECommands.GetCommand('Cut').GetState()==-1);menu.AddItem('Copy',TELang.Copy,8,TECommands.GetCommand('Copy').GetState()==-1);menu.AddItem('Paste',TELang.Paste,9,TECommands.GetCommand('Paste').GetState()==-1);}};case 'Table':return {AddItems:function(menu,tag,tagName){var B=(tagName=='TABLE');var C=(!B&&TESelection.HasAncestorNode('TABLE'));if (C){menu.AddSeparator();var D=menu.AddItem('Cell',TELang.CellCM);D.AddItem('TableInsertCellBefore',TELang.InsertCellBefore,69);D.AddItem('TableInsertCellAfter',TELang.InsertCellAfter,58);D.AddItem('TableDeleteCells',TELang.DeleteCells,59);if (TEBrowserInfo.IsGecko) D.AddItem('TableMergeCells',TELang.MergeCells,60,TECommands.GetCommand('TableMergeCells').GetState()==-1);else{D.AddItem('TableMergeRight',TELang.MergeRight,60,TECommands.GetCommand('TableMergeRight').GetState()==-1);D.AddItem('TableMergeDown',TELang.MergeDown,60,TECommands.GetCommand('TableMergeDown').GetState()==-1);};D.AddItem('TableHorizontalSplitCell',TELang.HorizontalSplitCell,61,TECommands.GetCommand('TableHorizontalSplitCell').GetState()==-1);D.AddItem('TableVerticalSplitCell',TELang.VerticalSplitCell,61,TECommands.GetCommand('TableVerticalSplitCell').GetState()==-1);D.AddSeparator();D.AddItem('TableCellProp',TELang.CellProperties,57,TECommands.GetCommand('TableCellProp').GetState()==-1);menu.AddSeparator();D=menu.AddItem('Row',TELang.RowCM);D.AddItem('TableInsertRowBefore',TELang.InsertRowBefore,70);D.AddItem('TableInsertRowAfter',TELang.InsertRowAfter,62);D.AddItem('TableDeleteRows',TELang.DeleteRows,63);menu.AddSeparator();D=menu.AddItem('Column',TELang.ColumnCM);D.AddItem('TableInsertColumnBefore',TELang.InsertColumnBefore,71);D.AddItem('TableInsertColumnAfter',TELang.InsertColumnAfter,64);D.AddItem('TableDeleteColumns',TELang.DeleteColumns,65);};if (B||C){menu.AddSeparator();menu.AddItem('TableDelete',TELang.TableDelete);menu.AddItem('TableProp',TELang.TableProperties,39);}}};case 'Link':return {AddItems:function(menu,tag,tagName){var E=(tagName=='A'||TESelection.HasAncestorNode('A'));if (E||TE.GetNamedCommandState('Unlink')!=-1){var F=TESelection.MoveToAncestorNode('A');var G=(F&&F.name.length>0&&F.href.length==0);if (G) return;menu.AddSeparator();if (E) menu.AddItem('Link',TELang.EditLink,34);menu.AddItem('Unlink',TELang.RemoveLink,35);}}};case 'Image':return {AddItems:function(menu,tag,tagName){if (tagName=='IMG'&&!tag.getAttribute('_tefakelement')){menu.AddSeparator();menu.AddItem('Image',TELang.ImageProperties,37);}}};case 'Anchor':return {AddItems:function(menu,tag,tagName){var F=TESelection.MoveToAncestorNode('A');var G=(F&&F.name.length>0);if (G||(tagName=='IMG'&&tag.getAttribute('_teanchor'))){menu.AddSeparator();menu.AddItem('Anchor',TELang.AnchorProp,36);menu.AddItem('AnchorDelete',TELang.AnchorDelete);}}};case 'Flash':return {AddItems:function(menu,tag,tagName){if (tagName=='IMG'&&tag.getAttribute('_teflash')){menu.AddSeparator();menu.AddItem('Flash',TELang.FlashProperties,38);}}};case 'Form':return {AddItems:function(menu,tag,tagName){if (TESelection.HasAncestorNode('FORM')){menu.AddSeparator();menu.AddItem('Form',TELang.FormProp,48);}}};case 'Checkbox':return {AddItems:function(menu,tag,tagName){if (tagName=='INPUT'&&tag.type=='checkbox'){menu.AddSeparator();menu.AddItem('Checkbox',TELang.CheckboxProp,49);}}};case 'Radio':return {AddItems:function(menu,tag,tagName){if (tagName=='INPUT'&&tag.type=='radio'){menu.AddSeparator();menu.AddItem('Radio',TELang.RadioButtonProp,50);}}};case 'TextField':return {AddItems:function(menu,tag,tagName){if (tagName=='INPUT'&&(tag.type=='text'||tag.type=='password')){menu.AddSeparator();menu.AddItem('TextField',TELang.TextFieldProp,51);}}};case 'HiddenField':return {AddItems:function(menu,tag,tagName){if (tagName=='IMG'&&tag.getAttribute('_teinputhidden')){menu.AddSeparator();menu.AddItem('HiddenField',TELang.HiddenFieldProp,56);}}};case 'ImageButton':return {AddItems:function(menu,tag,tagName){if (tagName=='INPUT'&&tag.type=='image'){menu.AddSeparator();menu.AddItem('ImageButton',TELang.ImageButtonProp,55);}}};case 'Button':return {AddItems:function(menu,tag,tagName){if (tagName=='INPUT'&&(tag.type=='button'||tag.type=='submit'||tag.type=='reset')){menu.AddSeparator();menu.AddItem('Button',TELang.ButtonProp,54);}}};case 'Select':return {AddItems:function(menu,tag,tagName){if (tagName=='SELECT'){menu.AddSeparator();menu.AddItem('Select',TELang.SelectionFieldProp,53);}}};case 'Textarea':return {AddItems:function(menu,tag,tagName){if (tagName=='TEXTAREA'){menu.AddSeparator();menu.AddItem('Textarea',TELang.TextareaProp,52);}}};case 'BulletedList':return {AddItems:function(menu,tag,tagName){if (TESelection.HasAncestorNode('UL')){menu.AddSeparator();menu.AddItem('BulletedList',TELang.BulletedListProp,27);}}};case 'NumberedList':return {AddItems:function(menu,tag,tagName){if (TESelection.HasAncestorNode('OL')){menu.AddSeparator();menu.AddItem('NumberedList',TELang.NumberedListProp,26);}}};};return null;};function TE_ContextMenu_OnBeforeOpen(){TE.Events.FireEvent('OnSelectionChange');var A,sTagName;if ((A=TESelection.GetSelectedElement())) sTagName=A.tagName;var B=TE.ContextMenu._InnerContextMenu;B.RemoveAllItems();var C=TE.ContextMenu.Listeners;for (var i=0;i<C.length;i++) C[i].AddItems(B,A,sTagName);};function TE_ContextMenu_OnItemClick(A){TE.Focus();TECommands.GetCommand(A.Name).Execute();};
var TEPlugin=function(A,B,C){this.Name=A;this.BasePath=C?C:TEConfig.PluginsPath;this.Path=this.BasePath+A+'/';if (!B||B.length==0) this.AvailableLangs=[];else this.AvailableLangs=B.split(',');};TEPlugin.prototype.Load=function(){if (this.AvailableLangs.length>0){var A;if (this.AvailableLangs.IndexOf(TELanguageManager.ActiveLanguage.Code)>=0) A=TELanguageManager.ActiveLanguage.Code;else A=this.AvailableLangs[0];LoadScript(this.Path+'lang/'+A+'.js');};LoadScript(this.Path+'teplugin.js');}
var TEPlugins=TE.Plugins={};TEPlugins.ItemsCount=0;TEPlugins.Items={};TEPlugins.Load=function(){var A=TEPlugins.Items;for (var i=0;i<TEConfig.Plugins.Items.length;i++){var B=TEConfig.Plugins.Items[i];var C=A[B[0]]=new TEPlugin(B[0],B[1],B[2]);TEPlugins.ItemsCount++;};for (var s in A) A[s].Load();TEPlugins.Load=null;}
